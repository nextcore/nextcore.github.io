(self.webpackChunkmagic=self.webpackChunkmagic||[]).push([[372],{9554:(L,U,r)=>{"use strict";r.d(U,{v:()=>a});const a={name:"Name must be minimum 2 characters long",backendname:"Alphanumeric characters between 2 to 20 (no space).",username:"Alphanumeric between 2 and 20 characters (no space)",email:"Email must be a valid email address",confirmEmail:"Email addresses must match",confirmPassword:"Passwords must match",currentPassword:"Your password is incorrect",cloudletName:"Minimum of 5 characters, only lowercase and numbers",phone:"e.g. 1111111111",subject:"2 to 30 letters, without special characters",message:"Message cannot be less than 3 characters",appNames:"Only lowercase alphanumeric characters, dot (.), - or _ please",appNamesWithUppercaseDot:"Only alphanumeric characters, dot (.), - or _ please",appNamesWithDot:"Only lowercase alphanumeric characters, and - or _ please",appNameWithUppercase:"Accepts alphanumeric characters and _",appNameWithUppercaseHyphen:"Accepts alphanumeric characters, - and _",domain:"Domain is not valid",backend:"Backend URL must contain http://",password:"Minimum 12 characters",recaptcha:"Not valid reCAPTCHA secret or key"}},8194:(L,U,r)=>{"use strict";r.d(U,{g:()=>a});const a={phone:/^[0-9 ]*$/,name:/^[a-z0-9]{2,20}$/,subject:/^.{4,1000}$/,appNames:/^[a-z0-9_.-]+$/,appNamesWithDot:/^[a-z0-9_.-]+$/,appNamesWithUppercaseDot:/^[a-zA-Z0-9_.-]+$/,appNameWithUppercase:/^[a-zA-Z0-9_]+$/,appNameWithUppercaseHyphen:/^[a-zA-Z0-9_-]+$/,domain:/(^https?:\/\/)([\w\-])+\.{1}([a-zA-Z]{2,63})([\/\w-]*)*\/?\??([^#\n\r]*)?#?([^\n\r]*)/,backend:/^https?:\/\/([\w\-.])+(:[0-9]*)?(\.\w+)?$/,email:/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/,password:/^.{12,}$/,recaptcha:/^([a-zA-Z-_0-9]{20,100})$/}},7832:(L,U,r)=>{"use strict";r.d(U,{K:()=>f});var a=r(6895),e=r(2278),c=r(4006),T=r(1103),Z=r(4650);let f=(()=>{class b{}return b.\u0275fac=function(D){return new(D||b)},b.\u0275mod=Z.oAB({type:b}),b.\u0275inj=Z.cJS({imports:[a.ez,e.q,c.u5,c.UX,T.k]}),b})()},6996:(L,U,r)=>{"use strict";r.d(U,{z:()=>u});var a=r(4006),e=r(5938),c=r(4650),T=r(3885),Z=r(6895),f=r(7392),b=r(4859),_=r(9549),D=r(4144),s=r(266);function o(g,M){if(1&g&&c._UZ(0,"p",8),2&g){const v=c.oxw();c.Q6J("innerHTML",v.data.description_extra,c.oJD)}}function l(g,M){if(1&g&&(c.TgZ(0,"mat-hint",14),c._uU(1),c.qZA()),2&g){const v=c.oxw(2);c.xp6(1),c.hij(" Inserted ",v.data.extra.fieldToBeTypedTitle," doesn't match. ")}}function d(g,M){if(1&g&&(c.ynx(0),c.TgZ(1,"mat-form-field",9)(2,"span",10)(3,"mat-icon"),c._uU(4),c.qZA(),c.TgZ(5,"span",11),c._uU(6,"|"),c.qZA()(),c._UZ(7,"input",12),c.YNc(8,l,2,1,"mat-hint",13),c.qZA(),c.BQk()),2&g){const v=c.oxw();c.xp6(2),c.MGl("matTooltip","Type in the ",v.data.extra.fieldToBeTypedTitle,""),c.xp6(2),c.Oqu(null==v.data||null==v.data.extra?null:v.data.extra.icon),c.xp6(3),c.MGl("placeholder","Type in the ",v.data.extra.fieldToBeTypedTitle,""),c.Q6J("formControl",v.inputValue),c.xp6(1),c.Q6J("ngIf",""!==v.inputValue.value&&v.data.extra.fieldToBeTypedValue!==v.inputValue.value)}}let u=(()=>{class g{constructor(v,y,k){this.generalService=v,this.dialogRef=y,this.data=k,this.inputValue=new a.NI("")}ngOnInit(){this.data.title=this.data.title??"Please confirm",this.data.description=this.data.description??"Are you sure?",this.data.action_btn_color=this.data.action_btn_color??"primary"}confirm(){!this.data.extra||!this.data.extra.details||this.inputValue.value===this.data.extra.fieldToBeTypedValue&&""!==this.inputValue.value?this.dialogRef.close("confirm"):this.generalService.showFeedback(this.data.extra.fieldToBeTypedTitle+" does not match","errorMessage",null,2e3)}}return g.\u0275fac=function(v){return new(v||g)(c.Y36(T.m),c.Y36(e.so),c.Y36(e.WI))},g.\u0275cmp=c.Xpm({type:g,selectors:[["app-confirmation-dialog"]],decls:13,vars:10,consts:[["mat-dialog-title",""],[3,"ngSubmit"],["mat-dialog-content",""],[3,"innerHTML",4,"ngIf"],[4,"ngIf"],["mat-dialog-actions","",3,"align"],["mat-button","","mat-dialog-close","","cdkFocusInitial",""],["mat-flat-button","",3,"color","click"],[3,"innerHTML"],[1,"w-100"],["matPrefix","",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2",3,"matTooltip"],[1,"text-muted"],["cdkFocusInitial","","matInput","","autocomplete","off",3,"placeholder","formControl"],["class","text-danger",4,"ngIf"],[1,"text-danger"]],template:function(v,y){1&v&&(c.TgZ(0,"h3",0),c._uU(1),c.qZA(),c.TgZ(2,"form",1),c.NdJ("ngSubmit",function(){return y.confirm()}),c.TgZ(3,"div",2)(4,"p"),c._uU(5),c.qZA(),c.YNc(6,o,1,1,"p",3),c.YNc(7,d,9,5,"ng-container",4),c.qZA(),c.TgZ(8,"div",5)(9,"button",6),c._uU(10),c.qZA(),c.TgZ(11,"button",7),c.NdJ("click",function(){return y.confirm()}),c._uU(12),c.qZA()()()),2&v&&(c.xp6(1),c.Oqu(y.data.title),c.xp6(3),c.ekj("fw-bold",y.data.bold_description),c.xp6(1),c.Oqu(y.data.description),c.xp6(1),c.Q6J("ngIf",y.data.description_extra),c.xp6(1),c.Q6J("ngIf",(null==y.data||null==y.data.extra?null:y.data.extra.details)&&"confirmInput"===(null==y.data||null==y.data.extra?null:y.data.extra.action)),c.xp6(1),c.Q6J("align","end"),c.xp6(2),c.hij(" ",y.data.close_btn||"Cancel"," "),c.xp6(1),c.s9C("color",y.data.action_btn_color),c.xp6(1),c.hij(" ",y.data.action_btn," "))},dependencies:[Z.O5,f.Hw,b.lW,_.KE,_.bx,_.qo,D.Nt,e.ZT,e.uh,e.xY,e.H8,s.gM,a._Y,a.Fj,a.JJ,a.JL,a.F,a.oH],styles:["p[_ngcontent-%COMP%]{line-height:1.8}"]}),g})()},9311:(L,U,r)=>{"use strict";r.d(U,{J:()=>Z});var a=r(4650),e=r(6895);const c=function(f){return{height:f}};function T(f,b){if(1&f&&(a.TgZ(0,"div"),a._UZ(1,"div",2),a.qZA()),2&f){const _=a.oxw();a.Tol(_.colClass),a.xp6(1),a.ekj("mat-elevation-z1",_.hasShadow),a.Q6J("ngStyle",a.VKq(5,c,_.blockHeight))}}let Z=(()=>{class f{constructor(){this.amount=2,this.colClass="col-12",this.blockHeight="375px",this.hasShadow=!0,this.itemsArray=[]}ngOnInit(){for(let _=0;_<this.amount;_++)this.itemsArray.push("item"+_)}}return f.\u0275fac=function(_){return new(_||f)},f.\u0275cmp=a.Xpm({type:f,selectors:[["app-loading-skeleton"]],inputs:{amount:"amount",colClass:"colClass",blockHeight:"blockHeight",hasShadow:"hasShadow"},decls:2,vars:1,consts:[[1,"row"],[3,"class",4,"ngFor","ngForOf"],[1,"block","mb-3",3,"ngStyle"]],template:function(_,D){1&_&&(a.TgZ(0,"div",0),a.YNc(1,T,2,7,"div",1),a.qZA()),2&_&&(a.xp6(1),a.Q6J("ngForOf",D.itemsArray))},dependencies:[e.sg,e.PC],styles:[".block[_ngcontent-%COMP%]{background:#eee;background:linear-gradient(90deg,#ffffff 8%,#f2f2f2 18%,#fafafa 33%);background-size:200% 100%;animation:1s shine linear infinite;border-radius:5px;border:1px solid rgba(217,217,217,.05)}@keyframes shine{to{background-position-x:-200%}}"]}),f})()},316:(L,U,r)=>{"use strict";r.d(U,{E:()=>P});var a=r(4650),e=r(4006),c=r(8372),T=r(1884),Z=r(6895),f=r(7392),b=r(4859),_=r(9549),D=r(4144),s=r(6709),o=r(266),l=r(4385),d=r(3238);function u(x,N){if(1&x){const C=a.EpF();a.TgZ(0,"mat-checkbox",10),a.NdJ("ngModelChange",function(E){a.CHM(C);const F=a.oxw();return a.KtG(F.checked=E)})("change",function(){a.CHM(C);const E=a.oxw();return a.KtG(E.filter())}),a._uU(1),a.qZA()}if(2&x){const C=a.oxw();a.Q6J("ngModel",C.checked),a.xp6(1),a.hij(" ",C.checkBoxText," ")}}function g(x,N){if(1&x&&(a.TgZ(0,"mat-option",15)(1,"span",17),a._uU(2),a.qZA()()),2&x){const C=N.$implicit;a.Q6J("value",C),a.xp6(2),a.Oqu(C)}}function M(x,N){if(1&x){const C=a.EpF();a.TgZ(0,"mat-form-field",11)(1,"span",12)(2,"mat-icon"),a._uU(3,"filter_list"),a.qZA(),a.TgZ(4,"span",13),a._uU(5,"|"),a.qZA()(),a.TgZ(6,"mat-select",14),a.NdJ("ngModelChange",function(E){a.CHM(C);const F=a.oxw();return a.KtG(F.type=E)})("selectionChange",function(){a.CHM(C);const E=a.oxw();return E.filter(),a.KtG(E.typeChanged())}),a.TgZ(7,"mat-option",15),a._uU(8," Remove filter "),a.qZA(),a.YNc(9,g,3,2,"mat-option",16),a.qZA()()}if(2&x){const C=a.oxw();a.xp6(6),a.Q6J("ngModel",C.type),a.xp6(1),a.Q6J("value",null),a.xp6(2),a.Q6J("ngForOf",C.types)}}function v(x,N){if(1&x){const C=a.EpF();a.TgZ(0,"button",18),a.NdJ("click",function(){a.CHM(C);const E=a.oxw();return a.KtG(E.removeSearchTerm())}),a.TgZ(1,"mat-icon"),a._uU(2,"close"),a.qZA()()}}function y(x,N){if(1&x&&(a.TgZ(0,"mat-icon"),a._uU(1),a.qZA()),2&x){const C=a.oxw(2);a.xp6(1),a.Oqu(C.buttonIcon)}}function k(x,N){if(1&x){const C=a.EpF();a.TgZ(0,"button",19),a.NdJ("click",function(){a.CHM(C);const E=a.oxw();return a.KtG(E.buttonClicked())}),a.YNc(1,y,2,1,"mat-icon",20),a._uU(2),a.qZA()}if(2&x){const C=a.oxw();a.Q6J("disabled",C.buttonDisabled),a.xp6(1),a.Q6J("ngIf",C.buttonIcon),a.xp6(1),a.hij(" ",C.buttonText," ")}}function I(x,N){if(1&x){const C=a.EpF();a.TgZ(0,"button",19),a.NdJ("click",function(){a.CHM(C);const E=a.oxw();return a.KtG(E.button2Clicked())}),a._uU(1),a.qZA()}if(2&x){const C=a.oxw();a.Q6J("disabled",C.button2Disabled),a.xp6(1),a.hij(" ",C.button2Text," ")}}let P=(()=>{class x{constructor(){this.filterList=new a.vpe,this.buttonClick=new a.vpe,this.button2Click=new a.vpe,this.typeChange=new a.vpe,this.checkBoxText=null,this.buttonText=null,this.button2Text=null,this.buttonIcon=null,this.buttonDisabled=!1,this.button2Disabled=!1,this.checked=!1}ngOnInit(){this.filterControl=new e.NI(""),this.filterControl.valueChanges.pipe((0,c.b)(400),(0,T.x)()).subscribe(()=>{this.filter()})}removeSearchTerm(){this.filterControl.setValue("")}filter(){const C={};this.filterControl.value?.length>0&&(C.searchKey=this.filterControl.value),this.type&&(C.type=this.type),this.checkBoxText&&(C.checked=this.checked),this.filterList.emit(C)}typeChanged(){this.typeChange?.emit(this.type)}buttonClicked(){this.buttonClick.emit()}button2Clicked(){this.button2Click.emit()}}return x.\u0275fac=function(C){return new(C||x)},x.\u0275cmp=a.Xpm({type:x,selectors:[["app-searchbox"]],inputs:{types:"types",type:"type",checkBoxText:"checkBoxText",buttonText:"buttonText",button2Text:"button2Text",buttonIcon:"buttonIcon",buttonDisabled:"buttonDisabled",button2Disabled:"button2Disabled"},outputs:{filterList:"filterList",buttonClick:"buttonClick",button2Click:"button2Click",typeChange:"typeChange"},decls:14,vars:6,consts:[[1,"d-flex","justify-content-md-between","align-items-md-center","align-items-end","flex-md-row","w-100"],["color","primary","class","mt-md-0 mt-1 me-3",3,"ngModel","ngModelChange","change",4,"ngIf"],["class","w-100 standalone-field me-3",4,"ngIf"],[1,"w-100","standalone-field"],["matPrefix","","matTooltip","Search for item(s)",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],[1,"text-muted"],["matInput","","placeholder","Search ...","autocomplete","off",3,"formControl"],["input",""],["mat-icon-button","","matSuffix","",3,"click",4,"ngIf"],["mat-flat-button","","color","primary","class","ms-3",3,"disabled","click",4,"ngIf"],["color","primary",1,"mt-md-0","mt-1","me-3",3,"ngModel","ngModelChange","change"],[1,"w-100","standalone-field","me-3"],["matPrefix","","matTooltip","Filter on type",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],[1,"text-muted","ms-1"],["placeholder","Type ...",3,"ngModel","ngModelChange","selectionChange"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"d-block","name-line"],["mat-icon-button","","matSuffix","",3,"click"],["mat-flat-button","","color","primary",1,"ms-3",3,"disabled","click"],[4,"ngIf"]],template:function(C,O){if(1&C&&(a.TgZ(0,"div",0),a.YNc(1,u,2,2,"mat-checkbox",1),a.YNc(2,M,10,3,"mat-form-field",2),a.TgZ(3,"mat-form-field",3)(4,"span",4)(5,"mat-icon"),a._uU(6,"search"),a.qZA(),a.TgZ(7,"span",5),a._uU(8,"|"),a.qZA()(),a._UZ(9,"input",6,7),a.YNc(11,v,3,0,"button",8),a.qZA(),a.YNc(12,k,3,3,"button",9),a.YNc(13,I,2,2,"button",9),a.qZA()),2&C){const E=a.MAs(10);a.xp6(1),a.Q6J("ngIf",O.checkBoxText),a.xp6(1),a.Q6J("ngIf",(null==O.types?null:O.types.length)>0),a.xp6(7),a.Q6J("formControl",O.filterControl),a.xp6(2),a.Q6J("ngIf",""!==E.value),a.xp6(1),a.Q6J("ngIf",O.buttonText||O.buttonIcon),a.xp6(1),a.Q6J("ngIf",O.button2Text)}},dependencies:[Z.sg,Z.O5,f.Hw,b.lW,_.KE,_.qo,_.R9,D.Nt,s.oG,o.gM,l.gD,d.ey,e.Fj,e.JJ,e.On,e.oH],encapsulation:2}),x})()},5944:(L,U,r)=>{"use strict";r.d(U,{K:()=>b});var a=r(2843),e=r(3224),c=r(4650),T=r(529),Z=r(9845),f=r(9214);let b=(()=>{class _{constructor(s,o,l){this.httpClient=s,this.httpService=o,this.fileService=l}localManifests(){return this.httpService.get("/magic/system/bazar/app-manifests")}listBazarItems(s,o,l){let d="?limit="+l;return o&&0!==o&&(d+="&offset="+o),s&&""!==s&&(d+="&name.like="+encodeURIComponent(s+"%")),d+="&order=created&direction=desc&type.eq=module",this.httpClient.get(e.N.bazarUrl+"/magic/modules/bazar/apps"+d)}getBazarItem(s){const o="?folder_name.eq="+encodeURIComponent(s);return this.httpClient.get(e.N.bazarUrl+"/magic/modules/bazar/apps"+o)}countBazarItems(s){let o="";return s&&""!==s&&(o+="?name.like="+encodeURIComponent(s+"%")),o+=""===o?"?type.eq=module":"&type.eq=module",this.httpClient.get(e.N.bazarUrl+"/magic/modules/bazar/apps-count"+o)}subscribeToNewsletter(s){return this.httpClient.post(e.N.bazarUrl+"/magic/modules/bazar/subscribe",s)}purchaseBazarItem(s,o,l,d,u){const g={product_id:s.id,name:o,customer_email:l,subscribe:d,redirect_url:window.location.href.split("?")[0]};return u&&""!==u&&(g.promo_code=u),this.httpClient.post(e.N.bazarUrl+"/magic/modules/bazar/purchase",g)}canDownloadBazarItem(s){return this.httpClient.get(e.N.bazarUrl+"/magic/modules/bazar/can-download?token="+encodeURIComponent(s))}downloadBazarItem(s,o){return this.httpService.post("/magic/system/bazar/download-from-bazar",{url:e.N.bazarUrl+"/magic/modules/bazar/download?token="+o,name:s.folder_name})}updateBazarItem(s){return s.token&&""!==s.token?this.httpService.post("/magic/system/bazar/download-from-bazar",{url:e.N.bazarUrl+"/magic/modules/bazar/download?token="+s.token,name:s.module_name}):(0,a._)(()=>new Error("No token found in app's manifest"))}downloadBazarItemLocally(s){setTimeout(()=>this.fileService.downloadFolder("/modules/"+s+"/"),1e3)}canInstall(s){return this.httpService.get("/magic/system/bazar/can-install?required_magic_version="+encodeURIComponent(s))}installBazarItem(s,o,l,d){return this.httpService.put("/magic/system/file-system/install",{folder:"/modules/"+s+"/",app_version:o,name:l,token:d})}prompt(s,o){const l=e.N.bazarUrl+"/magic/system/openai/prompt?prompt="+encodeURIComponent(s)+"&type=aista_com&recaptcha_response="+encodeURIComponent(o);return this.httpClient.get(l)}}return _.\u0275fac=function(s){return new(s||_)(c.LFG(T.eN),c.LFG(Z.O),c.LFG(f.I))},_.\u0275prov=c.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()},1565:(L,U,r)=>{"use strict";r.d(U,{Q:()=>c});var a=r(4650),e=r(9845);let c=(()=>{class T{constructor(f){this.httpService=f}list(f=null){let b="";return null!==f&&(b+="?limit="+f.limit,b+="&offset="+f.offset,f.filter&&""!==f.filter&&(b+="&filter="+encodeURIComponent(f.filter))),this.httpService.get("/magic/system/cache/list"+b)}count(f=null){let b="";return null!==f&&""!==f&&(b+="?filter="+encodeURIComponent(f)),this.httpService.get("/magic/system/cache/count"+b)}delete(f){return this.httpService.delete("/magic/system/cache/delete?id="+encodeURIComponent(f))}clear(f=null){let b="";return null!==f&&""!==f&&(b+="?filter="+encodeURIComponent(f)),this.httpService.delete("/magic/system/cache/empty"+b)}}return T.\u0275fac=function(f){return new(f||T)(a.LFG(e.O))},T.\u0275prov=a.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})()},9214:(L,U,r)=>{"use strict";r.d(U,{I:()=>_});var a=r(4327),c=r(9751),T=r(4650),Z=r(9845),f=r(3885),b=r(1565);let _=(()=>{class D{constructor(o,l,d){this.httpService=o,this.generalService=l,this.cacheService=d}listFiles(o,l=null){let d="?folder="+encodeURIComponent(o);return l&&(d+="&filter="+encodeURIComponent(l)),this.httpService.get("/magic/system/file-system/list-files"+d)}listFilesRecursively(o,l){let d="?folder="+encodeURIComponent(o);return this.httpService.get("/magic/system/file-system/list-files-recursively"+d+"&sys="+l)}listFolders(o){return this.httpService.get("/magic/system/file-system/list-folders?folder="+encodeURIComponent(o))}listFoldersRecursively(o,l){return this.httpService.get("/magic/system/file-system/list-folders-recursively?folder="+encodeURIComponent(o)+"&sys="+l)}loadFile(o){return this.httpService.get("/magic/system/file-system/file?file="+encodeURIComponent(o),{responseType:"text"})}saveFile(o,l){const d=o.substring(0,o.lastIndexOf("/")+1),u=new FormData,g=new Blob([l],{type:"text/plain"});return u.append("file",g,o.substring(o.lastIndexOf("/")+1)),this.httpService.put("/magic/system/file-system/file?folder="+encodeURIComponent(d),u)}rename(o,l){return this.httpService.post("/magic/system/file-system/rename",{oldName:o,newName:l})}deleteFile(o){return this.httpService.delete("/magic/system/file-system/file?file="+encodeURIComponent(o))}downloadFile(o){this.httpService.download("/magic/system/file-system/file?file="+encodeURIComponent(o)).subscribe({next:l=>{let u=l.headers.get("Content-Disposition").split(";")[1].trim().split("=")[1].replace(/"/g,"");const g=new Blob([l.body]);(0,a.saveAs)(g,u)},error:l=>this.generalService.showFeedback(l?.error?.message??l,"errorMessage","Ok",4e3)})}uploadFile(o,l){const d=new FormData;return d.append("file",l),this.httpService.put("/magic/system/file-system/file?folder="+encodeURIComponent(o),d)}uploadDatabaseBackup(o){return new c.y(l=>{const d=new FormData;d.append("file",o),this.httpService.put("/magic/system/sql/backup",d).subscribe({next:u=>{this.cacheService.delete("magic.sql.databases.sqlite.*").subscribe({next:()=>{l.next(u),l.complete()},error:g=>{l.error(g),l.complete()}})},error:u=>{l.error(u),l.complete()}})})}importUsers(o){const l=new FormData;return l.append("file",o),this.httpService.put("/magic/system/auth/import-users",l)}uploadStaticWebsite(o){return this.httpService.put("/magic/system/file-system/overwrite-folder",o)}downloadFolder(o){this.httpService.download("/magic/system/file-system/download-folder?folder="+encodeURIComponent(o)).subscribe({next:l=>{const d=l.headers.get("Content-Disposition");let u=d.substring(d.indexOf("=")+1);u=u.substring(1,u.lastIndexOf('"'));const g=new Blob([l.body],{type:"application/zip"});(0,a.saveAs)(g,u)},error:l=>this.generalService.showFeedback(l?.error?.message??l,"errorMessage")})}createFolder(o){return this.httpService.put("/magic/system/file-system/folder",{folder:o})}deleteFolder(o){return this.httpService.delete("/magic/system/file-system/folder?folder="+encodeURIComponent(o))}getMacroDefinition(o){return this.httpService.get("/magic/system/ide/macro?macro="+encodeURIComponent(o))}executeMacro(o,l){return this.httpService.post("/magic/system/ide/execute-macro",{macro:o,args:l})}installModule(o){const l=new FormData;return l.append("file",o),this.httpService.put("/magic/system/file-system/install-module",l)}unzip(o){return this.httpService.put("/magic/system/file-system/unzip",{file:o,create_folder:!0})}}return D.\u0275fac=function(o){return new(o||D)(T.LFG(Z.O),T.LFG(f.m),T.LFG(b.Q))},D.\u0275prov=T.Yz7({token:D,factory:D.\u0275fac,providedIn:"root"}),D})()},3280:(L,U,r)=>{"use strict";r.d(U,{a:()=>b});var a=r(2843),e=r(9751),c=r(4650),T=r(9845),Z=r(9214),f=r(1565);let b=(()=>{class _{constructor(s,o,l){this.httpService=s,this.fileService=o,this.cacheService=l}executeSql(s,o,l,d,u){return this.httpService.post("/magic/system/sql/evaluate",{databaseType:s,database:o,sql:l,safeMode:d,batch:u})}defaultDatabaseType(){return this.httpService.get("/magic/system/sql/default-database-type")}connectionStrings(s){return this.httpService.get("/magic/system/sql/connection-strings?databaseType="+encodeURIComponent(s))}getDatabaseMetaInfo(s,o){return this.httpService.get("/magic/system/sql/databases?databaseType="+encodeURIComponent(s)+"&connectionString="+o)}addConnectionString(s,o,l,d=!1){return this.httpService.post("/magic/system/sql/connection-string",{databaseType:s,name:o,connectionString:l,useAsDefault:d})}deleteConnectionString(s,o){return this.httpService.delete("/magic/system/sql/connection-string?databaseType="+encodeURIComponent(s)+"&name="+encodeURIComponent(o))}listSnippets(s){return this.fileService.listFiles(`/etc/${s}/templates/`)}loadSnippet(s,o){return-1!==o.indexOf("/")?(0,a._)(()=>new Error("Not a valid filename")):((o=`/etc/${s}/templates/`+o).endsWith(".sql")||(o+=".sql"),this.fileService.loadFile(o))}saveSnippet(s,o,l){return-1!==o.indexOf("/")?(0,a._)(()=>new Error("Not a valid filename")):((o=`/etc/${s}/templates/`+o).endsWith(".sql")||(o+=".sql"),this.fileService.saveFile(o,l))}createDatabase(s,o,l){return new e.y(d=>{this.httpService.post("/magic/system/sql/ddl/database",{databaseType:s,connectionString:o,databaseName:l}).subscribe({next:u=>{this.cacheService.delete("magic.sql.databases."+s+"."+o+".*").subscribe({next:()=>{d.next(u),d.complete()},error:g=>{d.error(g),d.complete()}})},error:u=>{d.error(u),d.complete()}})})}dropDatabase(s,o,l){return new e.y(d=>{this.httpService.delete("/magic/system/sql/ddl/database?databaseType="+encodeURIComponent(s)+"&connectionString="+encodeURIComponent(o)+"&databaseName="+encodeURIComponent(l)).subscribe({next:u=>{this.cacheService.delete("magic.sql.databases."+s+"."+o+".*").subscribe({next:()=>{d.next(u),d.complete()},error:g=>{d.error(g),d.complete()}})},error:u=>{d.error(u),d.complete()}})})}exportDdl(s,o,l,d,u){return this.httpService.post("/magic/system/sql/ddl/export-tables",{databaseType:s,connectionString:o,databaseName:l,tables:d,full:u})}addTable(s,o,l,d,u,g,M,v){return new e.y(y=>{this.httpService.post("/magic/system/sql/ddl/table",{databaseType:s,connectionString:o,databaseName:l,tableName:d,pkName:u,pkType:g,pkLength:M,pkDefault:v}).subscribe({next:k=>{this.cacheService.delete("magic.sql.databases."+s+"."+o+".*").subscribe({next:()=>{y.next(k),y.complete()},error:I=>{y.error(I),y.complete()}})},error:k=>{y.error(k),y.complete()}})})}addLinkTable(s,o,l,d){return new e.y(u=>{this.httpService.post("/magic/system/sql/ddl/link-table",{databaseType:s,connectionString:o,databaseName:l,args:d}).subscribe({next:g=>{this.cacheService.delete("magic.sql.databases."+s+"."+o+".*").subscribe({next:()=>{u.next(g),u.complete()},error:M=>{u.error(M),u.complete()}})},error:g=>{u.error(g),u.complete()}})})}dropTable(s,o,l,d){return new e.y(u=>{this.httpService.delete("/magic/system/sql/ddl/table?databaseType="+encodeURIComponent(s)+"&connectionString="+encodeURIComponent(o)+"&databaseName="+encodeURIComponent(l)+"&tableName="+encodeURIComponent(d)).subscribe({next:g=>{this.cacheService.delete("magic.sql.databases."+s+"."+o+".*").subscribe({next:()=>{u.next(g),u.complete()},error:M=>{u.error(M),u.complete()}})},error:g=>{u.error(g),u.complete()}})})}addColumn(s,o,l,d,u,g,M,v,y,k){return new e.y(I=>this.httpService.post("/magic/system/sql/ddl/column",{databaseType:s,connectionString:o,databaseName:l,tableName:d,columnName:u,columnType:g,defaultValue:M,nullable:v,indexed:y,columnLength:k}).subscribe({next:P=>{this.cacheService.delete("magic.sql.databases."+s+"."+o+".*").subscribe({next:()=>{I.next(P),I.complete()},error:x=>{I.error(x),I.complete()}})},error:P=>{I.error(P),I.complete()}}))}addReferencedColumn(s,o,l,d,u,g,M,v,y,k,I){return new e.y(P=>{this.httpService.post("/magic/system/sql/ddl/column",{databaseType:s,connectionString:o,databaseName:l,tableName:d,columnName:u,columnType:g,foreignTable:M,foreignField:v,nullable:y,columnLength:k,cascading:I}).subscribe({next:x=>{this.cacheService.delete("magic.sql.databases."+s+"."+o+".*").subscribe({next:()=>{P.next(x),P.complete()},error:N=>{P.error(N),P.complete()}})},error:x=>{P.error(x),P.complete()}})})}deleteColumn(s,o,l,d,u){return new e.y(g=>{this.httpService.delete("/magic/system/sql/ddl/column?databaseType="+encodeURIComponent(s)+"&connectionString="+encodeURIComponent(o)+"&databaseName="+encodeURIComponent(l)+"&tableName="+encodeURIComponent(d)+"&columnName="+encodeURIComponent(u)).subscribe({next:M=>{this.cacheService.delete("magic.sql.databases."+s+"."+o+".*").subscribe({next:()=>{g.next(M),g.complete()},error:v=>{g.error(v),g.complete()}})},error:M=>{g.error(M),g.complete()}})})}deleteFk(s,o,l,d,u){return this.httpService.delete("/magic/system/sql/ddl/foreign-key?databaseType="+encodeURIComponent(s)+"&connectionString="+encodeURIComponent(o)+"&databaseName="+encodeURIComponent(l)+"&tableName="+encodeURIComponent(d)+"&fkName="+encodeURIComponent(u))}deleteIndex(s,o,l,d,u){return new e.y(g=>{this.httpService.delete("/magic/system/sql/ddl/index?databaseType="+encodeURIComponent(s)+"&connectionString="+encodeURIComponent(o)+"&databaseName="+encodeURIComponent(l)+"&tableName="+encodeURIComponent(d)+"&indexName="+encodeURIComponent(u)).subscribe({next:M=>{this.cacheService.delete("magic.sql.databases."+s+"."+o+".*").subscribe({next:()=>{g.next(M),g.complete()},error:v=>{g.error(v),g.complete()}})},error:M=>{g.error(M),g.complete()}})})}exportToModule(s,o,l){return this.httpService.post("/magic/system/sql/ddl/export-to-module",{databaseType:s,module:o,sql:l})}createMigrationScript(s,o,l){return this.httpService.post("/magic/system/sql/ddl/create-migration-script",{databaseType:s,module:o,sql:l})}}return _.\u0275fac=function(s){return new(s||_)(c.LFG(T.O),c.LFG(Z.I),c.LFG(f.Q))},_.\u0275prov=c.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()},3372:(L,U,r)=>{"use strict";r.r(U),r.d(U,{DatabasesModule:()=>Xe});var a=r(6895),e=r(4650),c=r(3848),T=r(3546),Z=r(8317),f=r(6996),b=r(3224),_=r(5938),D=r(5944),s=r(3885),o=r(4859),l=r(266),d=r(2282);function u(n,m){1&n&&(e.TgZ(0,"div",8),e._uU(1," Incompatible with your current version of Magic. "),e.TgZ(2,"a",9),e._uU(3,"Download the latest verion."),e.qZA()())}function g(n,m){1&n&&(e.TgZ(0,"button",10),e._uU(1," Close "),e.qZA())}function M(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"button",11),e.NdJ("click",function(){e.CHM(t);const p=e.oxw();return e.KtG(p.updatePlugin())}),e._uU(1," Update "),e.qZA()}}function v(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(){e.CHM(t);const p=e.oxw();return e.KtG(p.uninstall())}),e._uU(1," Uninstall "),e.qZA()}}function y(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"button",13),e.NdJ("click",function(){e.CHM(t);const p=e.oxw();return e.KtG(p.install())}),e._uU(1," Install "),e.qZA()}}let k=(()=>{class n{constructor(t,i,p,h){this.dialogRef=t,this.bazarService=i,this.generalService=p,this.data=h,this.installed=!1,this.canInstall=!1,this.needsCoreUpdate=!1}ngOnInit(){this.getAppDetails()}updatePlugin(){this.generalService.showLoading(),this.bazarService.updateBazarItem(this.data).subscribe({next:t=>{"success"===t.result&&this.bazarService.installBazarItem(this.data.module_name,this.data.new_version,this.data.name,this.data.token).subscribe({next:i=>{this.generalService.hideLoading(),"success"===i.result&&(this.generalService.showFeedback("Database was successfully updated."),this.dialogRef.close())},error:i=>{this.generalService.hideLoading(),this.generalService.showFeedback(i?.error?.message??i,"errorMessage")}})},error:t=>{this.generalService.hideLoading(),this.generalService.showFeedback(t?.error?.message??t,"errorMessage")}})}uninstall(){this.dialogRef.close("uninstall")}install(){this.dialogRef.close("install")}getAppDetails(){this.generalService.showLoading(),this.bazarService.canInstall(this.data.min_magic_version).subscribe({next:t=>{this.generalService.hideLoading(),"SUCCESS"===t.result?this.canInstall=!0:(this.generalService.showFeedback("Incompatible with your Magic version","errorMessage","Ok",5e3),this.needsCoreUpdate=!0)},error:t=>{this.generalService.hideLoading(),this.generalService.showFeedback(t?.error?.message??t,"errorMessage")}})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(_.so),e.Y36(D.K),e.Y36(s.m),e.Y36(_.WI))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-view-plugin-database"]],decls:9,vars:9,consts:[["mat-dialog-content","",1,"file-content"],[3,"innerHTML"],["mat-dialog-actions","",3,"align"],["class","d-flex justify-content-end mt-5",4,"ngIf"],["mat-button","","mat-dialog-close","",4,"ngIf"],["mat-flat-button","","matTooltip","Automatically updates your app","color","warn",3,"click",4,"ngIf"],["mat-flat-button","","color","warn",3,"click",4,"ngIf"],["mat-flat-button","","color","primary",3,"click",4,"ngIf"],[1,"d-flex","justify-content-end","mt-5"],["target","_blank","href","https://polterguy.github.io/tutorials/getting-started/"],["mat-button","","mat-dialog-close",""],["mat-flat-button","","matTooltip","Automatically updates your app","color","warn",3,"click"],["mat-flat-button","","color","warn",3,"click"],["mat-flat-button","","color","primary",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"div",1),e.ALo(2,"marked"),e.qZA(),e.TgZ(3,"div",2),e.YNc(4,u,4,0,"div",3),e.YNc(5,g,2,0,"button",4),e.YNc(6,M,2,0,"button",5),e.YNc(7,v,2,0,"button",6),e.YNc(8,y,2,0,"button",7),e.qZA()),2&t&&(e.xp6(1),e.Q6J("innerHTML",e.lcZ(2,7,i.data.description),e.oJD),e.xp6(2),e.Q6J("align","end"),e.xp6(1),e.Q6J("ngIf",i.needsCoreUpdate),e.xp6(1),e.Q6J("ngIf",!i.data.has_update),e.xp6(1),e.Q6J("ngIf",i.data.has_update),e.xp6(1),e.Q6J("ngIf",null==i.data?null:i.data.details),e.xp6(1),e.Q6J("ngIf",!(null!=i.data&&i.data.details)))},dependencies:[a.O5,o.lW,_.ZT,_.xY,_.H8,l.gM,d.r],styles:[".file-content[_ngcontent-%COMP%]     img{max-width:100%;height:auto}"]}),n})();var I=r(9554),P=r(8194),x=r(3280),N=r(9214),C=r(1565),O=r(2729),E=r(9132),F=r(9311),q=r(7392),R=r(9549),B=r(4144),S=r(671),A=r(4006);function z(n,m){1&n&&(e.ynx(0),e._UZ(1,"app-loading-skeleton",21),e.BQk())}function W(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"button",31),e.NdJ("click",function(){e.CHM(t);const p=e.oxw().$implicit,h=e.oxw(2);return e.KtG(h.installPluginDatabase(p))}),e._uU(1," Install "),e.qZA()}}function H(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"button",32),e.NdJ("click",function(){e.CHM(t);const p=e.oxw().$implicit,h=e.oxw(2);return e.KtG(h.uninstallPluginDatabase(p.details))}),e._uU(1," Uninstall "),e.qZA()}}function j(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"div",23)(1,"div",2)(2,"div",24)(3,"p",25),e._uU(4),e.qZA(),e.TgZ(5,"p",26),e._uU(6),e.qZA()(),e.TgZ(7,"div",27)(8,"button",28),e.NdJ("click",function(){const h=e.CHM(t).$implicit,w=e.oxw(2);return e.KtG(w.viewPluginDatabaseDetails(h))}),e._uU(9," Details "),e.qZA(),e.YNc(10,W,2,0,"button",29),e.YNc(11,H,2,0,"button",30),e.qZA()()()}if(2&n){const t=m.$implicit;e.xp6(4),e.Oqu(null==t?null:t.name),e.xp6(2),e.Oqu(null==t?null:t.description),e.xp6(4),e.Q6J("ngIf",!(null!=t&&t.details)),e.xp6(1),e.Q6J("ngIf",null==t?null:t.details)}}function $(n,m){if(1&n&&(e.ynx(0),e.YNc(1,j,12,4,"div",22),e.BQk()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.databases)}}function G(n,m){1&n&&(e.ynx(0),e._UZ(1,"app-loading-skeleton",33),e.BQk())}function V(n,m){1&n&&(e.TgZ(0,"th",46),e._uU(1,"Name"),e.qZA())}function X(n,m){if(1&n&&(e.TgZ(0,"td",47),e._uU(1),e.qZA()),2&n){const t=m.$implicit;e.xp6(1),e.Oqu(null==t?null:t.name)}}function ee(n,m){1&n&&(e.TgZ(0,"th",46),e._uU(1,"Tables"),e.qZA())}function te(n,m){if(1&n&&(e.TgZ(0,"td",48),e._uU(1),e.qZA()),2&n){const t=m.$implicit;let i;e.xp6(1),e.Oqu(null!==(i=null==t||null==t.tables?null:t.tables.length)&&void 0!==i?i:"-")}}function ne(n,m){1&n&&(e.TgZ(0,"th",49),e._uU(1,"Actions"),e.qZA())}const Q=function(n,m,t){return{dbType:n,dbName:m,dbCString:t}};function ae(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"td",50)(1,"button",51),e._uU(2," Edit "),e.qZA(),e.TgZ(3,"button",28),e.NdJ("click",function(){const h=e.CHM(t).$implicit,w=e.oxw(2);return e.KtG(w.downloadDatabaseBackup(h))}),e._uU(4," Backup "),e.qZA(),e.TgZ(5,"button",52),e.NdJ("click",function(){const h=e.CHM(t).$implicit,w=e.oxw(2);return e.KtG(w.deleteDatabase(h))}),e._uU(6," Delete "),e.qZA(),e.TgZ(7,"button",53),e._uU(8," Generate endpoints "),e.qZA()()}if(2&n){const t=m.$implicit;e.xp6(1),e.Q6J("queryParams",e.kEZ(4,Q,t.type,t.name,t.connectionString)),e.xp6(4),e.Q6J("disabled","magic"===t.name),e.xp6(2),e.Q6J("queryParams",e.kEZ(8,Q,t.type,t.name,t.connectionString))("disabled","magic"===t.name)}}function oe(n,m){1&n&&e._UZ(0,"tr",54)}function ie(n,m){1&n&&e._UZ(0,"tr",55)}function se(n,m){if(1&n&&(e.TgZ(0,"div",34)(1,"table",35),e.ynx(2,36),e.YNc(3,V,2,0,"th",37),e.YNc(4,X,2,1,"td",38),e.BQk(),e.ynx(5,39),e.YNc(6,ee,2,0,"th",37),e.YNc(7,te,2,1,"td",40),e.BQk(),e.ynx(8,41),e.YNc(9,ne,2,0,"th",42),e.YNc(10,ae,9,12,"td",43),e.BQk(),e.YNc(11,oe,1,0,"tr",44),e.YNc(12,ie,1,0,"tr",45),e.qZA()()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("dataSource",t.existingDatabases),e.xp6(10),e.Q6J("matHeaderRowDef",t.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",t.displayedColumns)}}function re(n,m){if(1&n&&(e.TgZ(0,"div",56)(1,"div",57)(2,"div",58)(3,"div",59),e._UZ(4,"div",60),e.qZA(),e.TgZ(5,"h3",61),e._uU(6),e.qZA(),e.TgZ(7,"p",62),e._uU(8,"Please do NOT leave this page until the installation is completed."),e.qZA()()()()),2&n){const t=e.oxw();e.xp6(6),e.Oqu(t.currentStage)}}let le=(()=>{class n{constructor(t,i,p,h,w,J,Y){this.dialog=t,this.sqlService=i,this.fileService=p,this.bazarService=h,this.cacheService=w,this.configService=J,this.generalService=Y,this.appDetails=[],this.hubConnection=null,this.displayedColumns=["name","tables","actions"],this.databases=[],this.existingDatabases=[],this.waitingInstallation=!1,this.currentStage="Preparing database to be downloaded.",this.isLoadingDbs=!0,this.isLoadingPlugins=!0,this.databaseName="",this.CommonRegEx=P.g,this.CommonErrorMessages=I.v}ngOnInit(){this.generalService.showLoading(),this.getDatabases()}createNewDatabase(){""!==this.databaseName?this.CommonRegEx.appNameWithUppercaseHyphen.test(this.databaseName)?(this.generalService.showLoading(),this.sqlService.createDatabase("sqlite","generic",this.databaseName).subscribe({next:()=>{this.generalService.showFeedback("Database successfully created","successMessage"),this.getDatabases()},error:t=>{this.generalService.hideLoading(),this.generalService.showFeedback(t?.error?.message??t,"errorMessage","Ok",-1)}})):this.generalService.showFeedback(this.CommonErrorMessages.appNameWithUppercaseHyphen,"errorMessage"):this.generalService.showFeedback("Please provide a name","errorMessage")}viewPluginDatabaseDetails(t){this.dialog.open(k,{minWidth:"500px",data:t}).afterClosed().subscribe(i=>{"uninstall"===i&&this.uninstallPluginDatabase(t.details),"install"===i&&this.installPluginDatabase(t)})}installPluginDatabase(t){this.generalService.showLoading(),this.waitingInstallation=!0,this.configService.rootUserEmailAddress().subscribe({next:i=>{this.bazarService.purchaseBazarItem(t,i.name,i.email,!0,null).subscribe({next:p=>{this.connectSocket(p.code,t)},error:p=>{this.generalService.showFeedback(p?.error?.message??p,"errorMessage"),this.generalService.hideLoading(),this.waitingInstallation=!1}})},error:i=>{this.generalService.hideLoading(),this.waitingInstallation=!1,this.generalService.showFeedback(i?.error?.message??i,"errorMessage")}})}uninstallPluginDatabase(t){this.dialog.open(f.z,{width:"500px",data:{title:"Uninstall database module",description_extra:`You are uninstalling the following database module: <br/> <span class="fw-bold">${t?.name}</span> <br/><br/>This will not delete the database itself. Do you want to continue?`,action_btn:"Uninstall",action_btn_color:"warn",bold_description:!0}}).afterClosed().subscribe(i=>{"confirm"===i&&(this.generalService.showLoading(),this.fileService.deleteFolder("/modules/"+t.module_name+"/").subscribe({next:()=>{this.generalService.showFeedback(t.name+" uninstalled successfully.","successMessage"),this.getPluginDatabases()},error:p=>{this.generalService.hideLoading(),this.generalService.showFeedback(p?.error?.message??p,"errorMessage")}}))})}downloadDatabaseBackup(t){this.fileService.downloadFile("/data/"+t.name+".db")}uploadDatabaseBackup(t){this.fileService.uploadDatabaseBackup(t.item(0)).subscribe({next:()=>{this.generalService.showFeedback("Backup was successfully uploaded","successMessage"),this.zipFileInput=null,this.getDatabases()},error:i=>this.generalService.showFeedback(i)})}deleteDatabase(t){this.dialog.open(f.z,{width:"500px",data:{title:"Delete database",description_extra:`You are deleting the following database: <br/> <span class="fw-bold">${t.name}</span> <br/><br/>This action is permanent. Do you want to continue?`,action_btn:"Delete",action_btn_color:"warn",bold_description:!0,extra:{details:t,action:"confirmInput",fieldToBeTypedTitle:"database name",fieldToBeTypedValue:t.name,icon:"database"}}}).afterClosed().subscribe(i=>{"confirm"===i&&this.sqlService.dropDatabase("sqlite","generic",t.name).subscribe({next:()=>{this.generalService.showFeedback("Database successfully deleted","successMessage"),this.getDatabases(),this.getPluginDatabases()},error:p=>{this.generalService.showFeedback(p?.error?.message??p,"errorMessage")}})})}ngOnDestroy(){this.hubConnection?.stop(),this.generalService.hideLoading()}getPluginDatabases(){this.bazarService.listBazarItems("SQLite%",0,5).subscribe({next:t=>{this.databases=t||[],this.databases.map(i=>{i.hasUpdate=!1}),this.loadLocalManifests(),this.generalService.hideLoading()},error:t=>{this.generalService.hideLoading(),this.generalService.showFeedback(t?.error?.message??t,"errorMessage")}})}loadLocalManifests(){this.bazarService.localManifests().subscribe({next:t=>{this.generalService.hideLoading(),this.appDetails=t||[],this.isLoadingPlugins=!1,t&&(this.databases.map(i=>this.appDetails.map(p=>{i.name===p.name&&(i.details=p)})),t.forEach(i=>{this.getVersion(i.module_name,i.version)}))},error:t=>{this.generalService.hideLoading(),this.generalService.showFeedback(t?.error?.message??t,"errorMessage")}})}getVersion(t,i){this.bazarService.getBazarItem(t).subscribe({next:p=>{if(p){const h=this.databases.find(w=>w?.details?.module_name===t);h&&-1===this.configService.versionCompare(i,p[0].version)&&(h.hasUpdate=!0,h.newVersion=p[0].version)}},error:p=>{this.generalService.showFeedback(p?.error?.message??p,"errorMessage")}})}getDatabases(){this.existingDatabases=[],this.isLoadingDbs=!0,this.sqlService.getDatabaseMetaInfo("sqlite","generic").subscribe({next:t=>{t.databases.map(i=>{i.type="sqlite",i.connectionString="generic"}),this.existingDatabases=[...this.existingDatabases,...t.databases],this.waitingInstallation=!1,this.isLoadingDbs=!1,this.getPluginDatabases()},error:t=>{this.generalService.hideLoading(),this.generalService.showFeedback(t?.error?.message??t,"errorMessage")}})}downloadBazarItem(t,i){this.currentStage="Downloading database",this.bazarService.downloadBazarItem(t,i).subscribe({next:p=>{"success"===p.result?(this.currentStage="Installing database",this.bazarService.installBazarItem(t.folder_name,t.version,t.name,i).subscribe({next:h=>{"success"===h.result?(this.generalService.showFeedback("Plugin was successfully installed on your cloudlet","successMessage"),this.cacheService.delete("magic.sql.databases.sqlite.*").subscribe({next:()=>{this.getDatabases(),this.loadLocalManifests()},error:w=>this.generalService.showFeedback(w?.error?.message??w,"errorMessage")}),this.hubConnection&&(this.hubConnection.stop(),this.hubConnection=null)):this.generalService.showFeedback("Oops! Please check the system log.","errorMessage","Ok",5e3)},error:h=>{this.generalService.showFeedback(h?.error?.message??h,"errorMessage")}})):this.generalService.showFeedback("Oops! Please check the system log.","errorMessage","Ok",5e3)},error:()=>{this.hubConnection?.stop(),this.hubConnection=null,this.generalService.hideLoading(),this.waitingInstallation=!1,this.generalService.showFeedback("Refresh the page and try again.","errorMessage")}})}connectSocket(t,i){let p=new Z.su;this.hubConnection=p.withUrl(b.N.bazarUrl+"/sockets",{skipNegotiation:!0,transport:Z.n4.WebSockets}).build(),this.hubConnection.on("bazar.package.avilable."+t,h=>{this.downloadBazarItem(i,t)}),this.hubConnection.start().then(()=>{this.downloadBazarItem(i,t)})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(_.uw),e.Y36(x.a),e.Y36(N.I),e.Y36(D.K),e.Y36(C.Q),e.Y36(O.E),e.Y36(s.m))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-manage-databases"]],decls:42,vars:9,consts:[[1,"row","mt-4"],[1,"col-md-6","col-12","pe-lg-5"],[1,"row"],[1,"col-12"],[1,"fw-bold"],[1,"text-muted"],[1,"col-12","mt-3","mb-5"],[1,"d-flex","flex-nowrap","align-items-stretch","w-100"],[1,"w-65","standalone-field"],["matPrefix","","matTooltip","Give your database a new name",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],["matInput","","type","text","name","-","autocomplete","off","placeholder","Name of database",3,"ngModel","pattern","ngModelChange"],[1,"p-2"],["mat-flat-button","","color","primary","type","submit",1,"w-35",3,"click"],[4,"ngIf"],[1,"col-md-6","col-12","position-relative","ps-lg-5"],["class","table-responsive mt-3",4,"ngIf"],[1,"text-end","button-row","mt-3","w-100","upload-backup-row"],["mat-flat-button","","color","primary",3,"click"],["type","file","accept",".db",1,"d-none",3,"ngModel","ngModelChange","change"],["zipfile",""],["class","waiting-overlay",4,"ngIf"],["amount","3","colClass","col-12","blockHeight","80px","hasShadow","false"],["class","col-12 bg-light mt-4 py-3 mb-2",4,"ngFor","ngForOf"],[1,"col-12","bg-light","mt-4","py-3","mb-2"],[1,"col-xl-7","col-lg-6","col-12","ps-4"],[1,"mat-body-2","mb-1"],[1,"text-muted","text-truncate","my-0"],[1,"col-xl-5","col-lg-6","col-12","d-flex","flex-nowrap","align-self-center","justifycontent-between","mt-lg-0","mt-3"],["mat-button","","color","primary",3,"click"],["mat-flat-button","","color","primary","class","w-100 px-4 ms-2",3,"click",4,"ngIf"],["mat-flat-button","","color","warn","class","w-100 px-4 ms-2",3,"click",4,"ngIf"],["mat-flat-button","","color","primary",1,"w-100","px-4","ms-2",3,"click"],["mat-flat-button","","color","warn",1,"w-100","px-4","ms-2",3,"click"],["amount","8","colClass","col-12","blockHeight","48px","hasShadow","false"],[1,"table-responsive","mt-3"],["mat-table","",1,"w-100","borderless","hoverable",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","","class","text-nowrap ps-0",4,"matHeaderCellDef"],["mat-cell","","class","ps-0 text-truncate",4,"matCellDef"],["matColumnDef","tables"],["mat-cell","","class","ps-0",4,"matCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","ps-3",4,"matHeaderCellDef"],["mat-cell","","class","px-0",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"text-nowrap","ps-0"],["mat-cell","",1,"ps-0","text-truncate"],["mat-cell","",1,"ps-0"],["mat-header-cell","",1,"ps-3"],["mat-cell","",1,"px-0"],["mat-button","","color","primary","routerLink","/sql-studio",3,"queryParams"],["mat-button","","color","warn",3,"disabled","click"],["mat-button","","color","primary","routerLink","/endpoint-generator",3,"queryParams","disabled"],["mat-header-row",""],["mat-row",""],[1,"waiting-overlay"],[1,"row","h-100","align-items-center","justify-content-center"],[1,"col-xxl-2","col-xl-3","col-md-4","col-sm-5","col-6"],[1,"d-flex","w-100","justify-content-center"],[1,"wating-dot-animation"],[1,"text-center","mt-5"],[1,"mat-h3","text-center","mt-4"]],template:function(t,i){if(1&t){const p=e.EpF();e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h3",4),e._uU(5,"Create database"),e.qZA(),e.TgZ(6,"p",5),e._uU(7,"Create a new SQLite database below"),e.qZA()(),e.TgZ(8,"div",6)(9,"form",7)(10,"mat-form-field",8)(11,"span",9)(12,"mat-icon"),e._uU(13,"database"),e.qZA(),e.TgZ(14,"span",5),e._uU(15,"|"),e.qZA()(),e.TgZ(16,"input",10),e.NdJ("ngModelChange",function(w){return i.databaseName=w}),e.qZA(),e.TgZ(17,"mat-error"),e._uU(18),e.qZA()(),e._UZ(19,"div",11),e.TgZ(20,"button",12),e.NdJ("click",function(){return i.createNewDatabase()}),e._uU(21," Create "),e.qZA()()(),e.TgZ(22,"div",3)(23,"h3",4),e._uU(24,"Install database"),e.qZA(),e.TgZ(25,"p",5),e._uU(26,"Install an SQLite plugin database"),e.qZA()(),e.YNc(27,z,2,0,"ng-container",13),e.YNc(28,$,2,1,"ng-container",13),e.qZA()(),e.TgZ(29,"div",14)(30,"h3",4),e._uU(31,"Existing databases"),e.qZA(),e.TgZ(32,"p",5),e._uU(33,"SQLite databases you have already installed or created"),e.qZA(),e.YNc(34,G,2,0,"ng-container",13),e.YNc(35,se,13,3,"div",15),e.TgZ(36,"div",16)(37,"button",17),e.NdJ("click",function(){e.CHM(p);const w=e.MAs(40);return e.KtG(w.click())}),e._uU(38," Upload backup "),e.qZA()(),e.TgZ(39,"input",18,19),e.NdJ("ngModelChange",function(w){return i.zipFileInput=w})("change",function(w){return i.uploadDatabaseBackup(w.target.files)}),e.qZA()()(),e.YNc(41,re,9,1,"div",20)}2&t&&(e.xp6(16),e.Q6J("ngModel",i.databaseName)("pattern",i.CommonRegEx.appNameWithUppercaseHyphen),e.xp6(2),e.Oqu(i.CommonErrorMessages.appNameWithUppercaseHyphen),e.xp6(9),e.Q6J("ngIf",i.isLoadingPlugins),e.xp6(1),e.Q6J("ngIf",!i.isLoadingPlugins),e.xp6(6),e.Q6J("ngIf",i.isLoadingDbs),e.xp6(1),e.Q6J("ngIf",!i.isLoadingDbs),e.xp6(4),e.Q6J("ngModel",i.zipFileInput),e.xp6(2),e.Q6J("ngIf",i.waitingInstallation))},dependencies:[a.sg,a.O5,E.rH,F.J,q.Hw,o.lW,R.TO,R.KE,R.qo,B.Nt,l.gM,S.BZ,S.fO,S.as,S.w1,S.Dz,S.nj,S.ge,S.ev,S.XQ,S.Gk,A._Y,A.Fj,A.JJ,A.JL,A.c5,A.On,A.F],styles:['.align-items-stretch[_ngcontent-%COMP%]     .mat-form-field-wrapper{margin:0}.w-65[_ngcontent-%COMP%]{width:65%}.w-35[_ngcontent-%COMP%]{width:35%}.position-relative[_ngcontent-%COMP%]{position:relative}.position-relative[_ngcontent-%COMP%]   .v-line[_ngcontent-%COMP%]{position:absolute;left:0;top:0;bottom:0;width:1px;background-color:#f0f0f0}.bg-light[_ngcontent-%COMP%]{border-radius:10px}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}.waiting-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:1080;color:#fff;background-color:#060d16e6;animation-name:fadeIn;animation-duration:1s;animation-fill-mode:forwards}.wating-dot-animation[_ngcontent-%COMP%]{position:relative;left:-9999px;width:10px;height:10px;border-radius:5px;background-color:#0080ff;color:#0080ff;box-shadow:9999px 0 #0080ff;animation:waitingDot 1s infinite linear;animation-delay:.1s}.wating-dot-animation[_ngcontent-%COMP%]:before, .wating-dot-animation[_ngcontent-%COMP%]:after{content:"";display:inline-block;position:absolute;top:0}.wating-dot-animation[_ngcontent-%COMP%]:before{width:10px;height:10px;border-radius:5px;background-color:#0080ff;color:#0080ff;animation:waitingDotBefore 1s infinite linear;animation-delay:0s}.wating-dot-animation[_ngcontent-%COMP%]:after{width:10px;height:10px;border-radius:5px;background-color:#0080ff;color:#0080ff;animation:waitingDotAfter 1s infinite linear;animation-delay:.2s}@keyframes waitingDot{0%{box-shadow:9999px -15px #9880ff00}25%,50%,75%{box-shadow:9999px 0 #0080ff}to{box-shadow:9999px 15px #9880ff00}}@keyframes waitingDotBefore{0%{box-shadow:9984px -15px #9880ff00}25%,50%,75%{box-shadow:9984px 0 #0080ff}to{box-shadow:9984px 15px #9880ff00}}@keyframes waitingDotAfter{0%{box-shadow:10014px -15px #9880ff00}25%,50%,75%{box-shadow:10014px 0 #0080ff}to{box-shadow:10014px 15px #9880ff00}}.table-responsive[_ngcontent-%COMP%]   .text-truncate[_ngcontent-%COMP%]{max-width:10vw}@media (min-width: 768px){.create-btn[_ngcontent-%COMP%]{height:43px;margin-top:3px}}@media (max-width: 767px){.create-btn[_ngcontent-%COMP%]{width:100%;height:44px}}.upload-backup-row[_ngcontent-%COMP%]{position:absolute;bottom:0;right:0}']}),n})(),ce=(()=>{class n{constructor(t,i,p,h){this.sqlService=t,this.generalService=i,this.data=p,this.dialogRef=h,this.waitingCreation=!1,this.name="",this.CommonRegEx=P.g,this.CommonErrorMessages=I.v}save(){""===this.name&&this.generalService.showFeedback("Name is required","errorMessage"),this.CommonRegEx.appNameWithUppercase.test(this.name)?(this.waitingCreation=!0,this.sqlService.createDatabase(this.data.dbTypeValue,this.data.cStringKey,this.name).subscribe({next:()=>{this.generalService.showFeedback("Catalog successfully created","successMessage"),this.dialogRef.close()},error:t=>{this.generalService.showFeedback(t?.error?.message??t,"errorMessage","Ok",4e3)}})):this.generalService.showFeedback(this.CommonErrorMessages.appNameWithUppercase,"errorMessage")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(x.a),e.Y36(s.m),e.Y36(_.WI),e.Y36(_.so))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-catalog-name"]],decls:18,vars:5,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"w-100","standalone-field"],["matPrefix","","matTooltip","Catalog or database name",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],[1,"text-muted"],["matInput","","type","text","name","-","placeholder","Catalog name","autocomplete","off",3,"ngModel","pattern","ngModelChange"],["mat-dialog-actions","",3,"align"],["mat-button","","mat-dialog-close","","color","primary","type","button"],["mat-flat-button","","color","primary","type","submit",1,"px-5",3,"disabled","click"]],template:function(t,i){1&t&&(e.TgZ(0,"h3",0),e._uU(1,"Give your catalog a name"),e.qZA(),e.TgZ(2,"form")(3,"div",1)(4,"mat-form-field",2)(5,"span",3)(6,"mat-icon"),e._uU(7,"database"),e.qZA(),e.TgZ(8,"span",4),e._uU(9,"|"),e.qZA()(),e.TgZ(10,"input",5),e.NdJ("ngModelChange",function(h){return i.name=h}),e.qZA(),e.TgZ(11,"mat-error"),e._uU(12),e.qZA()()(),e.TgZ(13,"div",6)(14,"button",7),e._uU(15," Cancel "),e.qZA(),e.TgZ(16,"button",8),e.NdJ("click",function(){return i.save()}),e._uU(17," Save "),e.qZA()()()),2&t&&(e.xp6(10),e.Q6J("ngModel",i.name)("pattern",i.CommonRegEx.appNameWithUppercase),e.xp6(2),e.Oqu(i.CommonErrorMessages.appNameWithUppercase),e.xp6(1),e.Q6J("align","end"),e.xp6(3),e.Q6J("disabled",i.waitingCreation))},dependencies:[q.Hw,o.lW,R.TO,R.KE,R.qo,B.Nt,_.ZT,_.uh,_.xY,_.H8,l.gM,A._Y,A.Fj,A.JJ,A.JL,A.c5,A.On,A.F],encapsulation:2}),n})();var de=r(316);function me(n,m){1&n&&(e.TgZ(0,"th",18),e._uU(1,"Name"),e.qZA())}function pe(n,m){if(1&n&&(e.TgZ(0,"td",19),e._uU(1),e.qZA()),2&n){const t=m.$implicit;e.xp6(1),e.Oqu(null==t?null:t.name)}}function ue(n,m){1&n&&(e.TgZ(0,"th",20),e._uU(1,"Tables"),e.qZA())}function ge(n,m){if(1&n&&(e.TgZ(0,"td",19),e._uU(1),e.qZA()),2&n){const t=m.$implicit;let i;e.xp6(1),e.Oqu(null!==(i=null==t||null==t.tables?null:t.tables.length)&&void 0!==i?i:0)}}function _e(n,m){1&n&&(e.TgZ(0,"th",18),e._uU(1,"Actions"),e.qZA())}const K=function(n,m,t){return{dbType:n,dbName:m,dbCString:t}};function he(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"td",19)(1,"button",21),e._uU(2," Edit "),e.qZA(),e.TgZ(3,"button",22),e.NdJ("click",function(){const h=e.CHM(t).$implicit,w=e.oxw(2);return e.KtG(w.deleteCatalog(h))}),e._uU(4," Delete "),e.qZA(),e.TgZ(5,"button",23),e._uU(6," Generate endpoints "),e.qZA()()}if(2&n){const t=m.$implicit,i=e.oxw(2);e.xp6(1),e.Q6J("queryParams",e.kEZ(2,K,i.data.item.dbTypeValue,t.name,i.data.item.cStringKey)),e.xp6(4),e.Q6J("queryParams",e.kEZ(6,K,i.data.item.dbTypeValue,t.name,i.data.item.cStringKey))}}function fe(n,m){1&n&&e._UZ(0,"tr",24)}function be(n,m){if(1&n&&e._UZ(0,"tr",25),2&n){const t=m.$implicit,i=e.oxw(2);e.ekj("d-none",i.filter&&-1===t.name.indexOf(i.filter))}}function Ce(n,m){if(1&n&&(e.TgZ(0,"div",8)(1,"table",9),e.ynx(2,10),e.YNc(3,me,2,0,"th",11),e.YNc(4,pe,2,1,"td",12),e.BQk(),e.ynx(5,13),e.YNc(6,ue,2,0,"th",14),e.YNc(7,ge,2,1,"td",12),e.BQk(),e.ynx(8,15),e.YNc(9,_e,2,0,"th",11),e.YNc(10,he,7,10,"td",12),e.BQk(),e.YNc(11,fe,1,0,"tr",16),e.YNc(12,be,1,2,"tr",17),e.qZA()()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("dataSource",t.data.list),e.xp6(10),e.Q6J("matHeaderRowDef",t.displayedColumns)("matHeaderRowDefSticky",!0),e.xp6(1),e.Q6J("matRowDefColumns",t.displayedColumns)}}let ve=(()=>{class n{constructor(t,i,p,h){this.dialog=t,this.sqlService=i,this.generalService=p,this.data=h,this.filter=null,this.displayedColumns=["name","tables","action"]}deleteCatalog(t){this.dialog.open(f.z,{width:"500px",data:{title:"Delete database",description_extra:`You are deleting the following database: <br/> <span class="fw-bold">${t.name}</span> <br/><br/> Do you want to continue?`,action_btn:"Delete",action_btn_color:"warn",bold_description:!0,extra:{details:t,action:"confirmInput",fieldToBeTypedTitle:"database name",fieldToBeTypedValue:t.name,icon:"database"}}}).afterClosed().subscribe(i=>{"confirm"===i&&(this.generalService.showLoading(),this.sqlService.dropDatabase(this.data.item.dbTypeValue,this.data.item.cStringKey,t.name).subscribe({next:()=>{this.generalService.hideLoading(),this.data.list=this.data.list.filter(p=>p.name!==t.name),this.generalService.showFeedback("Database successfully deleted","successMessage")},error:p=>{this.generalService.showFeedback(p?.error?.message??p,"errorMessage"),this.generalService.hideLoading()}}))})}filterList(t){this.filter=t.searchKey}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(_.uw),e.Y36(x.a),e.Y36(s.m),e.Y36(_.WI))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-manage-catalogs"]],decls:10,vars:2,consts:[[1,"d-flex","justify-content-between","align-items-center","mb-3"],["mat-dialog-title","",1,"mb-0"],[1,"searchbox"],[3,"filterList"],["mat-dialog-content",""],["class","table-responsive",4,"ngIf"],["mat-dialog-actions","",3,"align"],["mat-flat-button","","mat-dialog-close","","color","primary"],[1,"table-responsive"],["mat-table","",1,"w-100","borderless","hoverable",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","tables"],["mat-header-cell","","class","text-nowrap",4,"matHeaderCellDef"],["matColumnDef","action"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"d-none",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-cell","",1,"text-nowrap"],["mat-button","","color","primary","routerLink","/sql-studio","mat-dialog-close","",3,"queryParams"],["mat-button","","color","warn",1,"ms-3",3,"click"],["mat-button","","color","primary","routerLink","/endpoint-generator","mat-dialog-close","",1,"ms-3",3,"queryParams"],["mat-header-row",""],["mat-row",""]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"h3",1),e._uU(2,"List of catalogs"),e.qZA(),e.TgZ(3,"div",2)(4,"app-searchbox",3),e.NdJ("filterList",function(h){return i.filterList(h)}),e.qZA()()(),e.TgZ(5,"div",4),e.YNc(6,Ce,13,4,"div",5),e.qZA(),e.TgZ(7,"div",6)(8,"button",7),e._uU(9," Close "),e.qZA()()),2&t&&(e.xp6(6),e.Q6J("ngIf",i.data.list),e.xp6(1),e.Q6J("align","end"))},dependencies:[a.O5,E.rH,de.E,o.lW,_.ZT,_.uh,_.xY,_.H8,S.BZ,S.fO,S.as,S.w1,S.Dz,S.nj,S.ge,S.ev,S.XQ,S.Gk],styles:[".searchbox[_ngcontent-%COMP%]{width:250px}.table-responsive[_ngcontent-%COMP%]   .text-truncate[_ngcontent-%COMP%]{max-width:10vw}"]}),n})();var xe=r(4425),ye=r(2910),Te=r(4385),we=r(3238);function Se(n,m){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.hij(" Your cloudlet's IP address is ",t.ip_address,". ")}}function Me(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"button",21),e.NdJ("click",function(){e.CHM(t);const p=e.oxw();return e.KtG(p.copyIpAddress())}),e._uU(1,"Copy IP address "),e.qZA()}}function De(n,m){if(1&n&&(e.TgZ(0,"mat-option",22),e._uU(1),e.qZA()),2&n){const t=m.$implicit;e.Q6J("value",t.type),e.xp6(1),e.Oqu(t.name)}}function Ue(n,m){1&n&&(e.ynx(0),e._UZ(1,"app-loading-skeleton",23),e.BQk())}function Ze(n,m){1&n&&(e.TgZ(0,"th",39),e._uU(1,"Type"),e.qZA())}function Ie(n,m){if(1&n&&(e.TgZ(0,"td",40),e._uU(1),e.qZA()),2&n){const t=m.$implicit;e.xp6(1),e.Oqu(null==t?null:t.dbType)}}function Ee(n,m){1&n&&(e.TgZ(0,"th",39),e._uU(1,"Name"),e.qZA())}function ke(n,m){if(1&n&&(e.TgZ(0,"td",41),e._uU(1),e.qZA()),2&n){const t=m.$implicit;e.xp6(1),e.Oqu(null==t?null:t.cStringKey)}}function Ae(n,m){1&n&&(e.TgZ(0,"th",39),e._uU(1,"Connection string"),e.qZA())}function Oe(n,m){if(1&n&&(e.TgZ(0,"td",41),e._uU(1),e.qZA()),2&n){const t=m.$implicit;e.xp6(1),e.Oqu(null==t?null:t.cString)}}function Pe(n,m){1&n&&(e.TgZ(0,"th",39),e._uU(1,"Status"),e.qZA())}function Ne(n,m){if(1&n&&(e.TgZ(0,"td",40)(1,"div",42),e._UZ(2,"span"),e.qZA()()),2&n){const t=m.$implicit;e.xp6(2),e.Gre("status ",null==t?null:t.status," me-1")}}function Le(n,m){1&n&&(e.TgZ(0,"th",43),e._uU(1," Actions "),e.qZA())}function Re(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"td",44)(1,"div",45)(2,"button",17),e.NdJ("click",function(){const h=e.CHM(t).$implicit,w=e.oxw(2);return e.KtG(w.manageCatalogs(h))}),e._uU(3," Manage "),e.qZA(),e.TgZ(4,"button",46),e.NdJ("click",function(){const h=e.CHM(t).$implicit,w=e.oxw(2);return e.KtG(w.deleteConnectionString(h))}),e._uU(5," Delete "),e.qZA(),e.TgZ(6,"button",47),e.NdJ("click",function(){const h=e.CHM(t).$implicit,w=e.oxw(2);return e.KtG(w.copyConnectionString(h))}),e._uU(7," Copy "),e.qZA(),e.TgZ(8,"button",17),e.NdJ("click",function(){const h=e.CHM(t).$implicit,w=e.oxw(2);return e.KtG(w.createCatalog(h))}),e._uU(9," Create catalog "),e.qZA()()()}if(2&n){const t=m.$implicit;e.xp6(2),e.Q6J("disabled",!0===t.isClicked||"Live"!==t.status),e.xp6(2),e.Q6J("disabled","magic"===t.name),e.xp6(4),e.Q6J("disabled","Live"!==t.status)}}function Fe(n,m){1&n&&e._UZ(0,"tr",48)}function qe(n,m){1&n&&e._UZ(0,"tr",49)}function Be(n,m){1&n&&(e.TgZ(0,"tr",50)(1,"td",51),e._uU(2,"You have not connected to any external databases"),e.qZA()())}function Je(n,m){if(1&n&&(e.TgZ(0,"div",24)(1,"table",25),e.ynx(2,26),e.YNc(3,Ze,2,0,"th",27),e.YNc(4,Ie,2,1,"td",28),e.BQk(),e.ynx(5,29),e.YNc(6,Ee,2,0,"th",27),e.YNc(7,ke,2,1,"td",30),e.BQk(),e.ynx(8,31),e.YNc(9,Ae,2,0,"th",27),e.YNc(10,Oe,2,1,"td",30),e.BQk(),e.ynx(11,32),e.YNc(12,Pe,2,0,"th",27),e.YNc(13,Ne,3,3,"td",28),e.BQk(),e.ynx(14,33),e.YNc(15,Le,2,0,"th",34),e.YNc(16,Re,10,3,"td",35),e.BQk(),e.YNc(17,Fe,1,0,"tr",36),e.YNc(18,qe,1,0,"tr",37),e.YNc(19,Be,3,0,"tr",38),e.qZA()()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("dataSource",t.databases),e.xp6(16),e.Q6J("matHeaderRowDef",t.displayedColumns)("matHeaderRowDefSticky",!0),e.xp6(1),e.Q6J("matRowDefColumns",t.displayedColumns)}}let Ye=(()=>{class n{constructor(t,i,p,h,w,J,Y){this.dialog=t,this.cdr=i,this.sqlService=p,this.clipboard=h,this.diagnosticService=w,this.configService=J,this.generalService=Y,this.configFile={},this.dbTypes=[{name:"MySQL",type:"mysql"},{name:"PostgreSQL",type:"pgsql"},{name:"SQL Server",type:"mssql"}],this.databaseType="mysql",this.connectionString="",this.cStringName="",this.databases=[],this.waitingTest=!1,this.displayedColumns=["dbType","cStringName","cString","status","actions"],this.isLoading=!0,this.ip_address="unknown",this.CommonRegEx=P.g,this.CommonErrorMessages=I.v}ngOnInit(){this.loadConfig(),this.getIPAddress()}copyConnectionString(t){this.clipboard.copy(t.cString),this.generalService.showFeedback("Connection string can be found on your clipboard")}copyIpAddress(){this.clipboard.copy(this.ip_address),this.generalService.showFeedback("Cloudlet's IP address can be found on your clipboard")}testConnectionString(t){""!==this.cStringName&&""!==this.connectionString?this.connectionString.includes("{database}")?this.CommonRegEx.appNameWithUppercase.test(this.cStringName)?this.configFile.databases[this.databaseType]?.[this.cStringName]?this.generalService.showFeedback("A connection string with that name already exists","errorMessage"):t&&"generic"===this.cStringName?this.dialog.open(f.z,{width:"500px",data:{title:"Use as default database?",description:"Do you want to use this connection string as your default database and connection string?",action_btn:"Yes",close_btn:"No"}}).afterClosed().subscribe(i=>{"confirm"!==i?this.testConnectionStringImplementation(t):this.testConnectionStringImplementation(t,!0)}):this.testConnectionStringImplementation(t):this.generalService.showFeedback(this.CommonErrorMessages.appNameWithUppercase,"errorMessage"):this.generalService.showFeedback("Your connection string must have a {database} part","errorMessage"):this.generalService.showFeedback("Please provide both connection name and string","errorMessage")}deleteConnectionString(t){this.dialog.open(f.z,{width:"500px",data:{title:"Delete connection string",description_extra:`You are deleting the following ${t.dbType} connection string: <br/> <span class="fw-bold">${t.cStringKey}</span>.<br/><br/>Do you want to continue?`,action_btn:"Delete",action_btn_color:"warn",bold_description:!0,extra:{details:t,action:"confirmInput",fieldToBeTypedTitle:"connection string's name",fieldToBeTypedValue:t.cStringKey,icon:"conversion_path"}}}).afterClosed().subscribe(i=>{"confirm"===i&&(t.isClicked=!0,this.sqlService.deleteConnectionString(t.dbTypeValue,t.cStringKey).subscribe({next:()=>{t.isClicked=!1,this.generalService.showFeedback("Connection string was deleted","successMessage"),this.databases=this.databases.filter(p=>t!==p)},error:p=>{t.isClicked=!1,this.generalService.showFeedback(p?.error?.message??p,"errorMessage")}}))})}createCatalog(t){this.dialog.open(ce,{width:"500px",data:t})}manageCatalogs(t){t.isClicked=!0,this.generalService.showLoading(),this.sqlService.getDatabaseMetaInfo(t.dbTypeValue,t.cStringKey).subscribe({next:i=>{i?this.dialog.open(ve,{width:"800px",data:{list:i.databases,item:t}}):this.generalService.showFeedback("No database was found.",null,"Ok",4e3),t.isClicked=!1,this.generalService.hideLoading()},error:i=>{this.generalService.showFeedback(i?.error?.message??i,"errorMessage"),t.isClicked=!1,this.generalService.hideLoading()}})}testConnectionStringImplementation(t,i=!1){this.generalService.showLoading(),this.waitingTest=!0,this.configService.testConnectionString(this.databaseType,this.connectionString).subscribe({next:p=>{if("success"===p.result){if(t)return void this.addConnectionString(i);this.waitingTest=!1,this.generalService.showFeedback("Success","successMessage"),this.generalService.hideLoading()}else"failure"===p.result&&(this.waitingTest=!1,this.generalService.showFeedback(p.message,"errorMessage","Ok",5e3),this.generalService.hideLoading())},error:p=>{this.waitingTest=!1,this.generalService.showFeedback(p?.error?.message??p,"errorMessage"),this.generalService.hideLoading()}})}getIPAddress(){this.diagnosticService.getSystemReport().subscribe({next:t=>{this.ip_address=t.server_ip||"unknown",this.cdr.detectChanges()},error:t=>this.generalService.showFeedback(t?.error?.message??t,"errorMessage")})}loadConfig(){this.configService.loadConfig().subscribe({next:t=>{this.configFile=t.magic;let i=[];this.dbTypes.forEach(p=>{for(const h in this.configFile.databases[p.type])i.push({dbType:p.name,dbTypeValue:p.type,cString:this.configFile.databases[p.type][h],status:"testing ...",cStringKey:h,isClicked:!1}),this.databases=[...i]}),this.isLoading=!1,this.getStatus()},error:t=>this.generalService.showFeedback(t?.error?.message??t,"errorMessage")})}getStatus(){this.databases.forEach(t=>{this.configService.testConnectionString(t.dbTypeValue,t.cString).subscribe({next:i=>{t.status="failure"===i.result?"Down":"Live"},error:()=>{t.status="Down"}})})}addConnectionString(t=!1){this.sqlService.addConnectionString(this.databaseType,this.cStringName,this.connectionString,t).subscribe({next:()=>{this.generalService.showFeedback("Successfully connected to database","successMessage"),this.waitingTest=!1,this.databases=[...this.databases,{dbType:this.dbTypes.find(i=>i.type===this.databaseType).name,dbTypeValue:this.databaseType,cString:this.connectionString,status:"Live",cStringKey:this.cStringName,isClicked:!1}],this.generalService.hideLoading(),this.cdr.detectChanges(),this.cStringName="",this.connectionString=""},error:i=>{this.waitingTest=!1,this.generalService.showFeedback(i?.error?.message??i,"errorMessage")}})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(_.uw),e.Y36(e.sBO),e.Y36(x.a),e.Y36(xe.TU),e.Y36(ye.w),e.Y36(O.E),e.Y36(s.m))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-connect-databases"]],decls:48,vars:14,consts:[[1,"row","mt-4"],[1,"col-12"],[1,"fw-bold"],[1,"text-muted"],[4,"ngIf"],["mat-button","","color","primary","class","ps-0 ip-address-btn",3,"click",4,"ngIf"],[1,"row","align-items-stretch","mt-4"],[1,"col-lg-3","col-md-4","col-sm-6","col-12"],[1,"w-100","standalone-field"],["matPrefix","","matTooltip","Database type",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],["placeholder","Database type",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["matPrefix","","matTooltip","Unique name for your connection string",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],["matInput","","type","text","placeholder","Connection name","autocomplete","off","spellcheck","false",3,"ngModel","pattern","ngModelChange"],["matPrefix","","matTooltip","Connection string",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],["matInput","","type","text","placeholder","Connection string","spellcheck","false","autocomplete","off",3,"ngModel","ngModelChange"],[1,"col-lg-3","col-md-12","col-sm-6","col-12","d-flex","align-items-center","button-row","justify-content-end","mt-md-2","mt-lg-1","mt-sm-2","mt-2"],["mat-button","","color","primary",3,"disabled","click"],["mat-flat-button","","color","primary",1,"px-xxl-5","px-xl-4",3,"disabled","click"],[1,"col-12","mt-5"],["class","table-responsive",4,"ngIf"],["mat-button","","color","primary",1,"ps-0","ip-address-btn",3,"click"],[3,"value"],["amount","3","colClass","col-12","blockHeight","48px","hasShadow","false"],[1,"table-responsive"],["mat-table","",1,"w-100","borderless","hoverable",3,"dataSource"],["matColumnDef","dbType"],["mat-header-cell","","class","text-nowrap ps-0",4,"matHeaderCellDef"],["mat-cell","","class","ps-0",4,"matCellDef"],["matColumnDef","cStringName"],["mat-cell","","class","ps-0 text-truncate",4,"matCellDef"],["matColumnDef","cString"],["matColumnDef","status"],["matColumnDef","actions"],["mat-header-cell","","class","px-3",4,"matHeaderCellDef"],["mat-cell","","class","px-0",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["mat-header-cell","",1,"text-nowrap","ps-0"],["mat-cell","",1,"ps-0"],["mat-cell","",1,"ps-0","text-truncate"],[1,"d-flex","align-items-center","text-truncate","ps-3"],["mat-header-cell","",1,"px-3"],["mat-cell","",1,"px-0"],[1,"d-flex"],["mat-button","","color","warn",3,"disabled","click"],["mat-button","","color","primary",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","5",1,"mat-cell","ps-0","text-muted"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h3",2),e._uU(3,"Add connection string"),e.qZA(),e.TgZ(4,"p",3),e._uU(5),e.YNc(6,Se,2,1,"span",4),e._uU(7," To use another database as your default database, name your connection string 'generic' and answer yes when asked if you want to change the default database as you connect to it. "),e.YNc(8,Me,2,0,"button",5),e.qZA()(),e.TgZ(9,"div",1)(10,"div",6)(11,"div",7)(12,"mat-form-field",8)(13,"span",9)(14,"mat-icon"),e._uU(15,"database"),e.qZA(),e.TgZ(16,"span",3),e._uU(17,"|"),e.qZA()(),e.TgZ(18,"mat-select",10),e.NdJ("ngModelChange",function(h){return i.databaseType=h}),e.YNc(19,De,2,2,"mat-option",11),e.qZA()()(),e.TgZ(20,"div",7)(21,"mat-form-field",8)(22,"span",12)(23,"mat-icon"),e._uU(24,"edit"),e.qZA(),e.TgZ(25,"span",3),e._uU(26,"|"),e.qZA()(),e.TgZ(27,"input",13),e.NdJ("ngModelChange",function(h){return i.cStringName=h}),e.qZA(),e.TgZ(28,"mat-error"),e._uU(29),e.qZA()()(),e.TgZ(30,"div",7)(31,"mat-form-field",8)(32,"span",14)(33,"mat-icon"),e._uU(34,"conversion_path"),e.qZA(),e.TgZ(35,"span",3),e._uU(36,"|"),e.qZA()(),e.TgZ(37,"input",15),e.NdJ("ngModelChange",function(h){return i.connectionString=h}),e.qZA()()(),e.TgZ(38,"div",16)(39,"button",17),e.NdJ("click",function(){return i.testConnectionString(!1)}),e._uU(40," Test connection "),e.qZA(),e.TgZ(41,"button",18),e.NdJ("click",function(){return i.testConnectionString(!0)}),e._uU(42," Connect "),e.qZA()()()(),e.TgZ(43,"div",19)(44,"h3",2),e._uU(45,"Connection strings"),e.qZA(),e.YNc(46,Ue,2,0,"ng-container",4),e.YNc(47,Je,20,4,"div",20),e.qZA()()),2&t&&(e.xp6(5),e.AsE(" Connect to an existing database by providing a connection name and a connection string substituting catalog name with ","{","database","}",". "),e.xp6(1),e.Q6J("ngIf",i.ip_address&&"unknown"!==i.ip_address),e.xp6(2),e.Q6J("ngIf","unknown"!==i.ip_address),e.xp6(10),e.Q6J("ngModel",i.databaseType),e.xp6(1),e.Q6J("ngForOf",i.dbTypes),e.xp6(8),e.Q6J("ngModel",i.cStringName)("pattern",i.CommonRegEx.appNameWithUppercase),e.xp6(2),e.Oqu(i.CommonErrorMessages.appNameWithUppercase),e.xp6(8),e.Q6J("ngModel",i.connectionString),e.xp6(2),e.Q6J("disabled",i.waitingTest),e.xp6(2),e.Q6J("disabled",i.waitingTest),e.xp6(5),e.Q6J("ngIf",i.isLoading),e.xp6(1),e.Q6J("ngIf",!i.isLoading))},dependencies:[a.sg,a.O5,F.J,q.Hw,o.lW,R.TO,R.KE,R.qo,B.Nt,l.gM,S.BZ,S.fO,S.as,S.w1,S.Dz,S.nj,S.ge,S.ev,S.XQ,S.Gk,S.Ee,Te.gD,we.ey,A.Fj,A.JJ,A.c5,A.On],styles:[".table-responsive[_ngcontent-%COMP%]   .text-truncate[_ngcontent-%COMP%]{max-width:40vw}.status[_ngcontent-%COMP%]{min-width:7px;min-height:7px;width:7px;height:7px;border-radius:50%;background-color:#828282}.status.Live[_ngcontent-%COMP%]{background-color:#27ae60}.status.Down[_ngcontent-%COMP%]{background-color:#eb5757}.ip-address-btn[_ngcontent-%COMP%]{font-size:13px}"]}),n})();function Qe(n,m){1&n&&e._uU(0,"Manage")}function Ke(n,m){1&n&&e._UZ(0,"app-manage-databases")}function ze(n,m){1&n&&e._uU(0,"Connect")}function We(n,m){1&n&&e._UZ(0,"app-connect-databases")}const He=[{path:"",component:(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-databases"]],decls:10,vars:0,consts:[["mat-stretch-tabs","","dynamicHeight","","animationDuration","0ms"],["tabs",""],["mat-tab-label",""],["matTabContent",""]],template:function(t,i){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-content")(2,"mat-tab-group",0,1)(4,"mat-tab"),e.YNc(5,Qe,1,0,"ng-template",2),e.YNc(6,Ke,1,0,"ng-template",3),e.qZA(),e.TgZ(7,"mat-tab"),e.YNc(8,ze,1,0,"ng-template",2),e.YNc(9,We,1,0,"ng-template",3),e.qZA()()()())},dependencies:[c.SP,c.uD,c.uX,c.Vc,T.a8,T.dn,le,Ye],encapsulation:2}),n})()}];let je=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[E.Bz.forChild(He),E.Bz]}),n})();var $e=r(7832),Ge=r(2278),Ve=r(1075);let Xe=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[a.ez,je,$e.K,Ge.q,A.u5,Ve.m]}),n})()},4327:function(L,U){var e;void 0!==(e=function(){"use strict";function T(s,o,l){var d=new XMLHttpRequest;d.open("GET",s),d.responseType="blob",d.onload=function(){D(d.response,o,l)},d.onerror=function(){console.error("could not download file")},d.send()}function Z(s){var o=new XMLHttpRequest;o.open("HEAD",s,!1);try{o.send()}catch{}return 200<=o.status&&299>=o.status}function f(s){try{s.dispatchEvent(new MouseEvent("click"))}catch{var o=document.createEvent("MouseEvents");o.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),s.dispatchEvent(o)}}var b="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,_=b.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),D=b.saveAs||("object"!=typeof window||window!==b?function(){}:"download"in HTMLAnchorElement.prototype&&!_?function(s,o,l){var d=b.URL||b.webkitURL,u=document.createElement("a");u.download=o=o||s.name||"download",u.rel="noopener","string"==typeof s?(u.href=s,u.origin===location.origin?f(u):Z(u.href)?T(s,o,l):f(u,u.target="_blank")):(u.href=d.createObjectURL(s),setTimeout(function(){d.revokeObjectURL(u.href)},4e4),setTimeout(function(){f(u)},0))}:"msSaveOrOpenBlob"in navigator?function(s,o,l){if(o=o||s.name||"download","string"!=typeof s)navigator.msSaveOrOpenBlob(function c(s,o){return typeof o>"u"?o={autoBom:!1}:"object"!=typeof o&&(console.warn("Deprecated: Expected third argument to be a object"),o={autoBom:!o}),o.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(s.type)?new Blob(["\ufeff",s],{type:s.type}):s}(s,l),o);else if(Z(s))T(s,o,l);else{var d=document.createElement("a");d.href=s,d.target="_blank",setTimeout(function(){f(d)})}}:function(s,o,l,d){if((d=d||open("","_blank"))&&(d.document.title=d.document.body.innerText="downloading..."),"string"==typeof s)return T(s,o,l);var u="application/octet-stream"===s.type,g=/constructor/i.test(b.HTMLElement)||b.safari,M=/CriOS\/[\d]+/.test(navigator.userAgent);if((M||u&&g||_)&&typeof FileReader<"u"){var v=new FileReader;v.onloadend=function(){var I=v.result;I=M?I:I.replace(/^data:[^;]*;/,"data:attachment/file;"),d?d.location.href=I:location=I,d=null},v.readAsDataURL(s)}else{var y=b.URL||b.webkitURL,k=y.createObjectURL(s);d?d.location=k:location.href=k,d=null,setTimeout(function(){y.revokeObjectURL(k)},4e4)}});b.saveAs=D.saveAs=D,L.exports=D}.apply(U,[]))&&(L.exports=e)}}]);