(self.webpackChunkmagic=self.webpackChunkmagic||[]).push([[757],{9554:(E,Z,r)=>{"use strict";r.d(Z,{v:()=>n});const n={name:"Name must be minimum 2 characters long",backendname:"Alphanumeric characters between 2 to 20 (no space).",username:"Alphanumeric between 2 and 20 characters (no space)",email:"Email must be a valid email address",confirmEmail:"Email addresses must match",confirmPassword:"Passwords must match",currentPassword:"Your password is incorrect",cloudletName:"Minimum of 5 characters, only lowercase and numbers",phone:"e.g. 1111111111",subject:"2 to 30 letters, without special characters",message:"Message cannot be less than 3 characters",appNames:"Only lowercase alphanumeric characters, dot (.), - or _ please",appNamesWithUppercaseDot:"Only alphanumeric characters, dot (.), - or _ please",appNamesWithDot:"Only lowercase alphanumeric characters, and - or _ please",appNameWithUppercase:"Accepts alphanumeric characters and _",appNameWithUppercaseHyphen:"Accepts alphanumeric characters, - and _",domain:"Domain is not valid",backend:"Backend URL must contain http://",password:"Minimum 12 characters",recaptcha:"Not valid reCAPTCHA secret or key"}},8194:(E,Z,r)=>{"use strict";r.d(Z,{g:()=>n});const n={phone:/^[0-9 ]*$/,name:/^[a-z0-9]{2,20}$/,subject:/^.{4,1000}$/,appNames:/^[a-z0-9_.-]+$/,appNamesWithDot:/^[a-z0-9_.-]+$/,appNamesWithUppercaseDot:/^[a-zA-Z0-9_.-]+$/,appNameWithUppercase:/^[a-zA-Z0-9_]+$/,appNameWithUppercaseHyphen:/^[a-zA-Z0-9_-]+$/,domain:/(^https?:\/\/)([\w\-])+\.{1}([a-zA-Z]{2,63})([\/\w-]*)*\/?\??([^#\n\r]*)?#?([^\n\r]*)/,backend:/^https?:\/\/([\w\-.])+(:[0-9]*)?(\.\w+)?$/,email:/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/,password:/^.{12,}$/,recaptcha:/^([a-zA-Z-_0-9]{20,100})$/}},7832:(E,Z,r)=>{"use strict";r.d(Z,{K:()=>e});var n=r(6895),U=r(2278),i=r(4006),x=r(1103),S=r(4650);let e=(()=>{class g{}return g.\u0275fac=function(y){return new(y||g)},g.\u0275mod=S.oAB({type:g}),g.\u0275inj=S.cJS({imports:[n.ez,U.q,i.u5,i.UX,x.k]}),g})()},6996:(E,Z,r)=>{"use strict";r.d(Z,{z:()=>d});var n=r(4006),U=r(5938),i=r(4650),x=r(3885),S=r(6895),e=r(7392),g=r(4859),v=r(9549),y=r(4144),f=r(266);function l(C,M){if(1&C&&i._UZ(0,"p",8),2&C){const h=i.oxw();i.Q6J("innerHTML",h.data.description_extra,i.oJD)}}function u(C,M){if(1&C&&(i.TgZ(0,"mat-hint",14),i._uU(1),i.qZA()),2&C){const h=i.oxw(2);i.xp6(1),i.hij(" Inserted ",h.data.extra.fieldToBeTypedTitle," doesn't match. ")}}function p(C,M){if(1&C&&(i.ynx(0),i.TgZ(1,"mat-form-field",9)(2,"span",10)(3,"mat-icon"),i._uU(4),i.qZA(),i.TgZ(5,"span",11),i._uU(6,"|"),i.qZA()(),i._UZ(7,"input",12),i.YNc(8,u,2,1,"mat-hint",13),i.qZA(),i.BQk()),2&C){const h=i.oxw();i.xp6(2),i.MGl("matTooltip","Type in the ",h.data.extra.fieldToBeTypedTitle,""),i.xp6(2),i.Oqu(null==h.data||null==h.data.extra?null:h.data.extra.icon),i.xp6(3),i.MGl("placeholder","Type in the ",h.data.extra.fieldToBeTypedTitle,""),i.Q6J("formControl",h.inputValue),i.xp6(1),i.Q6J("ngIf",""!==h.inputValue.value&&h.data.extra.fieldToBeTypedValue!==h.inputValue.value)}}let d=(()=>{class C{constructor(h,T,D){this.generalService=h,this.dialogRef=T,this.data=D,this.inputValue=new n.NI("")}ngOnInit(){this.data.title=this.data.title??"Please confirm",this.data.description=this.data.description??"Are you sure?",this.data.action_btn_color=this.data.action_btn_color??"primary"}confirm(){!this.data.extra||!this.data.extra.details||this.inputValue.value===this.data.extra.fieldToBeTypedValue&&""!==this.inputValue.value?this.dialogRef.close("confirm"):this.generalService.showFeedback(this.data.extra.fieldToBeTypedTitle+" does not match","errorMessage",null,2e3)}}return C.\u0275fac=function(h){return new(h||C)(i.Y36(x.m),i.Y36(U.so),i.Y36(U.WI))},C.\u0275cmp=i.Xpm({type:C,selectors:[["app-confirmation-dialog"]],decls:13,vars:10,consts:[["mat-dialog-title",""],[3,"ngSubmit"],["mat-dialog-content",""],[3,"innerHTML",4,"ngIf"],[4,"ngIf"],["mat-dialog-actions","",3,"align"],["mat-button","","mat-dialog-close","","cdkFocusInitial",""],["mat-flat-button","",3,"color","click"],[3,"innerHTML"],[1,"w-100"],["matPrefix","",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2",3,"matTooltip"],[1,"text-muted"],["cdkFocusInitial","","matInput","","autocomplete","off",3,"placeholder","formControl"],["class","text-danger",4,"ngIf"],[1,"text-danger"]],template:function(h,T){1&h&&(i.TgZ(0,"h3",0),i._uU(1),i.qZA(),i.TgZ(2,"form",1),i.NdJ("ngSubmit",function(){return T.confirm()}),i.TgZ(3,"div",2)(4,"p"),i._uU(5),i.qZA(),i.YNc(6,l,1,1,"p",3),i.YNc(7,p,9,5,"ng-container",4),i.qZA(),i.TgZ(8,"div",5)(9,"button",6),i._uU(10),i.qZA(),i.TgZ(11,"button",7),i.NdJ("click",function(){return T.confirm()}),i._uU(12),i.qZA()()()),2&h&&(i.xp6(1),i.Oqu(T.data.title),i.xp6(3),i.ekj("fw-bold",T.data.bold_description),i.xp6(1),i.Oqu(T.data.description),i.xp6(1),i.Q6J("ngIf",T.data.description_extra),i.xp6(1),i.Q6J("ngIf",(null==T.data||null==T.data.extra?null:T.data.extra.details)&&"confirmInput"===(null==T.data||null==T.data.extra?null:T.data.extra.action)),i.xp6(1),i.Q6J("align","end"),i.xp6(2),i.hij(" ",T.data.close_btn||"Cancel"," "),i.xp6(1),i.s9C("color",T.data.action_btn_color),i.xp6(1),i.hij(" ",T.data.action_btn," "))},dependencies:[S.O5,e.Hw,g.lW,v.KE,v.bx,v.qo,y.Nt,U.ZT,U.uh,U.xY,U.H8,f.gM,n._Y,n.Fj,n.JJ,n.JL,n.F,n.oH],styles:["p[_ngcontent-%COMP%]{line-height:1.8}"]}),C})()},9311:(E,Z,r)=>{"use strict";r.d(Z,{J:()=>S});var n=r(4650),U=r(6895);const i=function(e){return{height:e}};function x(e,g){if(1&e&&(n.TgZ(0,"div"),n._UZ(1,"div",2),n.qZA()),2&e){const v=n.oxw();n.Tol(v.colClass),n.xp6(1),n.ekj("mat-elevation-z1",v.hasShadow),n.Q6J("ngStyle",n.VKq(5,i,v.blockHeight))}}let S=(()=>{class e{constructor(){this.amount=2,this.colClass="col-12",this.blockHeight="375px",this.hasShadow=!0,this.itemsArray=[]}ngOnInit(){for(let v=0;v<this.amount;v++)this.itemsArray.push("item"+v)}}return e.\u0275fac=function(v){return new(v||e)},e.\u0275cmp=n.Xpm({type:e,selectors:[["app-loading-skeleton"]],inputs:{amount:"amount",colClass:"colClass",blockHeight:"blockHeight",hasShadow:"hasShadow"},decls:2,vars:1,consts:[[1,"row"],[3,"class",4,"ngFor","ngForOf"],[1,"block","mb-3",3,"ngStyle"]],template:function(v,y){1&v&&(n.TgZ(0,"div",0),n.YNc(1,x,2,7,"div",1),n.qZA()),2&v&&(n.xp6(1),n.Q6J("ngForOf",y.itemsArray))},dependencies:[U.sg,U.PC],styles:[".block[_ngcontent-%COMP%]{background:#eee;background:linear-gradient(90deg,#ffffff 8%,#f2f2f2 18%,#fafafa 33%);background-size:200% 100%;animation:1s shine linear infinite;border-radius:5px;border:1px solid rgba(217,217,217,.05)}@keyframes shine{to{background-position-x:-200%}}"]}),e})()},316:(E,Z,r)=>{"use strict";r.d(Z,{E:()=>N});var n=r(4650),U=r(4006),i=r(8372),x=r(1884),S=r(6895),e=r(7392),g=r(4859),v=r(9549),y=r(4144),f=r(6709),l=r(266),u=r(4385),p=r(3238);function d(w,R){if(1&w){const _=n.EpF();n.TgZ(0,"mat-checkbox",10),n.NdJ("ngModelChange",function(k){n.CHM(_);const I=n.oxw();return n.KtG(I.checked=k)})("change",function(){n.CHM(_);const k=n.oxw();return n.KtG(k.filter())}),n._uU(1),n.qZA()}if(2&w){const _=n.oxw();n.Q6J("ngModel",_.checked),n.xp6(1),n.hij(" ",_.checkBoxText," ")}}function C(w,R){if(1&w&&(n.TgZ(0,"mat-option",15)(1,"span",17),n._uU(2),n.qZA()()),2&w){const _=R.$implicit;n.Q6J("value",_),n.xp6(2),n.Oqu(_)}}function M(w,R){if(1&w){const _=n.EpF();n.TgZ(0,"mat-form-field",11)(1,"span",12)(2,"mat-icon"),n._uU(3,"filter_list"),n.qZA(),n.TgZ(4,"span",13),n._uU(5,"|"),n.qZA()(),n.TgZ(6,"mat-select",14),n.NdJ("ngModelChange",function(k){n.CHM(_);const I=n.oxw();return n.KtG(I.type=k)})("selectionChange",function(){n.CHM(_);const k=n.oxw();return k.filter(),n.KtG(k.typeChanged())}),n.TgZ(7,"mat-option",15),n._uU(8," Remove filter "),n.qZA(),n.YNc(9,C,3,2,"mat-option",16),n.qZA()()}if(2&w){const _=n.oxw();n.xp6(6),n.Q6J("ngModel",_.type),n.xp6(1),n.Q6J("value",null),n.xp6(2),n.Q6J("ngForOf",_.types)}}function h(w,R){if(1&w){const _=n.EpF();n.TgZ(0,"button",18),n.NdJ("click",function(){n.CHM(_);const k=n.oxw();return n.KtG(k.removeSearchTerm())}),n.TgZ(1,"mat-icon"),n._uU(2,"close"),n.qZA()()}}function T(w,R){if(1&w&&(n.TgZ(0,"mat-icon"),n._uU(1),n.qZA()),2&w){const _=n.oxw(2);n.xp6(1),n.Oqu(_.buttonIcon)}}function D(w,R){if(1&w){const _=n.EpF();n.TgZ(0,"button",19),n.NdJ("click",function(){n.CHM(_);const k=n.oxw();return n.KtG(k.buttonClicked())}),n.YNc(1,T,2,1,"mat-icon",20),n._uU(2),n.qZA()}if(2&w){const _=n.oxw();n.Q6J("disabled",_.buttonDisabled),n.xp6(1),n.Q6J("ngIf",_.buttonIcon),n.xp6(1),n.hij(" ",_.buttonText," ")}}function F(w,R){if(1&w){const _=n.EpF();n.TgZ(0,"button",19),n.NdJ("click",function(){n.CHM(_);const k=n.oxw();return n.KtG(k.button2Clicked())}),n._uU(1),n.qZA()}if(2&w){const _=n.oxw();n.Q6J("disabled",_.button2Disabled),n.xp6(1),n.hij(" ",_.button2Text," ")}}let N=(()=>{class w{constructor(){this.filterList=new n.vpe,this.buttonClick=new n.vpe,this.button2Click=new n.vpe,this.typeChange=new n.vpe,this.checkBoxText=null,this.buttonText=null,this.button2Text=null,this.buttonIcon=null,this.buttonDisabled=!1,this.button2Disabled=!1,this.checked=!1}ngOnInit(){this.filterControl=new U.NI(""),this.filterControl.valueChanges.pipe((0,i.b)(400),(0,x.x)()).subscribe(()=>{this.filter()})}removeSearchTerm(){this.filterControl.setValue("")}filter(){const _={};this.filterControl.value?.length>0&&(_.searchKey=this.filterControl.value),this.type&&(_.type=this.type),this.checkBoxText&&(_.checked=this.checked),this.filterList.emit(_)}typeChanged(){this.typeChange?.emit(this.type)}buttonClicked(){this.buttonClick.emit()}button2Clicked(){this.button2Click.emit()}}return w.\u0275fac=function(_){return new(_||w)},w.\u0275cmp=n.Xpm({type:w,selectors:[["app-searchbox"]],inputs:{types:"types",type:"type",checkBoxText:"checkBoxText",buttonText:"buttonText",button2Text:"button2Text",buttonIcon:"buttonIcon",buttonDisabled:"buttonDisabled",button2Disabled:"button2Disabled"},outputs:{filterList:"filterList",buttonClick:"buttonClick",button2Click:"button2Click",typeChange:"typeChange"},decls:14,vars:6,consts:[[1,"d-flex","justify-content-md-between","align-items-md-center","align-items-end","flex-md-row","w-100"],["color","primary","class","mt-md-0 mt-1 me-3",3,"ngModel","ngModelChange","change",4,"ngIf"],["class","w-100 standalone-field me-3",4,"ngIf"],[1,"w-100","standalone-field"],["matPrefix","","matTooltip","Search for item(s)",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],[1,"text-muted"],["matInput","","placeholder","Search ...","autocomplete","off",3,"formControl"],["input",""],["mat-icon-button","","matSuffix","",3,"click",4,"ngIf"],["mat-flat-button","","color","primary","class","ms-3",3,"disabled","click",4,"ngIf"],["color","primary",1,"mt-md-0","mt-1","me-3",3,"ngModel","ngModelChange","change"],[1,"w-100","standalone-field","me-3"],["matPrefix","","matTooltip","Filter on type",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],[1,"text-muted","ms-1"],["placeholder","Type ...",3,"ngModel","ngModelChange","selectionChange"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"d-block","name-line"],["mat-icon-button","","matSuffix","",3,"click"],["mat-flat-button","","color","primary",1,"ms-3",3,"disabled","click"],[4,"ngIf"]],template:function(_,A){if(1&_&&(n.TgZ(0,"div",0),n.YNc(1,d,2,2,"mat-checkbox",1),n.YNc(2,M,10,3,"mat-form-field",2),n.TgZ(3,"mat-form-field",3)(4,"span",4)(5,"mat-icon"),n._uU(6,"search"),n.qZA(),n.TgZ(7,"span",5),n._uU(8,"|"),n.qZA()(),n._UZ(9,"input",6,7),n.YNc(11,h,3,0,"button",8),n.qZA(),n.YNc(12,D,3,3,"button",9),n.YNc(13,F,2,2,"button",9),n.qZA()),2&_){const k=n.MAs(10);n.xp6(1),n.Q6J("ngIf",A.checkBoxText),n.xp6(1),n.Q6J("ngIf",(null==A.types?null:A.types.length)>0),n.xp6(7),n.Q6J("formControl",A.filterControl),n.xp6(2),n.Q6J("ngIf",""!==k.value),n.xp6(1),n.Q6J("ngIf",A.buttonText||A.buttonIcon),n.xp6(1),n.Q6J("ngIf",A.button2Text)}},dependencies:[S.sg,S.O5,e.Hw,g.lW,v.KE,v.qo,v.R9,y.Nt,f.oG,l.gM,u.gD,p.ey,U.Fj,U.JJ,U.On,U.oH],encapsulation:2}),w})()},1565:(E,Z,r)=>{"use strict";r.d(Z,{Q:()=>i});var n=r(4650),U=r(9845);let i=(()=>{class x{constructor(e){this.httpService=e}list(e=null){let g="";return null!==e&&(g+="?limit="+e.limit,g+="&offset="+e.offset,e.filter&&""!==e.filter&&(g+="&filter="+encodeURIComponent(e.filter))),this.httpService.get("/magic/system/cache/list"+g)}count(e=null){let g="";return null!==e&&""!==e&&(g+="?filter="+encodeURIComponent(e)),this.httpService.get("/magic/system/cache/count"+g)}delete(e){return this.httpService.delete("/magic/system/cache/delete?id="+encodeURIComponent(e))}clear(e=null){let g="";return null!==e&&""!==e&&(g+="?filter="+encodeURIComponent(e)),this.httpService.delete("/magic/system/cache/empty"+g)}}return x.\u0275fac=function(e){return new(e||x)(n.LFG(U.O))},x.\u0275prov=n.Yz7({token:x,factory:x.\u0275fac,providedIn:"root"}),x})()},9214:(E,Z,r)=>{"use strict";r.d(Z,{I:()=>v});var n=r(4327),i=r(9751),x=r(4650),S=r(9845),e=r(3885),g=r(1565);let v=(()=>{class y{constructor(l,u,p){this.httpService=l,this.generalService=u,this.cacheService=p}listFiles(l,u=null){let p="?folder="+encodeURIComponent(l);return u&&(p+="&filter="+encodeURIComponent(u)),this.httpService.get("/magic/system/file-system/list-files"+p)}listFilesRecursively(l,u){let p="?folder="+encodeURIComponent(l);return this.httpService.get("/magic/system/file-system/list-files-recursively"+p+"&sys="+u)}listFolders(l){return this.httpService.get("/magic/system/file-system/list-folders?folder="+encodeURIComponent(l))}listFoldersRecursively(l,u){return this.httpService.get("/magic/system/file-system/list-folders-recursively?folder="+encodeURIComponent(l)+"&sys="+u)}loadFile(l){return this.httpService.get("/magic/system/file-system/file?file="+encodeURIComponent(l),{responseType:"text"})}saveFile(l,u){const p=l.substring(0,l.lastIndexOf("/")+1),d=new FormData,C=new Blob([u],{type:"text/plain"});return d.append("file",C,l.substring(l.lastIndexOf("/")+1)),this.httpService.put("/magic/system/file-system/file?folder="+encodeURIComponent(p),d)}rename(l,u){return this.httpService.post("/magic/system/file-system/rename",{oldName:l,newName:u})}deleteFile(l){return this.httpService.delete("/magic/system/file-system/file?file="+encodeURIComponent(l))}downloadFile(l){this.httpService.download("/magic/system/file-system/file?file="+encodeURIComponent(l)).subscribe({next:u=>{let d=u.headers.get("Content-Disposition").split(";")[1].trim().split("=")[1].replace(/"/g,"");const C=new Blob([u.body]);(0,n.saveAs)(C,d)},error:u=>this.generalService.showFeedback(u?.error?.message??u,"errorMessage","Ok",4e3)})}uploadFile(l,u){const p=new FormData;return p.append("file",u),this.httpService.put("/magic/system/file-system/file?folder="+encodeURIComponent(l),p)}uploadDatabaseBackup(l){return new i.y(u=>{const p=new FormData;p.append("file",l),this.httpService.put("/magic/system/sql/backup",p).subscribe({next:d=>{this.cacheService.delete("magic.sql.databases.sqlite.*").subscribe({next:()=>{u.next(d),u.complete()},error:C=>{u.error(C),u.complete()}})},error:d=>{u.error(d),u.complete()}})})}importUsers(l){const u=new FormData;return u.append("file",l),this.httpService.put("/magic/system/auth/import-users",u)}uploadStaticWebsite(l){return this.httpService.put("/magic/system/file-system/overwrite-folder",l)}downloadFolder(l){this.httpService.download("/magic/system/file-system/download-folder?folder="+encodeURIComponent(l)).subscribe({next:u=>{const p=u.headers.get("Content-Disposition");let d=p.substring(p.indexOf("=")+1);d=d.substring(1,d.lastIndexOf('"'));const C=new Blob([u.body],{type:"application/zip"});(0,n.saveAs)(C,d)},error:u=>this.generalService.showFeedback(u?.error?.message??u,"errorMessage")})}createFolder(l){return this.httpService.put("/magic/system/file-system/folder",{folder:l})}deleteFolder(l){return this.httpService.delete("/magic/system/file-system/folder?folder="+encodeURIComponent(l))}getMacroDefinition(l){return this.httpService.get("/magic/system/ide/macro?macro="+encodeURIComponent(l))}executeMacro(l,u){return this.httpService.post("/magic/system/ide/execute-macro",{macro:l,args:u})}installModule(l){const u=new FormData;return u.append("file",l),this.httpService.put("/magic/system/file-system/install-module",u)}unzip(l){return this.httpService.put("/magic/system/file-system/unzip",{file:l,create_folder:!0})}}return y.\u0275fac=function(l){return new(l||y)(x.LFG(S.O),x.LFG(e.m),x.LFG(g.Q))},y.\u0275prov=x.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})()},8757:(E,Z,r)=>{"use strict";r.r(Z),r.d(Z,{UsersRolesModule:()=>Qe});var n=r(6895),U=r(2278),i=r(4006),x=r(8739),S=r(1135),e=r(4650),g=r(3278),v=r(3885),y=r(3436),f=r(9311),l=r(3848),u=r(3546),p=r(6996),d=r(5938),C=r(7392),M=r(4859),h=r(9549),T=r(4144);const D=function(){return{standalone:!0}};let F=(()=>{class s{constructor(t,o,a,m){this.dialogRef=t,this.userService=o,this.generalService=a,this.data=m,this.password="",this.showPassword=!1,this.isLoading=!1}save(){""!==this.password?(this.isLoading=!0,this.userService.update({username:this.data.username,password:this.password}).subscribe({next:()=>{this.generalService.showFeedback("New password is saved successfully","successMessage","Ok",3e3),this.isLoading=!1,this.dialogRef.close()},error:t=>this.generalService.showFeedback(t?.error?.message??t,"errorMessage","Ok",4e3)})):this.generalService.showFeedback("Please give a password to save.")}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(d.so),e.Y36(g.K),e.Y36(v.m),e.Y36(d.WI))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-change-password-dialog"]],decls:23,vars:8,consts:[["mat-dialog-title","",1,"mb-1"],[1,"mb-4"],[1,"fw-bold"],["mat-dialog-content",""],[1,"w-100"],["matPrefix","",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],[1,"text-muted"],["matInput","","autocomplete","new-password","placeholder","New password",3,"type","ngModel","ngModelOptions","ngModelChange"],["mat-icon-button","","matSuffix","","type","button",3,"click"],["mat-dialog-actions","",3,"align"],["mat-button","","mat-dialog-close",""],["mat-flat-button","","color","primary","type","submit","type","submit",3,"disabled","click"]],template:function(t,o){1&t&&(e.TgZ(0,"form")(1,"h3",0),e._uU(2,"Change password"),e.qZA(),e.TgZ(3,"p",1),e._uU(4,"Set a new password for "),e.TgZ(5,"span",2),e._uU(6),e.qZA()(),e.TgZ(7,"div",3)(8,"mat-form-field",4)(9,"span",5)(10,"mat-icon"),e._uU(11,"key"),e.qZA(),e.TgZ(12,"span",6),e._uU(13,"|"),e.qZA()(),e.TgZ(14,"input",7),e.NdJ("ngModelChange",function(m){return o.password=m}),e.qZA(),e.TgZ(15,"button",8),e.NdJ("click",function(){return o.showPassword=!o.showPassword}),e.TgZ(16,"mat-icon"),e._uU(17),e.qZA()()()(),e.TgZ(18,"div",9)(19,"button",10),e._uU(20,"Cancel"),e.qZA(),e.TgZ(21,"button",11),e.NdJ("click",function(){return o.save()}),e._uU(22,"Save password"),e.qZA()()()),2&t&&(e.xp6(6),e.Oqu(null==o.data?null:o.data.username),e.xp6(8),e.Q6J("type",o.showPassword?"text":"password")("ngModel",o.password)("ngModelOptions",e.DdM(7,D)),e.xp6(3),e.Oqu(o.showPassword?"visibility_off":"visibility"),e.xp6(1),e.Q6J("align","end"),e.xp6(3),e.Q6J("disabled",o.isLoading))},dependencies:[i._Y,i.Fj,i.JJ,i.JL,i.On,i.F,C.Hw,M.lW,h.KE,h.qo,h.R9,T.Nt,d.ZT,d.uh,d.xY,d.H8],encapsulation:2}),s})();var N=r(4128);let w=(()=>{class s{constructor(t,o,a,m){this.userService=t,this.generalService=o,this.data=a,this.dialogRef=m}save(t,o){""!==t&&""!==o?this.userService.addExtra({type:t,user:this.data,value:o}).subscribe({next:m=>{"success"===m.result?(this.generalService.showFeedback("New field is saved successfully.","successMessage"),this.dialogRef.close({type:t,value:o})):this.generalService.showFeedback("Something went wrong, please try again.","errorMessage","ok",4e3)},error:m=>this.generalService.showFeedback(m?.error?.message??m,"errorMessage","ok",4e3)}):this.generalService.showFeedback("Please provide all fields","errorMessage")}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(g.K),e.Y36(v.m),e.Y36(d.WI),e.Y36(d.so))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-add-extra-fields-dialog"]],decls:25,vars:1,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"w-100"],["matPrefix","",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],[1,"text-muted"],["matInput","","placeholder","Name","autocomplete","off"],["type",""],["matInput","","placeholder","Value","autocomplete","off"],["value",""],["mat-dialog-actions","",3,"align"],["mat-dialog-close","","mat-button","","color","primary","type","button",1,"px-sm-5","px-4"],["mat-flat-button","","color","primary","type","submit",1,"px-sm-5","px-4",3,"click"]],template:function(t,o){if(1&t){const a=e.EpF();e.TgZ(0,"form")(1,"h3",0),e._uU(2,"Add a new field"),e.qZA(),e.TgZ(3,"div",1)(4,"mat-form-field",2)(5,"span",3)(6,"mat-icon"),e._uU(7,"list"),e.qZA(),e.TgZ(8,"span",4),e._uU(9,"|"),e.qZA()(),e._UZ(10,"input",5,6),e.qZA(),e.TgZ(12,"mat-form-field",2)(13,"span",3)(14,"mat-icon"),e._uU(15,"edit"),e.qZA(),e.TgZ(16,"span",4),e._uU(17,"|"),e.qZA()(),e._UZ(18,"input",7,8),e.qZA()(),e.TgZ(20,"div",9)(21,"button",10),e._uU(22,"Close"),e.qZA(),e.TgZ(23,"button",11),e.NdJ("click",function(){e.CHM(a);const b=e.MAs(11),O=e.MAs(19);return e.KtG(o.save(b.value,O.value))}),e._uU(24,"Save"),e.qZA()()()}2&t&&(e.xp6(20),e.Q6J("align","end"))},dependencies:[i._Y,i.JL,i.F,C.Hw,M.lW,h.KE,h.qo,T.Nt,d.ZT,d.uh,d.xY,d.H8],encapsulation:2}),s})();var R=r(4385),_=r(3238),A=r(455);function k(s,c){if(1&s&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.hij(" + ",t.rolesCtrl.value.length-1," more ")}}function I(s,c){if(1&s){const t=e.EpF();e.TgZ(0,"mat-option",19),e.NdJ("click",function(){const m=e.CHM(t).$implicit,b=e.oxw();return e.KtG(b.manageRole(m.name))}),e.TgZ(1,"span",20),e._uU(2),e.qZA(),e.TgZ(3,"span",21),e._uU(4),e.qZA()()}if(2&s){const t=c.$implicit;e.Q6J("value",t.name),e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.description)}}function K(s,c){if(1&s){const t=e.EpF();e.TgZ(0,"div",6)(1,"mat-form-field",22)(2,"span",8),e._uU(3),e.TgZ(4,"span",23),e._uU(5,"|"),e.qZA()(),e._UZ(6,"input",24),e.TgZ(7,"button",25),e.NdJ("click",function(){const m=e.CHM(t).$implicit,b=e.oxw();return e.KtG(b.deleteField(m.type))}),e.TgZ(8,"mat-icon"),e._uU(9,"delete"),e.qZA()()()()}if(2&s){const t=c.$implicit;e.xp6(3),e.hij(" ",t.type," "),e.xp6(3),e.Q6J("formControlName",t.type)("name",t.type)}}const W=function(){return{standalone:!0}};let j=(()=>{class s{constructor(t,o,a,m,b,O,Ke,We){this.fb=t,this.dialog=o,this.dialogRef=a,this.userService=m,this.roleService=b,this.generalService=O,this.cdr=Ke,this.data=We,this.rolesCtrl=new i.NI([]),this.rolesList=[],this.userIsLocked=void 0,this.formData=[],this.userForm=this.fb.group({})}ngOnInit(){this.formData=this.data.user?.extra||[],this.setFormFields(),this.sortRolesBySelected(),this.userIsLocked=this.data.user.locked,this.getRolesList()}getRolesList(){this.roleService.list("?limit=-1").subscribe({next:t=>{this.rolesList=t||[],this.rolesCtrl=new i.NI(this.data.user.roles||[])}})}sortRolesBySelected(){this.cdr.detectChanges()}setFormFields(){this.formData.forEach(t=>{this.userForm.setControl(t.type,new i.NI(t.value))})}manageRole(t){this.rolesCtrl.disable();const o=this.rolesCtrl.value.indexOf(t)>-1,a={user:this.data.user.username,role:t};!0===o?this.addRole(t):this.removeRole(a)}addRole(t){this.userService.addRole(this.data.user.username,t).subscribe({next:o=>{o&&"success"===o.result&&(this.generalService.showFeedback("Roles successfully updated","successMessage"),this.rolesCtrl.enable())},error:o=>{this.generalService.showFeedback(o?.error?.message??o,"errorMessage","ok",4e3),this.rolesCtrl.enable()}})}removeRole(t){this.userService.removeRole(t.user,t.role).subscribe({next:o=>{o&&o.affected>0&&(this.generalService.showFeedback("Roles successfully updated","successMessage"),this.rolesCtrl.enable())},error:o=>{this.generalService.showFeedback(o?.error?.message??o,"errorMessage","ok",4e3),this.rolesCtrl.enable()}})}toggleLockUser(){this.userIsLocked=!this.userIsLocked,this.userService.update({username:this.data.user.username,locked:this.userIsLocked}).subscribe({next:o=>{o&&o.affected>0&&this.generalService.showFeedback("User was successfully "+(this.userIsLocked?"locked":"unlocked"),"successMessage")},error:o=>{this.generalService.showFeedback(o?.error?.message??o,"errorMessage","ok",4e3)}})}addField(){this.dialog.open(w,{width:"450px",data:this.data.user.username}).afterClosed().subscribe(t=>{t&&(this.formData.push({type:t.type,value:t.value}),this.setFormFields())})}deleteField(t){const o=this.formData.findIndex(a=>a.type===t);this.dialog.open(p.z,{width:"500px",data:{title:`Delete field ${t??"Empty"}`,description_extra:"You are about to delete an extra field. This action cannot be undone and will be permanent.<br/><br/>Do you want to continue?",action_btn:"Delete field",action_btn_color:"warn",bold_description:!0}}).afterClosed().subscribe(a=>{"confirm"===a&&this.userService.deleteExtra(t,this.data.user.username).subscribe({next:()=>{this.formData.splice(o,1),this.userForm.removeControl(t),this.generalService.showFeedback("The selected field is deleted successfully.","successMessage")},error:m=>this.generalService.showFeedback(m?.error?.message??m,"errorMessage","Ok",4e3)})})}saveFields(){let t=[];for(const o in this.userForm.value)t.push(this.userService.editExtra({type:o,user:this.data.user.username,value:this.userForm.value[o]}));0!==t.length?(0,N.D)(t).subscribe({next:()=>{this.generalService.showFeedback("Changes are saved successfully.","successMessage"),this.dialogRef.close()},error:o=>this.generalService.showFeedback(o?.error?.message??o,"errorMessage","ok",4e3)}):this.dialogRef.close()}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(i.qu),e.Y36(d.uw),e.Y36(d.so),e.Y36(g.K),e.Y36(y.N),e.Y36(v.m),e.Y36(e.sBO),e.Y36(d.WI))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-edit-user-dialog"]],decls:30,vars:12,consts:[[1,"form-with-label",3,"formGroup"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],["mat-dialog-title","",1,"my-0"],["mat-button","","color","primary","type","button",3,"click"],["mat-dialog-content",""],[1,"row"],[1,"col-md-6","col-12"],[1,"w-100"],["matPrefix","",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],[1,"text-muted"],["multiple","",3,"formControl"],[4,"ngIf"],["class","multiline-mat-option",3,"value","click",4,"ngFor","ngForOf"],["class","col-md-6 col-12",4,"ngFor","ngForOf"],[1,"col-12"],["color","primary",3,"ngModel","ngModelOptions","ngModelChange","toggleChange"],["mat-dialog-actions","",3,"align"],["mat-dialog-close","","mat-button","","color","primary","type","button",1,"px-sm-5","px-4"],["mat-flat-button","","color","primary","type","submit",1,"px-sm-5","px-4",3,"click"],[1,"multiline-mat-option",3,"value","click"],[1,"d-block","name-line"],[1,"d-block","description-line"],[1,"w-100","label-element"],[1,"text-muted","ms-1"],["matInput","",3,"formControlName","name"],["matSuffix","","mat-icon-button","","color","warn","type","button",3,"click"]],template:function(t,o){1&t&&(e.TgZ(0,"form",0)(1,"div",1)(2,"h3",2),e._uU(3),e.qZA(),e.TgZ(4,"button",3),e.NdJ("click",function(){return o.addField()}),e._uU(5,"Add fields"),e.qZA()(),e.TgZ(6,"div",4)(7,"div",5)(8,"div",6)(9,"mat-form-field",7)(10,"span",8)(11,"mat-icon"),e._uU(12,"shield"),e.qZA(),e.TgZ(13,"span",9),e._uU(14,"|"),e.qZA()(),e.TgZ(15,"mat-select",10)(16,"mat-select-trigger"),e._uU(17),e.YNc(18,k,2,1,"span",11),e.qZA(),e.YNc(19,I,5,3,"mat-option",12),e.qZA()()(),e.YNc(20,K,10,3,"div",13),e.TgZ(21,"div",14)(22,"p")(23,"mat-slide-toggle",15),e.NdJ("ngModelChange",function(m){return o.userIsLocked=m})("toggleChange",function(){return o.toggleLockUser()}),e._uU(24),e.qZA()()()()(),e.TgZ(25,"div",16)(26,"button",17),e._uU(27,"Close"),e.qZA(),e.TgZ(28,"button",18),e.NdJ("click",function(){return o.saveFields()}),e._uU(29,"Save"),e.qZA()()()),2&t&&(e.Q6J("formGroup",o.userForm),e.xp6(3),e.hij("Edit user ",null==o.data||null==o.data.user?null:o.data.user.username,""),e.xp6(12),e.Q6J("formControl",o.rolesCtrl),e.xp6(2),e.hij(" ",o.rolesCtrl.value?o.rolesCtrl.value[0]:""," "),e.xp6(1),e.Q6J("ngIf",(null==o.rolesCtrl.value?null:o.rolesCtrl.value.length)>1),e.xp6(1),e.Q6J("ngForOf",o.rolesList),e.xp6(1),e.Q6J("ngForOf",o.formData),e.xp6(3),e.Q6J("ngModel",o.userIsLocked)("ngModelOptions",e.DdM(11,W)),e.xp6(1),e.hij(" ",o.userIsLocked?"Unlock user":"Lock user"," "),e.xp6(1),e.Q6J("align","end"))},dependencies:[n.sg,n.O5,i._Y,i.Fj,i.JJ,i.JL,i.On,i.oH,i.sg,i.u,C.Hw,M.lW,h.KE,h.qo,h.R9,T.Nt,d.ZT,d.uh,d.xY,d.H8,R.gD,R.$L,_.ey,A.Rr],encapsulation:2}),s})();var H=r(4425),$=r(8710),L=r(671),P=r(8255);function G(s,c){1&s&&(e.TgZ(0,"th",16),e._uU(1,"Username"),e.qZA())}function z(s,c){if(1&s&&(e.TgZ(0,"td",17),e._uU(1),e.qZA()),2&s){const t=c.$implicit;e.xp6(1),e.Oqu(t.username)}}function X(s,c){1&s&&(e.TgZ(0,"th",16),e._uU(1,"Name"),e.qZA())}function V(s,c){if(1&s&&(e.TgZ(0,"td",17),e._uU(1),e.qZA()),2&s){const t=c.$implicit,o=e.oxw();e.xp6(1),e.Oqu(o.getExtra("name",t))}}function ee(s,c){1&s&&(e.TgZ(0,"th",16),e._uU(1,"Email"),e.qZA())}function te(s,c){if(1&s&&(e.TgZ(0,"td",17),e._uU(1),e.qZA()),2&s){const t=c.$implicit,o=e.oxw();e.xp6(1),e.Oqu(o.getExtra("email",t))}}function oe(s,c){1&s&&(e.TgZ(0,"th",16),e._uU(1,"Roles"),e.qZA())}function ne(s,c){if(1&s&&(e.TgZ(0,"td",17),e._uU(1),e.qZA()),2&s){const t=c.$implicit;let o;e.xp6(1),e.Oqu(null!==(o=null==t||null==t.roles?null:t.roles.toString())&&void 0!==o?o:"N/A")}}function se(s,c){1&s&&(e.TgZ(0,"th",18),e._uU(1,"Created"),e.qZA())}function ie(s,c){if(1&s&&(e.TgZ(0,"td",17),e._uU(1),e.ALo(2,"date"),e.qZA()),2&s){const t=c.$implicit;e.xp6(1),e.Oqu(e.xi3(2,1,null==t?null:t.created,"dd.MM.YYYY"))}}function ae(s,c){1&s&&(e.TgZ(0,"th",16),e._uU(1," Status "),e.qZA())}function re(s,c){if(1&s&&(e.TgZ(0,"td",19),e._UZ(1,"span"),e.qZA()),2&s){const t=c.$implicit;e.xp6(1),e.Gre("status ",null==t?null:t.status," me-1"),e.ekj("locked",!0===t.locked)("unlocked",!1===t.locked)}}function le(s,c){1&s&&(e.TgZ(0,"th",20),e._uU(1,"Actions"),e.qZA())}function ce(s,c){if(1&s){const t=e.EpF();e.TgZ(0,"td",17)(1,"div",21)(2,"div")(3,"button",22),e.NdJ("click",function(){const m=e.CHM(t).$implicit,b=e.oxw();return e.KtG(b.editUser(m))}),e._uU(4," Edit "),e.qZA(),e.TgZ(5,"button",22),e.NdJ("click",function(){const m=e.CHM(t).$implicit,b=e.oxw();return e.KtG(b.changePassword(m))}),e._uU(6," Change password "),e.qZA()(),e.TgZ(7,"button",23)(8,"mat-icon"),e._uU(9,"more_vert"),e.qZA()()(),e.TgZ(10,"mat-menu",null,24)(12,"button",25),e.NdJ("click",function(){const m=e.CHM(t).$implicit,b=e.oxw();return e.KtG(b.lockedChanged(m))}),e._uU(13),e.qZA(),e.TgZ(14,"button",25),e.NdJ("click",function(){const m=e.CHM(t).$implicit,b=e.oxw();return e.KtG(b.generateResetPasswordLink(m))}),e._uU(15," Create reset password link "),e.qZA(),e.TgZ(16,"button",25),e.NdJ("click",function(){const m=e.CHM(t).$implicit,b=e.oxw();return e.KtG(b.generateLoginLink(m))}),e._uU(17),e.qZA(),e.TgZ(18,"button",25),e.NdJ("click",function(){const m=e.CHM(t).$implicit,b=e.oxw();return e.KtG(b.deleteUser(m))}),e._uU(19," Delete "),e.qZA()()()}if(2&s){const t=c.$implicit,o=e.MAs(11);e.xp6(7),e.Q6J("matMenuTriggerFor",o),e.xp6(6),e.hij(" ",null!=t&&t.locked?"Unlock":"Lock"," "),e.xp6(4),e.hij(" Login as ",null==t?null:t.username," ")}}function me(s,c){1&s&&e._UZ(0,"tr",26)}function de(s,c){1&s&&e._UZ(0,"tr",27)}let ue=(()=>{class s{constructor(t,o,a,m,b,O){this.dialog=t,this.clipboard=o,this.userService=a,this.generalService=m,this.backendService=b,this.platformLocation=O,this.usersList=[],this.rolesList=[],this.getUsersList=new e.vpe,this.displayedColumns=["username","name","email","role","creationDate","status","actions"],this.userCanDelete=void 0}generateResetPasswordLink(t){this.generalService.showLoading(),this.userService.generateResetPasswordLink(t.username).subscribe({next:o=>{this.generalService.hideLoading();const m=this.platformLocation.location.origin.toString()+"/authentication/auto-auth?token="+encodeURIComponent(o.ticket)+"&username="+encodeURIComponent(t.username)+"&url="+encodeURIComponent(this.backendService.active.url);this.clipboard.copy(m),this.generalService.showFeedback("Reset password link is copied to your clipboard","successMessage")},error:o=>{this.generalService.hideLoading(),this.generalService.showFeedback(o?.error?.message??o,"errorMessage")}})}generateLoginLink(t){this.generalService.showLoading(),this.userService.generateLoginLink(t.username).subscribe({next:o=>{this.generalService.hideLoading();const m=this.platformLocation.location.origin.toString()+"/authentication/auto-auth/?token="+encodeURIComponent(o.ticket)+"&username="+encodeURIComponent(t.username)+"&url="+encodeURIComponent(this.backendService.active.url);this.clipboard.copy(m),this.generalService.showFeedback("Login link is copied to your clipboard","successMessage")},error:o=>{this.generalService.hideLoading(),this.generalService.showFeedback(o?.error?.message??o,"errorMessage")}})}lockedChanged(t){this.dialog.open(p.z,{width:"500px",data:{title:`${t?.locked?"Unlock":"Lock"} user ${t?.username}`,description_extra:'To proceed please type in the <span class="fw-bold">user\'s username</span> below.',action_btn:t?.locked?"Unlock user":"Lock user",action_btn_color:"warn",bold_description:!0,extra:{details:t,action:"confirmInput",fieldToBeTypedTitle:"username",fieldToBeTypedValue:t.username,icon:"do_not_disturb_on"}}}).afterClosed().subscribe(o=>{"confirm"===o&&(this.generalService.showLoading(),this.userService.update({username:t.username,locked:!t.locked}).subscribe({next:()=>{this.generalService.hideLoading(),t.locked=!t.locked,this.generalService.showFeedback("User is successfully "+(t.locked?"locked out of system":"released to access the system"),"successMessage")},error:a=>{this.generalService.hideLoading(),this.generalService.showFeedback(a?.error?.message??a,"errorMessage")}}))})}deleteUser(t){this.dialog.open(p.z,{width:"500px",data:{title:`Delete user ${t?.username}`,description_extra:'This action cannot be undone and will be permanent.<br/><br/>Please type in the <span class="fw-bold">user\'s username</span> below.',action_btn:"Delete user",action_btn_color:"warn",bold_description:!0,extra:{details:t,action:"confirmInput",fieldToBeTypedTitle:"username",fieldToBeTypedValue:t.username,icon:"delete"}}}).afterClosed().subscribe(o=>{"confirm"===o&&(this.generalService.showLoading(),this.userService.delete(t.username).subscribe({next:()=>{this.generalService.hideLoading(),this.generalService.showFeedback(`${t.username} was successfully deleted`,"successMessage"),this.updateList()},error:a=>{this.generalService.hideLoading(),this.generalService.showFeedback(a?.error?.message??a,"errorMessage")}}))})}getExtra(t,o){const a=o?.extra?.filter(m=>m.type===t)||[];return a.length>0?a[0].value:"N/A"}changePassword(t){this.dialog.open(F,{width:"500px",data:t})}editUser(t){this.dialog.open(j,{width:"800px",data:{user:t},autoFocus:!1}).afterClosed().subscribe(()=>{this.updateList()})}updateList(){this.getUsersList.emit()}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(d.uw),e.Y36(H.TU),e.Y36(g.K),e.Y36(v.m),e.Y36($.v),e.Y36(n.lw))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-users-list"]],inputs:{usersList:"usersList",rolesList:"rolesList"},outputs:{getUsersList:"getUsersList"},decls:25,vars:3,consts:[[1,"table-responsive"],["mat-table","",1,"w-100","borderless","hoverable",3,"dataSource"],["matColumnDef","username"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["matColumnDef","email"],["matColumnDef","role"],["matColumnDef","creationDate"],["mat-header-cell","","class","text-nowrap",4,"matHeaderCellDef"],["matColumnDef","status"],["mat-cell","","class","ps-3",4,"matCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","px-3",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-cell","",1,"text-nowrap"],["mat-cell","",1,"ps-3"],["mat-header-cell","",1,"px-3"],[1,"d-flex","justify-content-between","align-items-center"],["mat-button","","color","primary",3,"click"],["mat-icon-button","",3,"matMenuTriggerFor"],["menu","matMenu"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"table",1),e.ynx(2,2),e.YNc(3,G,2,0,"th",3),e.YNc(4,z,2,1,"td",4),e.BQk(),e.ynx(5,5),e.YNc(6,X,2,0,"th",3),e.YNc(7,V,2,1,"td",4),e.BQk(),e.ynx(8,6),e.YNc(9,ee,2,0,"th",3),e.YNc(10,te,2,1,"td",4),e.BQk(),e.ynx(11,7),e.YNc(12,oe,2,0,"th",3),e.YNc(13,ne,2,1,"td",4),e.BQk(),e.ynx(14,8),e.YNc(15,se,2,0,"th",9),e.YNc(16,ie,3,4,"td",4),e.BQk(),e.ynx(17,10),e.YNc(18,ae,2,0,"th",3),e.YNc(19,re,2,7,"td",11),e.BQk(),e.ynx(20,12),e.YNc(21,le,2,0,"th",13),e.YNc(22,ce,20,3,"td",4),e.BQk(),e.YNc(23,me,1,0,"tr",14),e.YNc(24,de,1,0,"tr",15),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("dataSource",o.usersList),e.xp6(22),e.Q6J("matHeaderRowDef",o.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",o.displayedColumns))},dependencies:[C.Hw,M.lW,L.BZ,L.fO,L.as,L.w1,L.Dz,L.nj,L.ge,L.ev,L.XQ,L.Gk,P.VK,P.OP,P.p6,n.uU],styles:["button.p-0[_ngcontent-%COMP%]{min-width:0}.status[_ngcontent-%COMP%]{min-width:7px;min-height:7px;width:7px;height:7px;border-radius:50%;display:inline-block}.status.locked[_ngcontent-%COMP%]{background-color:#eb5757}.status.unlocked[_ngcontent-%COMP%]{background-color:#27ae60}"]}),s})();var pe=r(5861),Y=r(9554),J=r(8194),q=r(266);function ge(s,c){if(1&s&&(e.ynx(0),e.TgZ(1,"h3",14),e._uU(2),e.qZA(),e.BQk()),2&s){const t=e.oxw();e.xp6(2),e.hij("Edit role ",t.data.role.name,"")}}function he(s,c){1&s&&(e.TgZ(0,"h3",14),e._uU(1,"Create new role"),e.qZA())}let B=(()=>{class s{constructor(t,o,a,m,b){this.fb=t,this.roleService=o,this.generalService=a,this.dialogRef=m,this.data=b,this.isLoading=!1,this.CommonRegEx=J.g,this.CommonErrorMessages=Y.v,this.roleForm=this.fb.group({name:["",[i.kI.required,i.kI.pattern(J.g.appNameWithUppercaseHyphen)]],description:["",[i.kI.required]]})}ngOnInit(){var t=this;(0,pe.Z)(function*(){for(;t.data&&!Object.keys(t.data).length;)yield new Promise(o=>setTimeout(o,100));t.data&&Object.keys(t.data).length>0&&t.data?.role&&t.roleForm.patchValue({name:t.data.role.name,description:t.data.role.description})})()}save(){this.roleForm.valid?(this.isLoading=!0,"edit"===this.data.action?this.roleService.update(this.roleForm.value.name,this.roleForm.value.description).subscribe({next:()=>{this.generalService.showFeedback("Role was successfully updated.","successMessage","Ok",4e3),this.isLoading=!1,this.dialogRef.close("saved")},error:t=>{this.isLoading=!1,this.generalService.showFeedback(t?.error?.message??t,"errorMessage","Ok",4e3)}}):this.roleService.create(this.roleForm.value.name,this.roleForm.value.description).subscribe({next:()=>{this.generalService.showFeedback("Role was successfully updated.","successMessage","Ok",4e3),this.isLoading=!1,this.dialogRef.close("saved")},error:t=>{this.isLoading=!1,this.generalService.showFeedback(t?.error?.message??t,"errorMessage","Ok",4e3)}})):this.generalService.showFeedback("Please provide all fields","errorMessage","Ok")}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(i.qu),e.Y36(y.N),e.Y36(v.m),e.Y36(d.so),e.Y36(d.WI))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-manage-role-dialog"]],decls:27,vars:7,consts:[[3,"formGroup"],[4,"ngIf","ngIfElse"],["newRole",""],["mat-dialog-content",""],[1,"w-100"],["matPrefix","","matTooltip","Name of role",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],[1,"text-muted"],["matInput","","type","text","name","-","autocomplete","off","placeholder","Name","formControlName","name",3,"readonly"],[1,"w-100","custom-alignment"],["matPrefix","","matTooltip","Role's description",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],["matInput","","type","text","name","-","autocomplete","off","placeholder","Description","formControlName","description","required","","rows","5"],["mat-dialog-actions","",3,"align"],["mat-button","","mat-dialog-close",""],["mat-flat-button","","color","primary","type","submit",3,"disabled","click"],["mat-dialog-title",""]],template:function(t,o){if(1&t&&(e.TgZ(0,"form",0),e.YNc(1,ge,3,1,"ng-container",1),e.YNc(2,he,2,0,"ng-template",null,2,e.W1O),e.TgZ(4,"div",3)(5,"mat-form-field",4)(6,"span",5)(7,"mat-icon"),e._uU(8,"shield"),e.qZA(),e.TgZ(9,"span",6),e._uU(10,"|"),e.qZA()(),e._UZ(11,"input",7),e.TgZ(12,"mat-error"),e._uU(13),e.qZA()(),e.TgZ(14,"mat-form-field",8)(15,"span",9)(16,"mat-icon"),e._uU(17,"featured_play_list"),e.qZA(),e.TgZ(18,"span",6),e._uU(19,"|"),e.qZA()(),e.TgZ(20,"textarea",10),e._uU(21,"      "),e.qZA()()(),e.TgZ(22,"div",11)(23,"button",12),e._uU(24," Cancel "),e.qZA(),e.TgZ(25,"button",13),e.NdJ("click",function(){return o.save()}),e._uU(26," Save "),e.qZA()()()),2&t){const a=e.MAs(3);e.Q6J("formGroup",o.roleForm),e.xp6(1),e.Q6J("ngIf","edit"===o.data.action)("ngIfElse",a),e.xp6(10),e.Q6J("readonly","edit"===o.data.action),e.xp6(2),e.Oqu(o.CommonErrorMessages.appNameWithUppercaseHyphen),e.xp6(9),e.Q6J("align","end"),e.xp6(3),e.Q6J("disabled",o.isLoading)}},dependencies:[n.O5,i._Y,i.Fj,i.JJ,i.JL,i.Q7,i.sg,i.u,C.Hw,M.lW,h.TO,h.KE,h.qo,T.Nt,d.ZT,d.uh,d.xY,d.H8,q.gM],encapsulation:2}),s})();function _e(s,c){1&s&&(e.TgZ(0,"th",11),e._uU(1,"Name"),e.qZA())}function fe(s,c){if(1&s&&(e.TgZ(0,"td",12),e._uU(1),e.qZA()),2&s){const t=c.$implicit;e.xp6(1),e.Oqu(null==t?null:t.name)}}function ve(s,c){1&s&&(e.TgZ(0,"th",11),e._uU(1,"Description"),e.qZA())}function Ce(s,c){if(1&s&&(e.TgZ(0,"td",13),e._uU(1),e.qZA()),2&s){const t=c.$implicit;let o;e.xp6(1),e.Oqu(null!==(o=null==t?null:t.description)&&void 0!==o?o:"N/A")}}function be(s,c){1&s&&(e.TgZ(0,"th",14),e._uU(1,"Actions"),e.qZA())}function xe(s,c){if(1&s){const t=e.EpF();e.TgZ(0,"td",13)(1,"div",15)(2,"div")(3,"button",16),e.NdJ("click",function(){const m=e.CHM(t).$implicit,b=e.oxw();return e.KtG(b.editRole(m))}),e._uU(4," Edit "),e.qZA(),e.TgZ(5,"button",17),e.NdJ("click",function(){const m=e.CHM(t).$implicit,b=e.oxw();return e.KtG(b.deleteRole(m))}),e._uU(6," Delete "),e.qZA()()()()}if(2&s){const t=c.$implicit,o=e.oxw();e.xp6(5),e.Q6J("disabled",o.systemRole(t.name))}}function Te(s,c){1&s&&e._UZ(0,"tr",18)}function we(s,c){1&s&&e._UZ(0,"tr",19)}let Ue=(()=>{class s{constructor(t,o,a){this.dialog=t,this.roleService=o,this.generalService=a,this.rolesList=[],this.getRolesList=new e.vpe,this.displayedColumns=["name","description","actions"]}systemRole(t){switch(t){case"root":case"guest":case"reset-password":case"unconfirmed":case"blocked":return!0;default:return!1}}deleteRole(t){this.dialog.open(p.z,{width:"500px",data:{title:`Delete Role ${t.name}`,description_extra:'This action cannot be undone and will be permanent.<br/><br/>Please type in the <span class="fw-bold">role\'s name</span> below.',action_btn:"Delete role",action_btn_color:"warn",bold_description:!0,extra:{details:t,action:"confirmInput",fieldToBeTypedTitle:"role",fieldToBeTypedValue:t.name,icon:"delete"}}}).afterClosed().subscribe(o=>{"confirm"===o&&(this.generalService.showLoading(),this.roleService.delete(t.name).subscribe({next:()=>{this.generalService.hideLoading(),this.generalService.showFeedback(`${t.name} was successfully deleted`,"successMessage"),this.updateList()},error:a=>{this.generalService.hideLoading(),this.generalService.showFeedback(a?.error?.message??a,"errorMessage")}}))})}editRole(t){this.dialog.open(B,{width:"500px",data:{role:t,action:"edit"}}).afterClosed().subscribe(o=>{"saved"===o&&this.updateList()})}updateList(){this.getRolesList.emit()}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(d.uw),e.Y36(y.N),e.Y36(v.m))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-roles-list"]],inputs:{rolesList:"rolesList"},outputs:{getRolesList:"getRolesList"},decls:13,vars:3,consts:[[1,"table-responsive"],["mat-table","",1,"w-100","borderless","hoverable",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","class","text-nowrap",4,"matCellDef"],["matColumnDef","description"],["mat-cell","",4,"matCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","px-3",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell","",1,"text-nowrap"],["mat-cell",""],["mat-header-cell","",1,"px-3"],[1,"d-flex","justify-content-between","align-items-center"],["mat-button","","color","primary",3,"click"],["mat-button","","color","primary",3,"disabled","click"],["mat-header-row",""],["mat-row",""]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"table",1),e.ynx(2,2),e.YNc(3,_e,2,0,"th",3),e.YNc(4,fe,2,1,"td",4),e.BQk(),e.ynx(5,5),e.YNc(6,ve,2,0,"th",3),e.YNc(7,Ce,2,1,"td",6),e.BQk(),e.ynx(8,7),e.YNc(9,be,2,0,"th",8),e.YNc(10,xe,7,1,"td",6),e.BQk(),e.YNc(11,Te,1,0,"tr",9),e.YNc(12,we,1,0,"tr",10),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("dataSource",o.rolesList),e.xp6(10),e.Q6J("matHeaderRowDef",o.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",o.displayedColumns))},dependencies:[M.lW,L.BZ,L.fO,L.as,L.w1,L.Dz,L.nj,L.ge,L.ev,L.XQ,L.Gk],styles:["button.p-0[_ngcontent-%COMP%]{min-width:0}"]}),s})();function ye(s,c){if(1&s&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.hij(" + ",t.userForm.value.role.length-1," more ")}}function Ze(s,c){if(1&s&&(e.TgZ(0,"mat-option",25)(1,"span",26),e._uU(2),e.qZA(),e.TgZ(3,"span",27),e._uU(4),e.qZA()()),2&s){const t=c.$implicit;e.Q6J("value",t.name),e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.description)}}let Le=(()=>{class s{constructor(t,o,a,m,b){this.fb=t,this.userService=o,this.roleService=a,this.dialogRef=m,this.generalService=b,this.showPassword=!1,this.isLoading=!1,this.data=[],this.roleControl=new i.NI,this.CommonRegEx=J.g,this.CommonErrorMessages=Y.v,this.userForm=this.fb.group({username:["",[i.kI.required]],password:["",[i.kI.required]],email:[""],name:[""],role:[]})}ngOnInit(){this.generalService.showLoading(),this.roleService.list("?limit=-1").subscribe({next:t=>{this.generalService.hideLoading(),this.data=t,this.data.find(a=>"guest"===a.name)?this.userForm.patchValue({role:["guest"]}):this.userForm.patchValue({role:[this.data[0].name]})}})}createUser(){this.userForm.valid?(this.isLoading=!0,this.generalService.showLoading(),this.userService.create(this.userForm.value.username,this.userForm.value.password).subscribe({next:t=>{if(t){const o=[];if(this.userForm.value.role.length)for(const a of this.userForm.value.role)o.push(this.addRole(a));if(this.userForm.value.email&&o.push(this.addEmail()),this.userForm.value.name&&o.push(this.addName()),0===o.length)return this.generalService.showFeedback("User is created successfully","successMessage"),this.dialogRef.close("done"),this.isLoading=!1,void this.generalService.hideLoading();(0,N.D)(o).subscribe({next:()=>{this.generalService.showFeedback("User is created successfully","successMessage"),this.dialogRef.close("done"),this.isLoading=!1,this.generalService.hideLoading()},error:()=>{this.generalService.hideLoading(),this.generalService.showFeedback("Something went wrong","errorMessage","Ok")}})}},error:()=>{this.generalService.hideLoading(),this.isLoading=!1,this.generalService.showFeedback("Username is already existing.","errorMessage","Ok",4e3)}})):this.generalService.showFeedback("Username and password are required.","errorMessage")}addRole(t){return new Promise(o=>{this.userService.addRole(this.userForm.value.username,t).subscribe({next:a=>{"success"===a.result&&o("ok")},error:()=>{o("error")}})})}addEmail(){const t={type:"email",value:this.userForm.value.email,user:this.userForm.value.username};return new Promise(o=>{this.userService.addExtra(t).subscribe({next:a=>{"success"===a.result&&o("ok")},error:()=>{o("error")}}),o("ok")})}addName(){const t={type:"name",value:this.userForm.value.name,user:this.userForm.value.username};return new Promise(o=>{this.userService.addExtra(t).subscribe({next:a=>{"success"===a.result&&o("ok")},error:()=>{o("error")}}),o("ok")})}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(i.qu),e.Y36(g.K),e.Y36(y.N),e.Y36(d.so),e.Y36(v.m))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-new-user-dialog"]],decls:63,vars:14,consts:[[3,"formGroup"],["mat-dialog-title",""],["mat-dialog-content",""],[1,"row"],[1,"col-md-6","col-12"],[1,"w-100","standalone-field"],["matPrefix","","matTooltip","User's username",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],[1,"text-muted"],["matInput","","type","text","name","-","autocomplete","off","placeholder","Username","formControlName","username","required","",3,"pattern"],["matPrefix","","matTooltip","User's password",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],["matInput","","autocomplete","new-password","formControlName","password","placeholder","Password","required","",3,"type","pattern"],["mat-icon-button","","matSuffix","","tabIndex","-1","type","button",3,"click"],["matPrefix","","matTooltip","User's full name (optional)",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],["matInput","","type","text","name","-","autocomplete","off","formControlName","name","placeholder","Full name (optional)"],["matPrefix","","matTooltip","User's email address (optional)",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],["matInput","","type","text","name","-","autocomplete","off","formControlName","email","placeholder","Email address (optional)",3,"pattern"],[1,"col-12"],[1,"w-100"],["matPrefix","","matTooltip","Role(s) user should be associated with",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],["formControlName","role","multiple","","placeholder","Role (optional)"],[4,"ngIf"],["class","multiline-mat-option",3,"value",4,"ngFor","ngForOf"],["mat-dialog-actions","",3,"align"],["mat-button","","mat-dialog-close",""],["mat-flat-button","","color","primary","type","submit",3,"disabled","click"],[1,"multiline-mat-option",3,"value"],[1,"d-block","name-line"],[1,"d-block","description-line"]],template:function(t,o){1&t&&(e.TgZ(0,"form",0)(1,"h3",1),e._uU(2,"Add user"),e.qZA(),e.TgZ(3,"div",2)(4,"div",3)(5,"div",4)(6,"mat-form-field",5)(7,"span",6)(8,"mat-icon"),e._uU(9,"person"),e.qZA(),e.TgZ(10,"span",7),e._uU(11,"|"),e.qZA()(),e._UZ(12,"input",8),e.TgZ(13,"mat-error"),e._uU(14),e.qZA()()(),e.TgZ(15,"div",4)(16,"mat-form-field",5)(17,"span",9)(18,"mat-icon"),e._uU(19,"password"),e.qZA(),e.TgZ(20,"span",7),e._uU(21,"|"),e.qZA()(),e._UZ(22,"input",10),e.TgZ(23,"button",11),e.NdJ("click",function(){return o.showPassword=!o.showPassword}),e.TgZ(24,"mat-icon"),e._uU(25),e.qZA()(),e.TgZ(26,"mat-error"),e._uU(27),e.qZA()()(),e.TgZ(28,"div",4)(29,"mat-form-field",5)(30,"span",12)(31,"mat-icon"),e._uU(32,"edit"),e.qZA(),e.TgZ(33,"span",7),e._uU(34,"|"),e.qZA()(),e._UZ(35,"input",13),e.qZA()(),e.TgZ(36,"div",4)(37,"mat-form-field",5)(38,"span",14)(39,"mat-icon"),e._uU(40,"mail"),e.qZA(),e.TgZ(41,"span",7),e._uU(42,"|"),e.qZA()(),e._UZ(43,"input",15),e.TgZ(44,"mat-error"),e._uU(45),e.qZA()()(),e.TgZ(46,"div",16)(47,"mat-form-field",17)(48,"span",18)(49,"mat-icon"),e._uU(50,"shield"),e.qZA(),e.TgZ(51,"span",7),e._uU(52,"|"),e.qZA()(),e.TgZ(53,"mat-select",19)(54,"mat-select-trigger"),e._uU(55),e.YNc(56,ye,2,1,"span",20),e.qZA(),e.YNc(57,Ze,5,3,"mat-option",21),e.qZA()()()()(),e.TgZ(58,"div",22)(59,"button",23),e._uU(60," Cancel "),e.qZA(),e.TgZ(61,"button",24),e.NdJ("click",function(){return o.createUser()}),e._uU(62," Save "),e.qZA()()()),2&t&&(e.Q6J("formGroup",o.userForm),e.xp6(12),e.Q6J("pattern",o.CommonRegEx.name),e.xp6(2),e.Oqu(o.CommonErrorMessages.username),e.xp6(8),e.Q6J("type",o.showPassword?"text":"password")("pattern",o.CommonRegEx.password),e.xp6(3),e.Oqu(o.showPassword?"visibility_off":"visibility"),e.xp6(2),e.Oqu(o.CommonErrorMessages.password),e.xp6(16),e.Q6J("pattern",o.CommonRegEx.email),e.xp6(2),e.Oqu(o.CommonErrorMessages.email),e.xp6(10),e.hij(" ",o.userForm.value.role?o.userForm.value.role[0]:""," "),e.xp6(1),e.Q6J("ngIf",(null==o.userForm.value.role?null:o.userForm.value.role.length)>1),e.xp6(1),e.Q6J("ngForOf",o.data),e.xp6(1),e.Q6J("align","end"),e.xp6(3),e.Q6J("disabled",o.isLoading))},dependencies:[n.sg,n.O5,i._Y,i.Fj,i.JJ,i.JL,i.Q7,i.c5,i.sg,i.u,C.Hw,M.lW,h.TO,h.KE,h.qo,h.R9,T.Nt,d.ZT,d.uh,d.xY,d.H8,q.gM,R.gD,R.$L,_.ey],styles:[".multiline-mat-option.mat-option[_ngcontent-%COMP%]{white-space:normal;line-height:normal;height:unset;padding-top:10px;padding-bottom:10px}.name-line[_ngcontent-%COMP%]{color:#060d16}.description-line[_ngcontent-%COMP%]{color:#828282;font-size:13px;margin-top:5px}"]}),s})();var Se=r(9214),Me=r(316);function ke(s,c){if(1&s){const t=e.EpF();e.TgZ(0,"button",8),e.NdJ("click",function(){e.CHM(t),e.oxw();const a=e.MAs(8);return e.KtG(a.click())}),e._uU(1," Import users "),e.qZA()}}let Ae=(()=>{class s{constructor(t,o,a){this.dialog=t,this.fileService=o,this.generalService=a,this.searchTerm=null,this.tab="user",this.rolesList=[],this.getUsersList=new e.vpe,this.getRolesList=new e.vpe,this.csvFileInput=null}uploadUsers(t){this.fileService.importUsers(t.item(0)).subscribe({next:o=>{this.csvFileInput=null,this.getUsersList.emit({search:this.searchTerm}),this.generalService.showFeedback(`${o.count} users were successfully imported`)},error:o=>this.generalService.showFeedback(o?.error?.message??o,"errorMessage")})}filterList(t){this.searchTerm=t.searchKey,"user"===this.tab?this.getUsers():this.getRoles()}removeSearchTerm(){this.searchTerm="","user"===this.tab?this.getUsers():this.getRoles()}createNewUser(){this.dialog.open(Le,{width:"700px",data:this.rolesList}).afterClosed().subscribe(t=>{t&&this.getUsersList.emit({})})}createNewRole(){this.dialog.open(B,{width:"500px",data:{action:"new"}}).afterClosed().subscribe(t=>{"saved"===t&&this.getRolesList.emit({})})}getUsers(){this.getUsersList.emit({search:this.searchTerm})}getRoles(){this.getRolesList.emit({search:this.searchTerm})}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(d.uw),e.Y36(Se.I),e.Y36(v.m))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-shared-top-bar"]],inputs:{tab:"tab",rolesList:"rolesList"},outputs:{getUsersList:"getUsersList",getRolesList:"getRolesList"},decls:9,vars:3,consts:[[1,"d-flex","justify-content-between","align-items-center","w-100","my-3"],[1,"searchbox"],[3,"filterList"],[1,"d-flex","justify-content-end","button-row","align-items-center","w-100"],["mat-button","","color","primary",3,"click",4,"ngIf"],["mat-flat-button","","color","primary",1,"py-1",3,"click"],["type","file","accept",".csv",1,"d-none",3,"ngModel","ngModelChange","change"],["csvFile",""],["mat-button","","color","primary",3,"click"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"app-searchbox",2),e.NdJ("filterList",function(m){return o.filterList(m)}),e.qZA()(),e.TgZ(3,"div",3),e.YNc(4,ke,2,0,"button",4),e.TgZ(5,"button",5),e.NdJ("click",function(){return"user"===o.tab?o.createNewUser():o.createNewRole()}),e._uU(6),e.qZA(),e.TgZ(7,"input",6,7),e.NdJ("ngModelChange",function(m){return o.csvFileInput=m})("change",function(m){return o.uploadUsers(m.target.files)}),e.qZA()()()),2&t&&(e.xp6(4),e.Q6J("ngIf","user"===o.tab),e.xp6(2),e.hij(" Add ",o.tab," "),e.xp6(1),e.Q6J("ngModel",o.csvFileInput))},dependencies:[n.O5,i.Fj,i.JJ,i.On,Me.E,M.lW],styles:[".searchbox[_ngcontent-%COMP%]{width:350px}"]}),s})();function Re(s,c){1&s&&(e._uU(0," User "),e.TgZ(1,"span",6),e._uU(2,"Management"),e.qZA())}function Ee(s,c){1&s&&(e.ynx(0),e.TgZ(1,"div",9)(2,"div",10),e._UZ(3,"app-loading-skeleton",11),e.qZA()(),e.BQk())}function De(s,c){if(1&s){const t=e.EpF();e.TgZ(0,"app-shared-top-bar",12),e.NdJ("getUsersList",function(a){e.CHM(t);const m=e.oxw(2);return e.KtG(m.getUsersList(a))}),e.ALo(1,"async"),e.qZA(),e.TgZ(2,"app-users-list",13),e.NdJ("getUsersList",function(a){e.CHM(t);const m=e.oxw(2);return e.KtG(m.getUsersList(a))}),e.ALo(3,"async"),e.ALo(4,"async"),e.qZA()}if(2&s){const t=e.oxw(2);e.Q6J("rolesList",e.lcZ(1,3,t.roles)),e.xp6(2),e.Q6J("usersList",e.lcZ(3,5,t.users))("rolesList",e.lcZ(4,7,t.roles))}}function Fe(s,c){if(1&s&&(e.YNc(0,Ee,4,0,"ng-container",7),e.YNc(1,De,5,9,"ng-template",null,8,e.W1O)),2&s){const t=e.MAs(2),o=e.oxw();e.Q6J("ngIf",o.isLoading)("ngIfElse",t)}}function Oe(s,c){1&s&&(e._uU(0,"Role "),e.TgZ(1,"span",6),e._uU(2,"Management"),e.qZA())}function Ie(s,c){1&s&&(e.ynx(0),e._UZ(1,"app-loading-skeleton",11),e.BQk())}function Ne(s,c){if(1&s){const t=e.EpF();e.TgZ(0,"app-shared-top-bar",15),e.NdJ("getRolesList",function(a){e.CHM(t);const m=e.oxw(2);return e.KtG(m.getRolesList(a))}),e.ALo(1,"async"),e.qZA(),e.TgZ(2,"app-roles-list",16),e.NdJ("getRolesList",function(a){e.CHM(t);const m=e.oxw(2);return e.KtG(m.getRolesList(a))}),e.ALo(3,"async"),e.qZA()}if(2&s){const t=e.oxw(2);e.Q6J("rolesList",e.lcZ(1,2,t.roles)),e.xp6(2),e.Q6J("rolesList",e.lcZ(3,4,t.roles))}}function Pe(s,c){if(1&s&&(e.YNc(0,Ie,2,0,"ng-container",7),e.YNc(1,Ne,4,6,"ng-template",null,14,e.W1O)),2&s){const t=e.MAs(2),o=e.oxw();e.Q6J("ngIf",o.isLoading)("ngIfElse",t)}}let Je=(()=>{class s{constructor(t,o,a){this.userService=t,this.generalService=o,this.roleService=a,this.usersCount=0,this.rolesCount=0,this.filter=null,this.isLoading=!0,this.users=new S.X([]),this.roles=new S.X([]),this.resultsLength=0,this.pageSize=10,this.pageSizeOptions=[5,10,25,100],this.currentPage=0}ngOnInit(){this.getUsersList()}tabChange(t){0===t.index?this.getUsersList():this.getRolesList()}getUsersList(t){t&&(this.paginator.pageIndex=0,this.currentPage=0);let o=`?limit=${this.pageSize}&offset=${this.currentPage}`;t&&(this.filter=t.search),this.filter&&(o+=`&username.like=%${encodeURIComponent(this.filter)}%`),this.generalService.showLoading(),this.userService.list(o).subscribe({next:a=>{this.users.next(a||[]),a?this.countUser():(this.resultsLength=0,this.generalService.hideLoading())},error:()=>{this.generalService.showFeedback("Something went wrong as we tried to retrieve users","errorMessage"),this.generalService.hideLoading()}})}getRolesList(t){t&&(this.paginator.pageIndex=0,this.currentPage=0);let o=`?limit=${this.pageSize}&offset=${this.currentPage}`;t&&(this.filter=t.search),this.filter&&(o+=`&name.like=%${encodeURIComponent(this.filter)}%`),this.generalService.showLoading(),this.roleService.list(o).subscribe({next:a=>{this.roles.next(a||[]),a?this.countRole():(this.resultsLength=0,this.generalService.hideLoading())},error:()=>{this.generalService.showFeedback("Something went wrong as we tried to retrieve roles","errorMessage"),this.generalService.hideLoading()}})}pageChange(t,o){this.isLoading=!0,this.pageEvent=t,this.currentPage=t.pageIndex*this.pageSize,this.pageSize=t.pageSize,0===o?this.getUsersList():this.getRolesList()}countUser(){const t=this.filter?`?username.like=%${encodeURIComponent(this.filter)}%`:"";this.userService.count(t).subscribe({next:o=>{o&&(this.resultsLength=o.count,this.usersCount=o.count),this.isLoading=!1,this.generalService.hideLoading()},error:()=>{this.generalService.hideLoading()}})}countRole(){const t=this.filter?`?name.like=${encodeURIComponent(this.filter)}%`:"";this.roleService.count(t).subscribe({next:o=>{o&&(this.resultsLength=o.count,this.rolesCount=o.count),this.isLoading=!1,this.generalService.hideLoading()},error:()=>{this.generalService.hideLoading()}})}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(g.K),e.Y36(v.m),e.Y36(y.N))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-user-roles"]],viewQuery:function(t,o){if(1&t&&e.Gf(x.NW,7),2&t){let a;e.iGM(a=e.CRH())&&(o.paginator=a.first)}},decls:12,vars:6,consts:[["mat-stretch-tabs","","dynamicHeight","","animationDuration","0ms",3,"selectedTabChange"],["tabs",""],["mat-tab-label",""],["matTabContent",""],["aria-label","Select page",1,"mt-4",3,"length","pageSize","pageSizeOptions","showFirstLastButtons","page"],["paginator",""],[1,"d-sm-inline","d-none","ps-1"],[4,"ngIf","ngIfElse"],["dataLoadedUsers",""],[1,"row","mt-3"],[1,"col-12"],["amount","5","colClass","col-12","blockHeight","40px","hasShadow","false"],["tab","user",3,"rolesList","getUsersList"],[3,"usersList","rolesList","getUsersList"],["dataLoadedRoles",""],["tab","role",3,"rolesList","getRolesList"],[3,"rolesList","getRolesList"]],template:function(t,o){if(1&t){const a=e.EpF();e.TgZ(0,"mat-card")(1,"mat-card-content")(2,"mat-tab-group",0,1),e.NdJ("selectedTabChange",function(b){return o.tabChange(b)}),e.TgZ(4,"mat-tab"),e.YNc(5,Re,3,0,"ng-template",2),e.YNc(6,Fe,3,2,"ng-template",3),e.qZA(),e.TgZ(7,"mat-tab"),e.YNc(8,Oe,3,0,"ng-template",2),e.YNc(9,Pe,3,2,"ng-template",3),e.qZA()(),e.TgZ(10,"mat-paginator",4,5),e.NdJ("page",function(b){e.CHM(a);const O=e.MAs(3);return e.KtG(o.pageChange(b,O.selectedIndex))}),e.qZA()()()}2&t&&(e.xp6(10),e.ekj("d-none",o.resultsLength<=o.pageSize),e.Q6J("length",o.resultsLength)("pageSize",o.pageSize)("pageSizeOptions",o.pageSizeOptions)("showFirstLastButtons",!0))},dependencies:[n.O5,f.J,l.SP,l.uD,l.uX,l.Vc,u.a8,u.dn,x.NW,ue,Ue,Ae,n.Ov],encapsulation:2}),s})();var Q=r(9132);const Ye=[{path:"",component:Je}];let qe=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[Q.Bz.forChild(Ye),Q.Bz]}),s})();var Be=r(7832);let Qe=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[n.ez,i.u5,i.UX,Be.K,U.q,qe]}),s})()},4327:function(E,Z){var U;void 0!==(U=function(){"use strict";function x(f,l,u){var p=new XMLHttpRequest;p.open("GET",f),p.responseType="blob",p.onload=function(){y(p.response,l,u)},p.onerror=function(){console.error("could not download file")},p.send()}function S(f){var l=new XMLHttpRequest;l.open("HEAD",f,!1);try{l.send()}catch{}return 200<=l.status&&299>=l.status}function e(f){try{f.dispatchEvent(new MouseEvent("click"))}catch{var l=document.createEvent("MouseEvents");l.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),f.dispatchEvent(l)}}var g="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,v=g.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),y=g.saveAs||("object"!=typeof window||window!==g?function(){}:"download"in HTMLAnchorElement.prototype&&!v?function(f,l,u){var p=g.URL||g.webkitURL,d=document.createElement("a");d.download=l=l||f.name||"download",d.rel="noopener","string"==typeof f?(d.href=f,d.origin===location.origin?e(d):S(d.href)?x(f,l,u):e(d,d.target="_blank")):(d.href=p.createObjectURL(f),setTimeout(function(){p.revokeObjectURL(d.href)},4e4),setTimeout(function(){e(d)},0))}:"msSaveOrOpenBlob"in navigator?function(f,l,u){if(l=l||f.name||"download","string"!=typeof f)navigator.msSaveOrOpenBlob(function i(f,l){return typeof l>"u"?l={autoBom:!1}:"object"!=typeof l&&(console.warn("Deprecated: Expected third argument to be a object"),l={autoBom:!l}),l.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(f.type)?new Blob(["\ufeff",f],{type:f.type}):f}(f,u),l);else if(S(f))x(f,l,u);else{var p=document.createElement("a");p.href=f,p.target="_blank",setTimeout(function(){e(p)})}}:function(f,l,u,p){if((p=p||open("","_blank"))&&(p.document.title=p.document.body.innerText="downloading..."),"string"==typeof f)return x(f,l,u);var d="application/octet-stream"===f.type,C=/constructor/i.test(g.HTMLElement)||g.safari,M=/CriOS\/[\d]+/.test(navigator.userAgent);if((M||d&&C||v)&&typeof FileReader<"u"){var h=new FileReader;h.onloadend=function(){var F=h.result;F=M?F:F.replace(/^data:[^;]*;/,"data:attachment/file;"),p?p.location.href=F:location=F,p=null},h.readAsDataURL(f)}else{var T=g.URL||g.webkitURL,D=T.createObjectURL(f);p?p.location=D:location.href=D,p=null,setTimeout(function(){T.revokeObjectURL(D)},4e4)}});g.saveAs=y.saveAs=y,E.exports=y}.apply(Z,[]))&&(E.exports=U)}}]);