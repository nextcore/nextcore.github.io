(self.webpackChunkmagic=self.webpackChunkmagic||[]).push([[341],{7832:(U,I,a)=>{"use strict";a.d(I,{K:()=>d});var e=a(6895),_=a(2278),i=a(4006),v=a(1103),M=a(4650);let d=(()=>{class m{}return m.\u0275fac=function(C){return new(C||m)},m.\u0275mod=M.oAB({type:m}),m.\u0275inj=M.cJS({imports:[e.ez,_.q,i.u5,i.UX,v.k]}),m})()},6996:(U,I,a)=>{"use strict";a.d(I,{z:()=>f});var e=a(4006),_=a(5938),i=a(4650),v=a(3885),M=a(6895),d=a(7392),m=a(4859),t=a(9549),C=a(4144),s=a(266);function n(h,S){if(1&h&&i._UZ(0,"p",8),2&h){const b=i.oxw();i.Q6J("innerHTML",b.data.description_extra,i.oJD)}}function l(h,S){if(1&h&&(i.TgZ(0,"mat-hint",14),i._uU(1),i.qZA()),2&h){const b=i.oxw(2);i.xp6(1),i.hij(" Inserted ",b.data.extra.fieldToBeTypedTitle," doesn't match. ")}}function r(h,S){if(1&h&&(i.ynx(0),i.TgZ(1,"mat-form-field",9)(2,"span",10)(3,"mat-icon"),i._uU(4),i.qZA(),i.TgZ(5,"span",11),i._uU(6,"|"),i.qZA()(),i._UZ(7,"input",12),i.YNc(8,l,2,1,"mat-hint",13),i.qZA(),i.BQk()),2&h){const b=i.oxw();i.xp6(2),i.MGl("matTooltip","Type in the ",b.data.extra.fieldToBeTypedTitle,""),i.xp6(2),i.Oqu(null==b.data||null==b.data.extra?null:b.data.extra.icon),i.xp6(3),i.MGl("placeholder","Type in the ",b.data.extra.fieldToBeTypedTitle,""),i.Q6J("formControl",b.inputValue),i.xp6(1),i.Q6J("ngIf",""!==b.inputValue.value&&b.data.extra.fieldToBeTypedValue!==b.inputValue.value)}}let f=(()=>{class h{constructor(b,y,O){this.generalService=b,this.dialogRef=y,this.data=O,this.inputValue=new e.NI("")}ngOnInit(){this.data.title=this.data.title??"Please confirm",this.data.description=this.data.description??"Are you sure?",this.data.action_btn_color=this.data.action_btn_color??"primary"}confirm(){!this.data.extra||!this.data.extra.details||this.inputValue.value===this.data.extra.fieldToBeTypedValue&&""!==this.inputValue.value?this.dialogRef.close("confirm"):this.generalService.showFeedback(this.data.extra.fieldToBeTypedTitle+" does not match","errorMessage",null,2e3)}}return h.\u0275fac=function(b){return new(b||h)(i.Y36(v.m),i.Y36(_.so),i.Y36(_.WI))},h.\u0275cmp=i.Xpm({type:h,selectors:[["app-confirmation-dialog"]],decls:13,vars:10,consts:[["mat-dialog-title",""],[3,"ngSubmit"],["mat-dialog-content",""],[3,"innerHTML",4,"ngIf"],[4,"ngIf"],["mat-dialog-actions","",3,"align"],["mat-button","","mat-dialog-close","","cdkFocusInitial",""],["mat-flat-button","",3,"color","click"],[3,"innerHTML"],[1,"w-100"],["matPrefix","",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2",3,"matTooltip"],[1,"text-muted"],["cdkFocusInitial","","matInput","","autocomplete","off",3,"placeholder","formControl"],["class","text-danger",4,"ngIf"],[1,"text-danger"]],template:function(b,y){1&b&&(i.TgZ(0,"h3",0),i._uU(1),i.qZA(),i.TgZ(2,"form",1),i.NdJ("ngSubmit",function(){return y.confirm()}),i.TgZ(3,"div",2)(4,"p"),i._uU(5),i.qZA(),i.YNc(6,n,1,1,"p",3),i.YNc(7,r,9,5,"ng-container",4),i.qZA(),i.TgZ(8,"div",5)(9,"button",6),i._uU(10),i.qZA(),i.TgZ(11,"button",7),i.NdJ("click",function(){return y.confirm()}),i._uU(12),i.qZA()()()),2&b&&(i.xp6(1),i.Oqu(y.data.title),i.xp6(3),i.ekj("fw-bold",y.data.bold_description),i.xp6(1),i.Oqu(y.data.description),i.xp6(1),i.Q6J("ngIf",y.data.description_extra),i.xp6(1),i.Q6J("ngIf",(null==y.data||null==y.data.extra?null:y.data.extra.details)&&"confirmInput"===(null==y.data||null==y.data.extra?null:y.data.extra.action)),i.xp6(1),i.Q6J("align","end"),i.xp6(2),i.hij(" ",y.data.close_btn||"Cancel"," "),i.xp6(1),i.s9C("color",y.data.action_btn_color),i.xp6(1),i.hij(" ",y.data.action_btn," "))},dependencies:[M.O5,d.Hw,m.lW,t.KE,t.bx,t.qo,C.Nt,_.ZT,_.uh,_.xY,_.H8,s.gM,e._Y,e.Fj,e.JJ,e.JL,e.F,e.oH],styles:["p[_ngcontent-%COMP%]{line-height:1.8}"]}),h})()},9311:(U,I,a)=>{"use strict";a.d(I,{J:()=>M});var e=a(4650),_=a(6895);const i=function(d){return{height:d}};function v(d,m){if(1&d&&(e.TgZ(0,"div"),e._UZ(1,"div",2),e.qZA()),2&d){const t=e.oxw();e.Tol(t.colClass),e.xp6(1),e.ekj("mat-elevation-z1",t.hasShadow),e.Q6J("ngStyle",e.VKq(5,i,t.blockHeight))}}let M=(()=>{class d{constructor(){this.amount=2,this.colClass="col-12",this.blockHeight="375px",this.hasShadow=!0,this.itemsArray=[]}ngOnInit(){for(let t=0;t<this.amount;t++)this.itemsArray.push("item"+t)}}return d.\u0275fac=function(t){return new(t||d)},d.\u0275cmp=e.Xpm({type:d,selectors:[["app-loading-skeleton"]],inputs:{amount:"amount",colClass:"colClass",blockHeight:"blockHeight",hasShadow:"hasShadow"},decls:2,vars:1,consts:[[1,"row"],[3,"class",4,"ngFor","ngForOf"],[1,"block","mb-3",3,"ngStyle"]],template:function(t,C){1&t&&(e.TgZ(0,"div",0),e.YNc(1,v,2,7,"div",1),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngForOf",C.itemsArray))},dependencies:[_.sg,_.PC],styles:[".block[_ngcontent-%COMP%]{background:#eee;background:linear-gradient(90deg,#ffffff 8%,#f2f2f2 18%,#fafafa 33%);background-size:200% 100%;animation:1s shine linear infinite;border-radius:5px;border:1px solid rgba(217,217,217,.05)}@keyframes shine{to{background-position-x:-200%}}"]}),d})()},316:(U,I,a)=>{"use strict";a.d(I,{E:()=>R});var e=a(4650),_=a(4006),i=a(8372),v=a(1884),M=a(6895),d=a(7392),m=a(4859),t=a(9549),C=a(4144),s=a(6709),n=a(266),l=a(4385),r=a(3238);function f(x,P){if(1&x){const p=e.EpF();e.TgZ(0,"mat-checkbox",10),e.NdJ("ngModelChange",function(w){e.CHM(p);const k=e.oxw();return e.KtG(k.checked=w)})("change",function(){e.CHM(p);const w=e.oxw();return e.KtG(w.filter())}),e._uU(1),e.qZA()}if(2&x){const p=e.oxw();e.Q6J("ngModel",p.checked),e.xp6(1),e.hij(" ",p.checkBoxText," ")}}function h(x,P){if(1&x&&(e.TgZ(0,"mat-option",15)(1,"span",17),e._uU(2),e.qZA()()),2&x){const p=P.$implicit;e.Q6J("value",p),e.xp6(2),e.Oqu(p)}}function S(x,P){if(1&x){const p=e.EpF();e.TgZ(0,"mat-form-field",11)(1,"span",12)(2,"mat-icon"),e._uU(3,"filter_list"),e.qZA(),e.TgZ(4,"span",13),e._uU(5,"|"),e.qZA()(),e.TgZ(6,"mat-select",14),e.NdJ("ngModelChange",function(w){e.CHM(p);const k=e.oxw();return e.KtG(k.type=w)})("selectionChange",function(){e.CHM(p);const w=e.oxw();return w.filter(),e.KtG(w.typeChanged())}),e.TgZ(7,"mat-option",15),e._uU(8," Remove filter "),e.qZA(),e.YNc(9,h,3,2,"mat-option",16),e.qZA()()}if(2&x){const p=e.oxw();e.xp6(6),e.Q6J("ngModel",p.type),e.xp6(1),e.Q6J("value",null),e.xp6(2),e.Q6J("ngForOf",p.types)}}function b(x,P){if(1&x){const p=e.EpF();e.TgZ(0,"button",18),e.NdJ("click",function(){e.CHM(p);const w=e.oxw();return e.KtG(w.removeSearchTerm())}),e.TgZ(1,"mat-icon"),e._uU(2,"close"),e.qZA()()}}function y(x,P){if(1&x&&(e.TgZ(0,"mat-icon"),e._uU(1),e.qZA()),2&x){const p=e.oxw(2);e.xp6(1),e.Oqu(p.buttonIcon)}}function O(x,P){if(1&x){const p=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(){e.CHM(p);const w=e.oxw();return e.KtG(w.buttonClicked())}),e.YNc(1,y,2,1,"mat-icon",20),e._uU(2),e.qZA()}if(2&x){const p=e.oxw();e.Q6J("disabled",p.buttonDisabled),e.xp6(1),e.Q6J("ngIf",p.buttonIcon),e.xp6(1),e.hij(" ",p.buttonText," ")}}function A(x,P){if(1&x){const p=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(){e.CHM(p);const w=e.oxw();return e.KtG(w.button2Clicked())}),e._uU(1),e.qZA()}if(2&x){const p=e.oxw();e.Q6J("disabled",p.button2Disabled),e.xp6(1),e.hij(" ",p.button2Text," ")}}let R=(()=>{class x{constructor(){this.filterList=new e.vpe,this.buttonClick=new e.vpe,this.button2Click=new e.vpe,this.typeChange=new e.vpe,this.checkBoxText=null,this.buttonText=null,this.button2Text=null,this.buttonIcon=null,this.buttonDisabled=!1,this.button2Disabled=!1,this.checked=!1}ngOnInit(){this.filterControl=new _.NI(""),this.filterControl.valueChanges.pipe((0,i.b)(400),(0,v.x)()).subscribe(()=>{this.filter()})}removeSearchTerm(){this.filterControl.setValue("")}filter(){const p={};this.filterControl.value?.length>0&&(p.searchKey=this.filterControl.value),this.type&&(p.type=this.type),this.checkBoxText&&(p.checked=this.checked),this.filterList.emit(p)}typeChanged(){this.typeChange?.emit(this.type)}buttonClicked(){this.buttonClick.emit()}button2Clicked(){this.button2Click.emit()}}return x.\u0275fac=function(p){return new(p||x)},x.\u0275cmp=e.Xpm({type:x,selectors:[["app-searchbox"]],inputs:{types:"types",type:"type",checkBoxText:"checkBoxText",buttonText:"buttonText",button2Text:"button2Text",buttonIcon:"buttonIcon",buttonDisabled:"buttonDisabled",button2Disabled:"button2Disabled"},outputs:{filterList:"filterList",buttonClick:"buttonClick",button2Click:"button2Click",typeChange:"typeChange"},decls:14,vars:6,consts:[[1,"d-flex","justify-content-md-between","align-items-md-center","align-items-end","flex-md-row","w-100"],["color","primary","class","mt-md-0 mt-1 me-3",3,"ngModel","ngModelChange","change",4,"ngIf"],["class","w-100 standalone-field me-3",4,"ngIf"],[1,"w-100","standalone-field"],["matPrefix","","matTooltip","Search for item(s)",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],[1,"text-muted"],["matInput","","placeholder","Search ...","autocomplete","off",3,"formControl"],["input",""],["mat-icon-button","","matSuffix","",3,"click",4,"ngIf"],["mat-flat-button","","color","primary","class","ms-3",3,"disabled","click",4,"ngIf"],["color","primary",1,"mt-md-0","mt-1","me-3",3,"ngModel","ngModelChange","change"],[1,"w-100","standalone-field","me-3"],["matPrefix","","matTooltip","Filter on type",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],[1,"text-muted","ms-1"],["placeholder","Type ...",3,"ngModel","ngModelChange","selectionChange"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"d-block","name-line"],["mat-icon-button","","matSuffix","",3,"click"],["mat-flat-button","","color","primary",1,"ms-3",3,"disabled","click"],[4,"ngIf"]],template:function(p,D){if(1&p&&(e.TgZ(0,"div",0),e.YNc(1,f,2,2,"mat-checkbox",1),e.YNc(2,S,10,3,"mat-form-field",2),e.TgZ(3,"mat-form-field",3)(4,"span",4)(5,"mat-icon"),e._uU(6,"search"),e.qZA(),e.TgZ(7,"span",5),e._uU(8,"|"),e.qZA()(),e._UZ(9,"input",6,7),e.YNc(11,b,3,0,"button",8),e.qZA(),e.YNc(12,O,3,3,"button",9),e.YNc(13,A,2,2,"button",9),e.qZA()),2&p){const w=e.MAs(10);e.xp6(1),e.Q6J("ngIf",D.checkBoxText),e.xp6(1),e.Q6J("ngIf",(null==D.types?null:D.types.length)>0),e.xp6(7),e.Q6J("formControl",D.filterControl),e.xp6(2),e.Q6J("ngIf",""!==w.value),e.xp6(1),e.Q6J("ngIf",D.buttonText||D.buttonIcon),e.xp6(1),e.Q6J("ngIf",D.button2Text)}},dependencies:[M.sg,M.O5,d.Hw,m.lW,t.KE,t.qo,t.R9,C.Nt,s.oG,n.gM,l.gD,r.ey,_.Fj,_.JJ,_.On,_.oH],encapsulation:2}),x})()},5944:(U,I,a)=>{"use strict";a.d(I,{K:()=>m});var e=a(2843),_=a(3224),i=a(4650),v=a(529),M=a(9845),d=a(9214);let m=(()=>{class t{constructor(s,n,l){this.httpClient=s,this.httpService=n,this.fileService=l}localManifests(){return this.httpService.get("/magic/system/bazar/app-manifests")}listBazarItems(s,n,l){let r="?limit="+l;return n&&0!==n&&(r+="&offset="+n),s&&""!==s&&(r+="&name.like="+encodeURIComponent(s+"%")),r+="&order=created&direction=desc&type.eq=module",this.httpClient.get(_.N.bazarUrl+"/magic/modules/bazar/apps"+r)}getBazarItem(s){const n="?folder_name.eq="+encodeURIComponent(s);return this.httpClient.get(_.N.bazarUrl+"/magic/modules/bazar/apps"+n)}countBazarItems(s){let n="";return s&&""!==s&&(n+="?name.like="+encodeURIComponent(s+"%")),n+=""===n?"?type.eq=module":"&type.eq=module",this.httpClient.get(_.N.bazarUrl+"/magic/modules/bazar/apps-count"+n)}subscribeToNewsletter(s){return this.httpClient.post(_.N.bazarUrl+"/magic/modules/bazar/subscribe",s)}purchaseBazarItem(s,n,l,r,f){const h={product_id:s.id,name:n,customer_email:l,subscribe:r,redirect_url:window.location.href.split("?")[0]};return f&&""!==f&&(h.promo_code=f),this.httpClient.post(_.N.bazarUrl+"/magic/modules/bazar/purchase",h)}canDownloadBazarItem(s){return this.httpClient.get(_.N.bazarUrl+"/magic/modules/bazar/can-download?token="+encodeURIComponent(s))}downloadBazarItem(s,n){return this.httpService.post("/magic/system/bazar/download-from-bazar",{url:_.N.bazarUrl+"/magic/modules/bazar/download?token="+n,name:s.folder_name})}updateBazarItem(s){return s.token&&""!==s.token?this.httpService.post("/magic/system/bazar/download-from-bazar",{url:_.N.bazarUrl+"/magic/modules/bazar/download?token="+s.token,name:s.module_name}):(0,e._)(()=>new Error("No token found in app's manifest"))}downloadBazarItemLocally(s){setTimeout(()=>this.fileService.downloadFolder("/modules/"+s+"/"),1e3)}canInstall(s){return this.httpService.get("/magic/system/bazar/can-install?required_magic_version="+encodeURIComponent(s))}installBazarItem(s,n,l,r){return this.httpService.put("/magic/system/file-system/install",{folder:"/modules/"+s+"/",app_version:n,name:l,token:r})}prompt(s,n){const l=_.N.bazarUrl+"/magic/system/openai/prompt?prompt="+encodeURIComponent(s)+"&type=aista_com&recaptcha_response="+encodeURIComponent(n);return this.httpClient.get(l)}}return t.\u0275fac=function(s){return new(s||t)(i.LFG(v.eN),i.LFG(M.O),i.LFG(d.I))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},1565:(U,I,a)=>{"use strict";a.d(I,{Q:()=>i});var e=a(4650),_=a(9845);let i=(()=>{class v{constructor(d){this.httpService=d}list(d=null){let m="";return null!==d&&(m+="?limit="+d.limit,m+="&offset="+d.offset,d.filter&&""!==d.filter&&(m+="&filter="+encodeURIComponent(d.filter))),this.httpService.get("/magic/system/cache/list"+m)}count(d=null){let m="";return null!==d&&""!==d&&(m+="?filter="+encodeURIComponent(d)),this.httpService.get("/magic/system/cache/count"+m)}delete(d){return this.httpService.delete("/magic/system/cache/delete?id="+encodeURIComponent(d))}clear(d=null){let m="";return null!==d&&""!==d&&(m+="?filter="+encodeURIComponent(d)),this.httpService.delete("/magic/system/cache/empty"+m)}}return v.\u0275fac=function(d){return new(d||v)(e.LFG(_.O))},v.\u0275prov=e.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"}),v})()},9214:(U,I,a)=>{"use strict";a.d(I,{I:()=>t});var e=a(4327),i=a(9751),v=a(4650),M=a(9845),d=a(3885),m=a(1565);let t=(()=>{class C{constructor(n,l,r){this.httpService=n,this.generalService=l,this.cacheService=r}listFiles(n,l=null){let r="?folder="+encodeURIComponent(n);return l&&(r+="&filter="+encodeURIComponent(l)),this.httpService.get("/magic/system/file-system/list-files"+r)}listFilesRecursively(n,l){let r="?folder="+encodeURIComponent(n);return this.httpService.get("/magic/system/file-system/list-files-recursively"+r+"&sys="+l)}listFolders(n){return this.httpService.get("/magic/system/file-system/list-folders?folder="+encodeURIComponent(n))}listFoldersRecursively(n,l){return this.httpService.get("/magic/system/file-system/list-folders-recursively?folder="+encodeURIComponent(n)+"&sys="+l)}loadFile(n){return this.httpService.get("/magic/system/file-system/file?file="+encodeURIComponent(n),{responseType:"text"})}saveFile(n,l){const r=n.substring(0,n.lastIndexOf("/")+1),f=new FormData,h=new Blob([l],{type:"text/plain"});return f.append("file",h,n.substring(n.lastIndexOf("/")+1)),this.httpService.put("/magic/system/file-system/file?folder="+encodeURIComponent(r),f)}rename(n,l){return this.httpService.post("/magic/system/file-system/rename",{oldName:n,newName:l})}deleteFile(n){return this.httpService.delete("/magic/system/file-system/file?file="+encodeURIComponent(n))}downloadFile(n){this.httpService.download("/magic/system/file-system/file?file="+encodeURIComponent(n)).subscribe({next:l=>{let f=l.headers.get("Content-Disposition").split(";")[1].trim().split("=")[1].replace(/"/g,"");const h=new Blob([l.body]);(0,e.saveAs)(h,f)},error:l=>this.generalService.showFeedback(l?.error?.message??l,"errorMessage","Ok",4e3)})}uploadFile(n,l){const r=new FormData;return r.append("file",l),this.httpService.put("/magic/system/file-system/file?folder="+encodeURIComponent(n),r)}uploadDatabaseBackup(n){return new i.y(l=>{const r=new FormData;r.append("file",n),this.httpService.put("/magic/system/sql/backup",r).subscribe({next:f=>{this.cacheService.delete("magic.sql.databases.sqlite.*").subscribe({next:()=>{l.next(f),l.complete()},error:h=>{l.error(h),l.complete()}})},error:f=>{l.error(f),l.complete()}})})}importUsers(n){const l=new FormData;return l.append("file",n),this.httpService.put("/magic/system/auth/import-users",l)}uploadStaticWebsite(n){return this.httpService.put("/magic/system/file-system/overwrite-folder",n)}downloadFolder(n){this.httpService.download("/magic/system/file-system/download-folder?folder="+encodeURIComponent(n)).subscribe({next:l=>{const r=l.headers.get("Content-Disposition");let f=r.substring(r.indexOf("=")+1);f=f.substring(1,f.lastIndexOf('"'));const h=new Blob([l.body],{type:"application/zip"});(0,e.saveAs)(h,f)},error:l=>this.generalService.showFeedback(l?.error?.message??l,"errorMessage")})}createFolder(n){return this.httpService.put("/magic/system/file-system/folder",{folder:n})}deleteFolder(n){return this.httpService.delete("/magic/system/file-system/folder?folder="+encodeURIComponent(n))}getMacroDefinition(n){return this.httpService.get("/magic/system/ide/macro?macro="+encodeURIComponent(n))}executeMacro(n,l){return this.httpService.post("/magic/system/ide/execute-macro",{macro:n,args:l})}installModule(n){const l=new FormData;return l.append("file",n),this.httpService.put("/magic/system/file-system/install-module",l)}unzip(n){return this.httpService.put("/magic/system/file-system/unzip",{file:n,create_folder:!0})}}return C.\u0275fac=function(n){return new(n||C)(v.LFG(M.O),v.LFG(d.m),v.LFG(m.Q))},C.\u0275prov=v.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})()},7341:(U,I,a)=>{"use strict";a.r(I),a.d(I,{PluginsModule:()=>j});var e=a(6895),_=a(2278),i=a(7832),v=a(8317),M=a(6996),d=a(3224),m=a(5938),t=a(4650),C=a(5944),s=a(3885),n=a(4859),l=a(266),r=a(2282);function f(c,T){1&c&&(t.TgZ(0,"div",8),t._uU(1," Incompatible with your current version of Magic. "),t.TgZ(2,"a",9),t._uU(3,"Download the latest verion."),t.qZA()())}function h(c,T){1&c&&(t.TgZ(0,"button",10),t._uU(1,"Close"),t.qZA())}function S(c,T){if(1&c){const o=t.EpF();t.TgZ(0,"button",11),t.NdJ("click",function(){t.CHM(o);const g=t.oxw();return t.KtG(g.update())}),t._uU(1,"Update"),t.qZA()}}function b(c,T){if(1&c){const o=t.EpF();t.TgZ(0,"button",12),t.NdJ("click",function(){t.CHM(o);const g=t.oxw();return t.KtG(g.uninstall())}),t._uU(1,"Uninstall"),t.qZA()}if(2&c){const o=t.oxw();t.Q6J("disabled",!o.deletePermission)}}function y(c,T){if(1&c){const o=t.EpF();t.TgZ(0,"button",13),t.NdJ("click",function(){t.CHM(o);const g=t.oxw();return t.KtG(g.install())}),t._uU(1,"Install"),t.qZA()}}let O=(()=>{class c{constructor(o,u,g,E){this.dialogRef=o,this.bazarService=u,this.generalService=g,this.data=E,this.installed=!1,this.canInstall=!1,this.needsCoreUpdate=!1,this.deletePermission=!1}ngOnInit(){this.getAppDetails()}getAppDetails(){this.bazarService.canInstall(this.data.min_magic_version).subscribe({next:o=>{"SUCCESS"===o.result?this.canInstall=!0:(this.generalService.showFeedback("Incompatible with your Magic version","errorMessage","Ok",5e3),this.needsCoreUpdate=!0)},error:o=>this.generalService.showFeedback(o?.error?.message??o,"errorMessage")})}update(){this.bazarService.updateBazarItem(this.data).subscribe({next:o=>{"success"===o.result&&this.bazarService.installBazarItem(this.data.module_name,this.data.new_version,this.data.name,this.data.token).subscribe({next:u=>{"success"===u.result&&(this.generalService.showFeedback("Database was successfully updated."),this.dialogRef.close())},error:u=>this.generalService.showFeedback(u?.error?.message??u,"errorMessage")})},error:o=>this.generalService.showFeedback(o?.error?.message??o,"errorMessage")})}uninstall(){this.dialogRef.close("uninstall")}install(){this.dialogRef.close("install")}}return c.\u0275fac=function(o){return new(o||c)(t.Y36(m.so),t.Y36(C.K),t.Y36(s.m),t.Y36(m.WI))},c.\u0275cmp=t.Xpm({type:c,selectors:[["app-view-plugin"]],decls:9,vars:9,consts:[["mat-dialog-content","",1,"file-content"],[3,"innerHTML"],["mat-dialog-actions","",3,"align"],["class","d-flex justify-content-end mt-5",4,"ngIf"],["mat-button","","mat-dialog-close","",4,"ngIf"],["mat-flat-button","","matTooltip","Automatically updates your app","color","warn",3,"click",4,"ngIf"],["mat-flat-button","","color","warn",3,"disabled","click",4,"ngIf"],["mat-flat-button","","color","primary",3,"click",4,"ngIf"],[1,"d-flex","justify-content-end","mt-5"],["target","_blank","href","https://polterguy.github.io/tutorials/getting-started/"],["mat-button","","mat-dialog-close",""],["mat-flat-button","","matTooltip","Automatically updates your app","color","warn",3,"click"],["mat-flat-button","","color","warn",3,"disabled","click"],["mat-flat-button","","color","primary",3,"click"]],template:function(o,u){1&o&&(t.TgZ(0,"div",0),t._UZ(1,"div",1),t.ALo(2,"marked"),t.qZA(),t.TgZ(3,"div",2),t.YNc(4,f,4,0,"div",3),t.YNc(5,h,2,0,"button",4),t.YNc(6,S,2,0,"button",5),t.YNc(7,b,2,1,"button",6),t.YNc(8,y,2,0,"button",7),t.qZA()),2&o&&(t.xp6(1),t.Q6J("innerHTML",t.lcZ(2,7,u.data.description),t.oJD),t.xp6(2),t.Q6J("align","end"),t.xp6(1),t.Q6J("ngIf",u.needsCoreUpdate),t.xp6(1),t.Q6J("ngIf",!u.data.has_update),t.xp6(1),t.Q6J("ngIf",u.data.has_update),t.xp6(1),t.Q6J("ngIf",null==u.data?null:u.data.details),t.xp6(1),t.Q6J("ngIf",!(null!=u.data&&u.data.details)))},dependencies:[e.O5,n.lW,m.ZT,m.xY,m.H8,l.gM,r.r],styles:[".file-content[_ngcontent-%COMP%]     img{max-width:100%;height:auto}"]}),c})();var A=a(9214),R=a(1565),x=a(2729),P=a(3546),p=a(9311),D=a(316);function w(c,T){1&c&&(t.ynx(0),t._UZ(1,"app-loading-skeleton",10),t.BQk()),2&c&&(t.xp6(1),t.Q6J("amount",9)("colClass","col-4")("blockHeight","180px")("hasShadow",!1))}function k(c,T){if(1&c){const o=t.EpF();t.TgZ(0,"button",19),t.NdJ("click",function(){t.CHM(o);const g=t.oxw().$implicit,E=t.oxw(2);return t.KtG(E.uninstall(g.details))}),t._uU(1,"Uninstall"),t.qZA()}}function F(c,T){if(1&c){const o=t.EpF();t.TgZ(0,"button",20),t.NdJ("click",function(){t.CHM(o);const g=t.oxw().$implicit,E=t.oxw(2);return t.KtG(E.install(g))}),t._uU(1,"Install"),t.qZA()}}function K(c,T){if(1&c){const o=t.EpF();t.TgZ(0,"div",12)(1,"div",13)(2,"p"),t._uU(3),t.qZA(),t.TgZ(4,"p",14),t._uU(5),t.qZA(),t.TgZ(6,"div",15)(7,"button",16),t.NdJ("click",function(){const E=t.CHM(o).$implicit,Z=t.oxw(2);return t.KtG(Z.viewAppDetails(E))}),t._uU(8,"Details"),t.qZA(),t.YNc(9,k,2,0,"button",17),t.YNc(10,F,2,0,"button",18),t.qZA()()()}if(2&c){const o=T.$implicit;t.xp6(3),t.Oqu(o.name),t.xp6(2),t.hij(" ",o.description," "),t.xp6(4),t.Q6J("ngIf",null==o?null:o.details),t.xp6(1),t.Q6J("ngIf",!(null!=o&&o.details))}}function z(c,T){if(1&c&&(t.TgZ(0,"div",0),t.YNc(1,K,11,4,"div",11),t.qZA()),2&c){const o=t.oxw();t.xp6(1),t.Q6J("ngForOf",o.getPluginsToDisplay(o.plugins))}}function J(c,T){if(1&c&&(t.TgZ(0,"div",21)(1,"div",22)(2,"div",23)(3,"div",24),t._UZ(4,"div",25),t.qZA(),t.TgZ(5,"h3",26),t._uU(6),t.qZA(),t.TgZ(7,"p",27),t._uU(8,"Please do NOT leave this page until the installation is completed."),t.qZA()()()()),2&c){const o=t.oxw();t.xp6(6),t.Oqu(o.currentStage)}}let N=(()=>{class c{constructor(o,u,g,E,Z,H){this.dialog=o,this.fileService=u,this.cacheService=g,this.bazarService=E,this.configService=Z,this.generalService=H,this.isLoading=!0,this.plugins=[],this.appDetails=[],this.waitingInstallation=!1,this.currentStage="Preparing plugin to be downloaded.",this.hubConnection=null,this.searchKey=null,this.installedOnly=!1}ngOnInit(){this.getItems()}getItems(){this.bazarService.listBazarItems("%%",0,1e3).subscribe({next:o=>{this.plugins=o,this.loadDetails()},error:o=>this.generalService.showFeedback(o?.error?.message??o,"errorMessage")})}loadDetails(){this.bazarService.localManifests().subscribe({next:o=>{this.appDetails=o||[],o&&(this.plugins.map(u=>this.appDetails.map(g=>{u.name===g.name&&(u.details=g)})),o.forEach(u=>{this.getVersion(u.module_name,u.version)}),this.waitingInstallation=!1),this.isLoading=!1},error:o=>this.generalService.showFeedback(o?.error?.message??o,"errorMessage")})}getVersion(o,u){this.bazarService.getBazarItem(o).subscribe({next:g=>{g&&this.versionComparision(o,u,g[0].version)}})}versionComparision(o,u,g){const E=this.plugins.find(Z=>Z?.details?.module_name===o);E&&-1===this.configService.versionCompare(u,g)&&(E.hasUpdate=!0,E.newVersion=g)}install(o){this.waitingInstallation=!0,this.configService.rootUserEmailAddress().subscribe({next:u=>{this.bazarService.purchaseBazarItem(o,u.name,u.email,!1,null).subscribe({next:g=>{this.connectSocket(g.code,o)},error:g=>{this.generalService.showFeedback(g?.error?.message??g,"errorMessage"),this.waitingInstallation=!1}})},error:()=>{this.generalService.hideLoading(),this.waitingInstallation=!1}})}connectSocket(o,u){let g=new v.su;this.hubConnection=g.withUrl(d.N.bazarUrl+"/sockets",{skipNegotiation:!0,transport:v.n4.WebSockets}).build(),this.hubConnection.on("bazar.package.avilable."+o,E=>{this.getPlugin(u,o)}),this.hubConnection.start().then(()=>{this.getPlugin(u,o)})}getPlugin(o,u){this.currentStage="Downloading plugin",this.bazarService.downloadBazarItem(o,u).subscribe({next:g=>{"success"===g.result?(this.currentStage="Installing plugin",this.bazarService.installBazarItem(o.folder_name,o.version,o.name,u).subscribe({next:E=>{"success"===E.result?(this.generalService.showFeedback("Plugin was successfully installed on your cloudlet","successMessage"),this.loadDetails(),this.cacheService.delete("magic.sql.databases.sqlite.*").subscribe(),this.hubConnection&&(this.hubConnection.stop(),this.hubConnection=null)):this.generalService.showFeedback("Oops! Please check the system log.","errorMessage","Ok",5e3)},error:E=>this.generalService.showFeedback(E?.error?.message??E,"errorMessage")})):this.generalService.showFeedback("Oops! Please check the system log.","errorMessage","Ok",5e3)},error:g=>{this.hubConnection&&(this.hubConnection.stop(),this.hubConnection=null),this.generalService.hideLoading(),this.waitingInstallation=!1,this.generalService.showFeedback("Refresh the page and try again.","errorMessage")}})}uninstall(o){this.dialog.open(M.z,{width:"500px",data:{title:"Delete database",description_extra:`You are deleting the following database: <br/> <span class="fw-bold">${o?.name}</span> <br/><br/> Do you want to continue?`,action_btn:"Delete",action_btn_color:"warn",bold_description:!0}}).afterClosed().subscribe(u=>{"confirm"===u&&this.fileService.deleteFolder("/modules/"+o.module_name+"/").subscribe({next:()=>{this.generalService.showFeedback(o.name+" uninstalled successfully.","successMessage"),this.clearServersideCache(),this.getItems()},error:g=>{this.generalService.showFeedback(g?.error?.message??g,"errorMessage")}})})}viewAppDetails(o){this.dialog.open(O,{minWidth:"500px",data:o}).afterClosed().subscribe(u=>{"uninstall"===u&&this.uninstall(o.details),"install"===u&&this.install(o)})}clearServersideCache(){this.cacheService.delete("magic.sql.databases.*").subscribe({next:()=>{}})}filterList(o){this.installedOnly=o.checked??!1,this.searchKey=o.searchKey??null}getPluginsToDisplay(){return this.plugins.filter(o=>!(this.installedOnly&&!o.details||this.searchKey&&this.searchKey.length>0&&-1===o.name.toLowerCase().indexOf(this.searchKey.toLowerCase())))}}return c.\u0275fac=function(o){return new(o||c)(t.Y36(m.uw),t.Y36(A.I),t.Y36(R.Q),t.Y36(C.K),t.Y36(x.E),t.Y36(s.m))},c.\u0275cmp=t.Xpm({type:c,selectors:[["app-plugins"]],decls:14,vars:3,consts:[[1,"row"],[1,"col-xl-7","col-lg-6","col-md-5","col-sm-6","col-12"],[1,"fw-bold"],[1,"text-muted"],[1,"col-xl-5","col-lg-6","col-md-7","col-sm-6","col-12"],["checkBoxText","Show installed only",3,"filterList"],[1,"col-12","mt-md-0","mt-4"],[4,"ngIf"],["class","row",4,"ngIf"],["class","waiting-overlay",4,"ngIf"],[3,"amount","colClass","blockHeight","hasShadow"],["class","col-lg-4 col-md-6 col-12 mb-4",4,"ngFor","ngForOf"],[1,"col-lg-4","col-md-6","col-12","mb-4"],[1,"w-100","h-100","bg-light","p-3"],[1,"line-truncate","text-muted","mt-3","mb-4"],[1,"d-flex","justify-content-end"],["mat-button","","color","primary",3,"click"],["mat-flat-button","","color","warn","class","px-5",3,"click",4,"ngIf"],["mat-flat-button","","color","primary","class","px-5",3,"click",4,"ngIf"],["mat-flat-button","","color","warn",1,"px-5",3,"click"],["mat-flat-button","","color","primary",1,"px-5",3,"click"],[1,"waiting-overlay"],[1,"row","h-100","align-items-center","justify-content-center"],[1,"col-xxl-2","col-xl-3","col-md-4","col-sm-5","col-6"],[1,"d-flex","w-100","justify-content-center"],[1,"wating-dot-animation"],[1,"text-center","mt-5"],[1,"mat-h3","text-center","mt-4"]],template:function(o,u){1&o&&(t.TgZ(0,"mat-card")(1,"mat-card-content")(2,"div",0)(3,"div",1)(4,"h3",2),t._uU(5,"Plugins"),t.qZA(),t.TgZ(6,"p",3),t._uU(7,"Purchase and install micro services"),t.qZA()(),t.TgZ(8,"div",4)(9,"app-searchbox",5),t.NdJ("filterList",function(E){return u.filterList(E)}),t.qZA()(),t.TgZ(10,"div",6),t.YNc(11,w,2,4,"ng-container",7),t.YNc(12,z,2,1,"div",8),t.qZA()()()(),t.YNc(13,J,9,1,"div",9)),2&o&&(t.xp6(11),t.Q6J("ngIf",u.isLoading),t.xp6(1),t.Q6J("ngIf",!u.isLoading),t.xp6(1),t.Q6J("ngIf",u.waitingInstallation))},dependencies:[e.sg,e.O5,n.lW,P.a8,P.dn,p.J,D.E],styles:['.line-truncate[_ngcontent-%COMP%]{line-height:1.5;font-size:12px;display:block;display:-webkit-box;max-width:500px;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}.waiting-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:1080;color:#fff;background-color:#060d16e6;animation-name:fadeIn;animation-duration:1s;animation-fill-mode:forwards}.wating-dot-animation[_ngcontent-%COMP%]{position:relative;left:-9999px;width:10px;height:10px;border-radius:5px;background-color:#0080ff;color:#0080ff;box-shadow:9999px 0 #0080ff;animation:waitingDot 1s infinite linear;animation-delay:.1s}.wating-dot-animation[_ngcontent-%COMP%]:before, .wating-dot-animation[_ngcontent-%COMP%]:after{content:"";display:inline-block;position:absolute;top:0}.wating-dot-animation[_ngcontent-%COMP%]:before{width:10px;height:10px;border-radius:5px;background-color:#0080ff;color:#0080ff;animation:waitingDotBefore 1s infinite linear;animation-delay:0s}.wating-dot-animation[_ngcontent-%COMP%]:after{width:10px;height:10px;border-radius:5px;background-color:#0080ff;color:#0080ff;animation:waitingDotAfter 1s infinite linear;animation-delay:.2s}@keyframes waitingDot{0%{box-shadow:9999px -15px #9880ff00}25%,50%,75%{box-shadow:9999px 0 #0080ff}to{box-shadow:9999px 15px #9880ff00}}@keyframes waitingDotBefore{0%{box-shadow:9984px -15px #9880ff00}25%,50%,75%{box-shadow:9984px 0 #0080ff}to{box-shadow:9984px 15px #9880ff00}}@keyframes waitingDotAfter{0%{box-shadow:10014px -15px #9880ff00}25%,50%,75%{box-shadow:10014px 0 #0080ff}to{box-shadow:10014px 15px #9880ff00}}']}),c})();var B=a(9132);const W=[{path:"",component:N}];let Y=(()=>{class c{}return c.\u0275fac=function(o){return new(o||c)},c.\u0275mod=t.oAB({type:c}),c.\u0275inj=t.cJS({imports:[B.Bz.forChild(W),B.Bz]}),c})();var L=a(4006),Q=a(1075);let j=(()=>{class c{}return c.\u0275fac=function(o){return new(o||c)},c.\u0275mod=t.oAB({type:c}),c.\u0275inj=t.cJS({imports:[e.ez,Y,_.q,i.K,L.u5,L.UX,Q.m]}),c})()},4327:function(U,I){var _;void 0!==(_=function(){"use strict";function v(s,n,l){var r=new XMLHttpRequest;r.open("GET",s),r.responseType="blob",r.onload=function(){C(r.response,n,l)},r.onerror=function(){console.error("could not download file")},r.send()}function M(s){var n=new XMLHttpRequest;n.open("HEAD",s,!1);try{n.send()}catch{}return 200<=n.status&&299>=n.status}function d(s){try{s.dispatchEvent(new MouseEvent("click"))}catch{var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),s.dispatchEvent(n)}}var m="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,t=m.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),C=m.saveAs||("object"!=typeof window||window!==m?function(){}:"download"in HTMLAnchorElement.prototype&&!t?function(s,n,l){var r=m.URL||m.webkitURL,f=document.createElement("a");f.download=n=n||s.name||"download",f.rel="noopener","string"==typeof s?(f.href=s,f.origin===location.origin?d(f):M(f.href)?v(s,n,l):d(f,f.target="_blank")):(f.href=r.createObjectURL(s),setTimeout(function(){r.revokeObjectURL(f.href)},4e4),setTimeout(function(){d(f)},0))}:"msSaveOrOpenBlob"in navigator?function(s,n,l){if(n=n||s.name||"download","string"!=typeof s)navigator.msSaveOrOpenBlob(function i(s,n){return typeof n>"u"?n={autoBom:!1}:"object"!=typeof n&&(console.warn("Deprecated: Expected third argument to be a object"),n={autoBom:!n}),n.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(s.type)?new Blob(["\ufeff",s],{type:s.type}):s}(s,l),n);else if(M(s))v(s,n,l);else{var r=document.createElement("a");r.href=s,r.target="_blank",setTimeout(function(){d(r)})}}:function(s,n,l,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),"string"==typeof s)return v(s,n,l);var f="application/octet-stream"===s.type,h=/constructor/i.test(m.HTMLElement)||m.safari,S=/CriOS\/[\d]+/.test(navigator.userAgent);if((S||f&&h||t)&&typeof FileReader<"u"){var b=new FileReader;b.onloadend=function(){var A=b.result;A=S?A:A.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=A:location=A,r=null},b.readAsDataURL(s)}else{var y=m.URL||m.webkitURL,O=y.createObjectURL(s);r?r.location=O:location.href=O,r=null,setTimeout(function(){y.revokeObjectURL(O)},4e4)}});m.saveAs=C.saveAs=C,U.exports=C}.apply(I,[]))&&(U.exports=_)}}]);