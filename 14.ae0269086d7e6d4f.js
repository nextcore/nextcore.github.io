"use strict";(self.webpackChunkmagic=self.webpackChunkmagic||[]).push([[14],{9554:(A,u,r)=>{r.d(u,{v:()=>m});const m={name:"Name must be minimum 2 characters long",backendname:"Alphanumeric characters between 2 to 20 (no space).",username:"Alphanumeric between 2 and 20 characters (no space)",email:"Email must be a valid email address",confirmEmail:"Email addresses must match",confirmPassword:"Passwords must match",currentPassword:"Your password is incorrect",cloudletName:"Minimum of 5 characters, only lowercase and numbers",phone:"e.g. 1111111111",subject:"2 to 30 letters, without special characters",message:"Message cannot be less than 3 characters",appNames:"Only lowercase alphanumeric characters, dot (.), - or _ please",appNamesWithUppercaseDot:"Only alphanumeric characters, dot (.), - or _ please",appNamesWithDot:"Only lowercase alphanumeric characters, and - or _ please",appNameWithUppercase:"Accepts alphanumeric characters and _",appNameWithUppercaseHyphen:"Accepts alphanumeric characters, - and _",domain:"Domain is not valid",backend:"Backend URL must contain http://",password:"Minimum 12 characters",recaptcha:"Not valid reCAPTCHA secret or key"}},8194:(A,u,r)=>{r.d(u,{g:()=>m});const m={phone:/^[0-9 ]*$/,name:/^[a-z0-9]{2,20}$/,subject:/^.{4,1000}$/,appNames:/^[a-z0-9_.-]+$/,appNamesWithDot:/^[a-z0-9_.-]+$/,appNamesWithUppercaseDot:/^[a-zA-Z0-9_.-]+$/,appNameWithUppercase:/^[a-zA-Z0-9_]+$/,appNameWithUppercaseHyphen:/^[a-zA-Z0-9_-]+$/,domain:/(^https?:\/\/)([\w\-])+\.{1}([a-zA-Z]{2,63})([\/\w-]*)*\/?\??([^#\n\r]*)?#?([^\n\r]*)/,backend:/^https?:\/\/([\w\-.])+(:[0-9]*)?(\.\w+)?$/,email:/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/,password:/^.{12,}$/,recaptcha:/^([a-zA-Z-_0-9]{20,100})$/}},7832:(A,u,r)=>{r.d(u,{K:()=>h});var m=r(6895),l=r(2278),s=r(4006),v=r(1103),g=r(4650);let h=(()=>{class e{}return e.\u0275fac=function(f){return new(f||e)},e.\u0275mod=g.oAB({type:e}),e.\u0275inj=g.cJS({imports:[m.ez,l.q,s.u5,s.UX,v.k]}),e})()},6014:(A,u,r)=>{r.r(u),r.d(u,{AuthModule:()=>Y});var m=r(6895),l=r(9132),s=r(4006),v=r(9554),g=r(8194),h=r(6015),e=r(4650),b=r(3885),f=r(8710),_=r(4631),Z=r(7392),y=r(4859),d=r(9549),F=r(4144),C=r(266),U=r(3238),T=r(7957);function P(a,i){1&a&&(e.TgZ(0,"mat-error"),e._uU(1," Backend is required "),e.qZA())}function S(a,i){1&a&&(e.TgZ(0,"mat-error"),e._uU(1," Backend must be a valid URL "),e.qZA())}function x(a,i){if(1&a&&(e.TgZ(0,"mat-option",23),e._uU(1),e.qZA()),2&a){const o=i.$implicit;e.Q6J("value",o.url),e.xp6(1),e.hij(" ",o.url," ")}}function M(a,i){1&a&&(e.TgZ(0,"mat-error"),e._uU(1,"Username is required"),e.qZA())}function L(a,i){1&a&&(e.TgZ(0,"mat-error"),e._uU(1," Password is required "),e.qZA())}let N=(()=>{class a{constructor(o,t,n,c,p,k){this.formBuilder=o,this.generalService=t,this.backendService=n,this.router=c,this.backendStorageService=p,this.activatedRoute=k,this.backendList=[],this.loginForm=this.formBuilder.group({username:["",[s.kI.required]],password:["",[s.kI.required]],backend:["",[s.kI.required,s.kI.pattern(/^(http|https):\/\/[^ "]+$/)]]}),this.viewPassword=!1,this.waiting=!1,this.CommonRegEx=g.g,this.CommonErrorMessages=v.v}ngOnInit(){this.waitForBackend()}waitForBackend(){this.backendList=this.backendService.backends,this.activatedRoute.queryParams.subscribe(o=>{if(o.switchTo){this.loginForm.controls.backend.setValue(o.switchTo);const t=this.backendList.find(n=>n.url===o.switchTo);t&&(this.loginForm.controls.username.setValue(t.username),this.loginForm.controls.password.setValue(t.password))}else if(o.backend){this.loginForm.controls.backend.setValue(o.backend);const t=this.backendList.find(n=>n.url===o.backend.url);t&&(this.loginForm.controls.username.setValue(t.username),this.loginForm.controls.password.setValue(t.password))}else if(this.backendList.length>0){const t=this.backendList[0];this.loginForm.controls.backend.setValue(t.url),this.loginForm.controls.username.setValue(t.username),this.loginForm.controls.password.setValue(t.password)}})}backendActivated(o){const t=this.backendList.find(n=>n.url===o.option.value);this.loginForm.controls.username.setValue(t.username),t.password&&this.loginForm.controls.password.setValue(t.password)}login(){if(!g.g.backend.test(this.loginForm.controls.backend.value.replace(/\/$/,"")))return void this.generalService.showFeedback("Backend URL is not valid","errorMessage","Ok");this.waiting=!0;const o=new h.z(this.loginForm.controls.backend.value.replace(/\/$/,""),this.loginForm.value.username,this.loginForm.value.password);this.backendService.upsert(o),this.backendService.activate(o),this.backendService.login(this.loginForm.value.username,this.loginForm.value.password,!0).subscribe({next:()=>{this.router.navigate(["/"]),setTimeout(()=>{this.waiting=!1},1e3)},error:t=>{this.generalService.showFeedback(t?.error?.message??t??"Something went wrong while trying to login","errorMessage","Ok"),this.waiting=!1}})}}return a.\u0275fac=function(o){return new(o||a)(e.Y36(s.QS),e.Y36(b.m),e.Y36(f.v),e.Y36(l.F0),e.Y36(_.d),e.Y36(l.gz))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-login"]],decls:50,vars:11,consts:[[1,"row"],[1,"col-12","mb-2"],[1,"mat-title","mb-2","fw-bold"],[1,"text-muted","mat-body-2"],[1,"w-100",3,"formGroup","ngSubmit"],[1,"w-100"],["matPrefix","","matTooltip","Backend you want to login to",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],[1,"text-muted","mx-2"],["type","text","matInput","","autocomplete","off","formControlName","backend",3,"matAutocomplete"],[4,"ngIf"],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["matPrefix","","matTooltip","Username or email address",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],["matInput","text","autofocus","","placeholder","Username","formControlName","username","name","username","type","username","autocomplete","username"],[1,"col-12","mb-lg-0","mb-2"],["matPrefix","","matTooltip","Your password",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],["matInput","password","placeholder","Password","formControlName","password","name","password","autocomplete","password",3,"type"],["mat-icon-button","","type","button","matSuffix","","tabindex","-1",3,"click"],[1,"col-12","mb-4"],[1,"d-flex","justify-content-end"],["mat-button","","color","primary","routerLink","/authentication/forgot-password",1,"pe-0","mat-body-1"],["type","submit","mat-flat-button","","color","primary",1,"d-block","w-100","mb-4","auth-submit-button",3,"disabled"],[3,"value"]],template:function(o,t){if(1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"p",2),e._uU(3,"Magic Dashboard"),e.qZA(),e.TgZ(4,"p",3),e._uU(5,"Hi again, happy to see you"),e.qZA()()(),e.TgZ(6,"form",4),e.NdJ("ngSubmit",function(){return t.login()}),e.TgZ(7,"div",0)(8,"div",1)(9,"mat-form-field",5)(10,"span",6)(11,"mat-icon"),e._uU(12,"database"),e.qZA(),e.TgZ(13,"span",7),e._uU(14,"|"),e.qZA()(),e._UZ(15,"input",8),e.YNc(16,P,2,0,"mat-error",9),e.YNc(17,S,2,0,"mat-error",9),e.TgZ(18,"mat-autocomplete",10,11),e.NdJ("optionSelected",function(c){return t.backendActivated(c)}),e.YNc(20,x,2,2,"mat-option",12),e.qZA(),e.TgZ(21,"mat-hint"),e._uU(22),e.qZA()()(),e.TgZ(23,"div",1)(24,"mat-form-field",5)(25,"span",13)(26,"mat-icon"),e._uU(27,"contact_mail"),e.qZA(),e.TgZ(28,"span",7),e._uU(29,"|"),e.qZA()(),e._UZ(30,"input",14),e.YNc(31,M,2,0,"mat-error",9),e.qZA()(),e.TgZ(32,"div",15)(33,"mat-form-field",5)(34,"span",16)(35,"mat-icon"),e._uU(36,"password"),e.qZA(),e.TgZ(37,"span",7),e._uU(38,"|"),e.qZA()(),e._UZ(39,"input",17),e.TgZ(40,"button",18),e.NdJ("click",function(){return t.viewPassword=!t.viewPassword}),e.TgZ(41,"mat-icon"),e._uU(42),e.qZA()(),e.YNc(43,L,2,0,"mat-error",9),e.qZA()(),e.TgZ(44,"div",19)(45,"div",20)(46,"a",21),e._uU(47," Forgot password? "),e.qZA()()()(),e.TgZ(48,"button",22),e._uU(49," Sign in "),e.qZA()()),2&o){const n=e.MAs(19);e.xp6(6),e.Q6J("formGroup",t.loginForm),e.xp6(9),e.Q6J("matAutocomplete",n),e.xp6(1),e.Q6J("ngIf",null==t.loginForm.controls.backend.errors?null:t.loginForm.controls.backend.errors.required),e.xp6(1),e.Q6J("ngIf",null==t.loginForm.controls.backend.errors?null:t.loginForm.controls.backend.errors.pattern),e.xp6(3),e.Q6J("ngForOf",t.backendStorageService.backends),e.xp6(2),e.Oqu(t.CommonErrorMessages.backend),e.xp6(9),e.Q6J("ngIf",null==t.loginForm.controls.username.errors?null:t.loginForm.controls.username.errors.required),e.xp6(8),e.Q6J("type",t.viewPassword?"text":"password"),e.xp6(3),e.hij("visibility",t.viewPassword?"_off":"",""),e.xp6(1),e.Q6J("ngIf",null==t.loginForm.controls.password.errors?null:t.loginForm.controls.password.errors.required),e.xp6(5),e.Q6J("disabled",t.waiting)}},dependencies:[m.sg,m.O5,l.yS,Z.Hw,y.lW,y.zs,d.TO,d.KE,d.bx,d.qo,d.R9,F.Nt,C.gM,U.ey,T.XC,T.ZL,s._Y,s.Fj,s.JJ,s.JL,s.sg,s.u],encapsulation:2}),a})();var w=r(4700);const J=["captchaRef"];function E(a,i){if(1&a){const o=e.EpF();e.TgZ(0,"re-captcha",16,17),e.NdJ("resolved",function(n){e.CHM(o);const c=e.oxw();return e.KtG(n&&c.forgotPass(n))}),e.qZA()}if(2&a){const o=e.oxw();e.Q6J("siteKey",o.recaptchaKey)}}const B=[{path:"login",component:N},{path:"forgot-password",component:(()=>{class a{constructor(o,t,n,c){this.formBuilder=o,this.generalService=t,this.backendService=n,this.router=c,this.forgotPassForm=this.formBuilder.group({username:["",[s.kI.required]]}),this.errors=v.v,this.viewPassword=!1,this.rememberPassword=!1,this.waiting=!1,this.recaptchaKey=null,this.backendService._activeCaptchaValue.subscribe(p=>{this.recaptchaKey=p})}forgotPass(o){if(this.forgotPassForm.valid){this.waiting=!0;const t=null!==this.recaptchaKey&&""!==this.recaptchaKey?{username:this.forgotPassForm.value.username,frontendUrl:window.location.origin+"/authentication/reset-password",recaptcha_response:o}:{username:this.forgotPassForm.value.username,frontendUrl:window.location.origin+"/authentication/reset-password"};this.backendService.resetPassword(t).subscribe({next:n=>{this.waiting=!1,n&&n?.Error||(this.generalService.showFeedback("A reset password link is sent to your email","successMessage","Ok",5e3),this.router.navigateByUrl("/authentication/login"))},error:n=>this.generalService.showFeedback(n?.error?.message??n,"errorMessage")})}else this.generalService.showFeedback("All fields are required","errorMessage","Ok")}executeRecaptcha(){this.captchaRef?.execute()}}return a.\u0275fac=function(o){return new(o||a)(e.Y36(s.QS),e.Y36(b.m),e.Y36(f.v),e.Y36(l.F0))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-forgot-password"]],viewQuery:function(o,t){if(1&o&&e.Gf(J,5),2&o){let n;e.iGM(n=e.CRH())&&(t.captchaRef=n.first)}},decls:26,vars:3,consts:[[1,"row"],[1,"col-12"],[1,"mat-title","mb-2","fw-bold"],[1,"text-muted","mat-body-2"],[1,"w-100",3,"formGroup","ngSubmit"],[1,"col-12","mb-3"],[1,"w-100"],["matPrefix","",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],[1,"text-muted","mx-2"],["matInput","text","placeholder","Username","formControlName","username","name","username","type","text","required","","autocomplete","username"],["size","invisible",3,"siteKey","resolved",4,"ngIf"],["type","submit","mat-flat-button","","color","primary",1,"d-block","w-100","mt-3","mb-4","auth-submit-button",3,"disabled","click"],[1,"row","mt-auto","mb-4"],[1,"col-12","text-center"],[1,"mat-body-2","text-muted","mb-0","d-flex","align-items-center","justify-content-center"],["mat-button","","color","primary","routerLink","/authentication/login",1,"px-0"],["size","invisible",3,"siteKey","resolved"],["captchaRef","reCaptcha"]],template:function(o,t){1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"p",2),e._uU(3,"Forgot password"),e.qZA(),e.TgZ(4,"p",3),e._uU(5,"A link will be sent to the email address associated with your username"),e.qZA()()(),e.TgZ(6,"form",4),e.NdJ("ngSubmit",function(){return t.forgotPass()}),e.TgZ(7,"div",0)(8,"div",5)(9,"mat-form-field",6)(10,"span",7)(11,"mat-icon"),e._uU(12,"contact_mail"),e.qZA(),e.TgZ(13,"span",8),e._uU(14,"|"),e.qZA()(),e._UZ(15,"input",9),e.qZA()()(),e.YNc(16,E,2,1,"re-captcha",10),e.TgZ(17,"button",11),e.NdJ("click",function(){return""!==t.recaptchaKey&&null!==t.recaptchaKey?t.executeRecaptcha():t.forgotPass()}),e._uU(18," Submit request "),e.qZA()(),e.TgZ(19,"div",12)(20,"div",13)(21,"p",14),e._uU(22," Remember your password? "),e.TgZ(23,"button",15),e._uU(24,"Sign in"),e.qZA(),e._uU(25," now. "),e.qZA()()()),2&o&&(e.xp6(6),e.Q6J("formGroup",t.forgotPassForm),e.xp6(10),e.Q6J("ngIf",""!==t.recaptchaKey&&null!==t.recaptchaKey),e.xp6(1),e.Q6J("disabled",t.waiting))},dependencies:[m.O5,l.rH,Z.Hw,y.lW,d.KE,d.qo,F.Nt,s._Y,s.Fj,s.JJ,s.JL,s.Q7,s.sg,s.u,w.wT],encapsulation:2}),a})()},{path:"auto-auth",component:(()=>{class a{constructor(o,t,n){this.backendService=o,this.activatedRoute=t,this.router=n}ngOnInit(){this.activatedRoute.queryParamMap.subscribe(o=>{this.getParams(o)})}getParams(o){const t=o.params.backend;if(t){const n=new h.z(t),c=this.backendService.backends.filter(p=>p.url===n.url);c.length>0&&(n.username=c[0].username,n.password=c[0].password,n.token=c[0].token),this.backendService.activate(n),this.backendService.upsert(n),null===n.token?this.router.navigate(["/authentication/login/"],{queryParamsHandling:"preserve"}):window.location.href="/"}else{const n=o.params.token;if(n&&n.includes(".")){const k=new h.z(o.params.url,o.params.username,null,n);this.backendService.upsert(k),this.backendService.activate(k),this.backendService.verifyToken().subscribe({next:()=>{this.backendService.active.token.in_role("reset-password")?this.router.navigate(["/authentication/reset-password"]):this.router.navigate(["/"])}})}else if(n){const c=new h.z(o.params.url,o.params.username);this.backendService.upsert(c),this.backendService.activate(c),this.router.navigate(["/"])}else this.router.navigate(["/"])}}}return a.\u0275fac=function(o){return new(o||a)(e.Y36(f.v),e.Y36(l.gz),e.Y36(l.F0))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-auto-auth"]],decls:6,vars:0,consts:[[1,"row"],[1,"col-12","mb-2"],[1,"mat-title","mb-2","fw-bold"],[1,"text-muted","mat-body-2"]],template:function(o,t){1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"p",2),e._uU(3,"Please wait while we sign you in"),e.qZA(),e.TgZ(4,"p",3),e._uU(5,"Hi again, happy to see you"),e.qZA()()())},encapsulation:2}),a})()},{path:"",pathMatch:"full",redirectTo:"login"}];let R=(()=>{class a{}return a.\u0275fac=function(o){return new(o||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[l.Bz.forChild(B),l.Bz]}),a})();var q=r(2278),O=r(7832),I=r(529);let Y=(()=>{class a{}return a.\u0275fac=function(o){return new(o||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[m.ez,I.JF,R,q.q,O.K,s.u5,s.UX,w.a,w.dw,w.lQ]}),a})()}}]);