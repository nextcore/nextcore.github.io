"use strict";(self.webpackChunkmagic=self.webpackChunkmagic||[]).push([[789],{9554:(S,_,a)=>{a.d(_,{v:()=>p});const p={name:"Name must be minimum 2 characters long",backendname:"Alphanumeric characters between 2 to 20 (no space).",username:"Alphanumeric between 2 and 20 characters (no space)",email:"Email must be a valid email address",confirmEmail:"Email addresses must match",confirmPassword:"Passwords must match",currentPassword:"Your password is incorrect",cloudletName:"Minimum of 5 characters, only lowercase and numbers",phone:"e.g. 1111111111",subject:"2 to 30 letters, without special characters",message:"Message cannot be less than 3 characters",appNames:"Only lowercase alphanumeric characters, dot (.), - or _ please",appNamesWithUppercaseDot:"Only alphanumeric characters, dot (.), - or _ please",appNamesWithDot:"Only lowercase alphanumeric characters, and - or _ please",appNameWithUppercase:"Accepts alphanumeric characters and _",appNameWithUppercaseHyphen:"Accepts alphanumeric characters, - and _",domain:"Domain is not valid",backend:"Backend URL must contain http://",password:"Minimum 12 characters",recaptcha:"Not valid reCAPTCHA secret or key"}},8194:(S,_,a)=>{a.d(_,{g:()=>p});const p={phone:/^[0-9 ]*$/,name:/^[a-z0-9]{2,20}$/,subject:/^.{4,1000}$/,appNames:/^[a-z0-9_.-]+$/,appNamesWithDot:/^[a-z0-9_.-]+$/,appNamesWithUppercaseDot:/^[a-zA-Z0-9_.-]+$/,appNameWithUppercase:/^[a-zA-Z0-9_]+$/,appNameWithUppercaseHyphen:/^[a-zA-Z0-9_-]+$/,domain:/(^https?:\/\/)([\w\-])+\.{1}([a-zA-Z]{2,63})([\/\w-]*)*\/?\??([^#\n\r]*)?#?([^\n\r]*)/,backend:/^https?:\/\/([\w\-.])+(:[0-9]*)?(\.\w+)?$/,email:/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/,password:/^.{12,}$/,recaptcha:/^([a-zA-Z-_0-9]{20,100})$/}},8588:(S,_,a)=>{a.d(_,{C:()=>g});var p=a(8266),C=a.n(p),u=a(7579);const e=JSON.parse('[{"extensions":["sql"],"options":{"mode":"text/x-mysql","lineNumbers":true,"readOnly":false,"theme":"aista","autofocus":true,"styleActiveLine":true,"extraKeys":{}}},{"extensions":["md","txt","log","key"],"options":{"mode":"markdown","lineNumbers":true,"readOnly":false,"theme":"aista","autofocus":true,"styleActiveLine":true,"extraKeys":{}}},{"extensions":["yml","yaml"],"options":{"mode":"text/x-yaml","lineNumbers":true,"readOnly":false,"theme":"aista","autofocus":true,"styleActiveLine":true,"extraKeys":{}}},{"extensions":["xml","html","htm"],"options":{"mode":"application/xml","lineNumbers":true,"readOnly":false,"theme":"aista","autofocus":true,"styleActiveLine":true,"extraKeys":{}}},{"extensions":["css"],"options":{"mode":"text/css","lineNumbers":true,"readOnly":false,"theme":"aista","autofocus":true,"styleActiveLine":true,"extraKeys":{}}},{"extensions":["scss"],"options":{"mode":"text/x-scss","lineNumbers":true,"readOnly":false,"theme":"aista","autofocus":true,"styleActiveLine":true,"extraKeys":{}}},{"extensions":["less"],"options":{"mode":"text/x-less","lineNumbers":true,"readOnly":false,"theme":"aista","autofocus":true,"styleActiveLine":true,"extraKeys":{}}},{"extensions":["sass"],"options":{"mode":"text/x-sass","lineNumbers":true,"readOnly":false,"theme":"aista","autofocus":true,"styleActiveLine":true,"extraKeys":{}}},{"extensions":["js","ts"],"options":{"mode":"text/javascript","lineNumbers":true,"readOnly":false,"theme":"aista","autofocus":true,"styleActiveLine":true,"extraKeys":{}}},{"extensions":["json"],"options":{"mode":"application/ld+json","lineNumbers":true,"readOnly":false,"theme":"aista","autofocus":true,"styleActiveLine":true,"extraKeys":{}}},{"extensions":["py"],"options":{"mode":"text/x-python","lineNumbers":true,"readOnly":false,"tabSize":4,"indentUnit":4,"indentAuto":true,"matchBrackets":true,"theme":"aista","autofocus":true,"styleActiveLine":true,"extraKeys":{"Shift-Tab":"indentLess","Tab":"indentMore"}}},{"extensions":["rb"],"options":{"mode":"text/x-ruby","lineNumbers":true,"readOnly":false,"tabSize":4,"indentUnit":4,"indentAuto":true,"matchBrackets":true,"theme":"aista","autofocus":true,"styleActiveLine":true,"extraKeys":{"Shift-Tab":"indentLess","Tab":"indentMore"}}},{"extensions":["sh"],"options":{"mode":"application/x-sh","lineNumbers":true,"readOnly":false,"theme":"aista","autofocus":true,"styleActiveLine":true,"extraKeys":{}}},{"extensions":["hl","config"],"options":{"mode":"hyperlambda","lineNumbers":true,"readOnly":false,"theme":"aista","autofocus":true,"styleActiveLine":true,"tabSize":3,"indentUnit":3,"indentAuto":true,"extraKeys":{"Shift-Tab":"indentLess","Tab":"indentMore","Ctrl-Space":"autocomplete"}}}]');var b=a(4650);let g=(()=>{class d{constructor(m){this.ngZone=m,this.extensions=e,this.action=new u.x}getActions(m,x){let c=[];if(m){const l=m.substring(m.lastIndexOf(".")+1).toLowerCase();c=this.extensions.filter(v=>-1!==v.extensions.indexOf(l))}else x&&(c=this.extensions.filter(l=>-1!==l.extensions.indexOf(x)));if(0===c.length)return null;{const l=this.clone(c[0]);return l.options.extraKeys&&(l.options.extraKeys["Alt-M"]=v=>{v.setOption("fullScreen",!v.getOption("fullScreen"))},l.options.extraKeys["Alt-S"]=()=>{this.ngZone.run(()=>{this.action.next("save")})},l.options.extraKeys["Alt-D"]=()=>{this.ngZone.run(()=>{this.action.next("deleteFile")})},l.options.extraKeys["Alt-C"]=()=>{this.ngZone.run(()=>{this.action.next("close")})},l.options.extraKeys["Alt-R"]=()=>{this.ngZone.run(()=>{this.action.next("renameFile")})},l.options.extraKeys["Alt-L"]=()=>{this.ngZone.run(()=>{this.action.next("renameFolder")})},l.options.extraKeys["Alt-V"]=()=>{this.ngZone.run(()=>{this.action.next("insertSnippet")})},l.options.extraKeys["Alt-O"]=()=>{this.ngZone.run(()=>{this.action.next("macro")})},l.options.extraKeys["Alt-A"]=()=>{this.ngZone.run(()=>{this.action.next("newFile")})},l.options.extraKeys["Alt-B"]=()=>{this.ngZone.run(()=>{this.action.next("newFolder")})},l.options.extraKeys["Alt-X"]=()=>{this.ngZone.run(()=>{this.action.next("deleteFolder")})},l.options.extraKeys["Alt-P"]=()=>{this.ngZone.run(()=>{this.action.next("preview")})},l.options.extraKeys.F5=()=>{this.ngZone.run(()=>{this.action.next("execute")})},l.options.extraKeys.F1=()=>{this.ngZone.run(()=>{this.action.next("prompt")})},"sql"===x&&(l.options.extraKeys["Ctrl-Space"]=v=>{this.ngZone.run(()=>{v.showHint({hint:C().hint.sql,completeSingle:!1})})})),l.options}}clone(m){var x={};for(var c in m)x[c]="object"==typeof m[c]?this.clone(m[c]):m[c];return x}}return d.\u0275fac=function(m){return new(m||d)(b.LFG(b.R0b))},d.\u0275prov=b.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})()},8789:(S,_,a)=>{a.r(_),a.d(_,{SocketModule:()=>X});var p=a(6895),C=a(8317),u=a(5938),e=a(4650),b=a(3885),g=a(7392),d=a(4859),f=a(9549),m=a(4144),x=a(266),c=a(4006);let l=(()=>{class n{constructor(t,s,o){this.generalService=t,this.dialogRef=s,this.data=o,this.name=""}ngOnInit(){this.data.subscriptionName&&""!==this.data.subscriptionName&&(this.name=this.data.subscriptionName)}connect(){this.data.subscriptionList&&this.data.subscriptionList.length>0&&this.data.subscriptionList.filter(t=>t===this.name).length>0?this.generalService.showFeedback("You are already subscribing to this messages","errorMessage"):""!==this.name?this.dialogRef.close(this.name):this.generalService.showFeedback("Please give your message a name.","errorMessage")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(b.m),e.Y36(u.so),e.Y36(u.WI))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-subscribe-dialog"]],decls:16,vars:2,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"w-100","standalone-field"],["matPrefix","","matTooltip","Name of messages to subscribe to",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],[1,"text-muted"],["matInput","","placeholder","Name of messages","name","-","spellcheck","false","autocomplete","off",3,"ngModel","ngModelChange"],["mat-dialog-actions","",3,"align"],["mat-button","","color","primary","type","button",1,"me-2"],["mat-flat-button","","color","primary","type","submit",1,"px-5",3,"click"]],template:function(t,s){1&t&&(e.TgZ(0,"h3",0),e._uU(1,"Subscribe to messages"),e.qZA(),e.TgZ(2,"form")(3,"div",1)(4,"mat-form-field",2)(5,"span",3)(6,"mat-icon"),e._uU(7,"edit_note"),e.qZA(),e.TgZ(8,"span",4),e._uU(9,"|"),e.qZA()(),e.TgZ(10,"input",5),e.NdJ("ngModelChange",function(i){return s.name=i}),e.qZA()()(),e.TgZ(11,"div",6)(12,"button",7),e._uU(13," Cancel "),e.qZA(),e.TgZ(14,"button",8),e.NdJ("click",function(){return s.connect()}),e._uU(15," Subscribe "),e.qZA()()()),2&t&&(e.xp6(10),e.Q6J("ngModel",s.name),e.xp6(1),e.Q6J("align","end"))},dependencies:[g.Hw,d.lW,f.KE,f.qo,m.Nt,u.uh,u.xY,u.H8,x.gM,c._Y,c.Fj,c.JJ,c.JL,c.On,c.F],encapsulation:2}),n})();var v=a(9554),O=a(8194),N=a(8588),A=a(1103);const y=function(){return{standalone:!0}};function F(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-form-field",11)(1,"span",12)(2,"mat-icon"),e._uU(3,"group"),e.qZA(),e.TgZ(4,"span",4),e._uU(5,"|"),e.qZA()(),e.TgZ(6,"input",13),e.NdJ("ngModelChange",function(o){e.CHM(t);const i=e.oxw();return e.KtG(i.data.groups=o)}),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(6),e.Q6J("ngModel",t.data.groups)("ngModelOptions",e.DdM(2,y))}}function U(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-form-field",11)(1,"span",14)(2,"mat-icon"),e._uU(3,"shield"),e.qZA(),e.TgZ(4,"span",4),e._uU(5,"|"),e.qZA()(),e.TgZ(6,"input",15),e.NdJ("ngModelChange",function(o){e.CHM(t);const i=e.oxw();return e.KtG(i.data.roles=o)}),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(6),e.Q6J("ngModel",t.data.roles)("ngModelOptions",e.DdM(2,y))}}function J(n,r){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"ngx-codemirror",16),e.NdJ("ngModelChange",function(o){e.CHM(t);const i=e.oxw();return e.KtG(i.data.message.content=o)}),e.qZA(),e.BQk()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",t.data.message.content)("ngModelOptions",e.DdM(3,y))("options",t.options)}}let M=(()=>{class n{constructor(t,s,o,i){this.generalService=t,this.dialogRef=s,this.data=o,this.codemirrorActionsService=i,this.options=null,this.codemirrorIsReady=!1,this.CommonRegEx=O.g,this.CommonErrorMessages=v.v}ngOnInit(){this.getCodeMirrorOptions()}send(){this.good()?this.dialogRef.close(this.data):this.generalService.showFeedback("Your code is not valid","errorMessage")}good(){try{return JSON.parse(this.data.message.content),!(null===this.data.message.name||""===this.data.message.name||[this.data.client,this.data.groups,this.data.roles].filter(t=>null!==t&&""!==t).length>1)}catch{return!1}}getCodeMirrorOptions(){const t=this.codemirrorActionsService.getActions(null,"json");t.autofocus=!1,this.options=t,setTimeout(()=>{this.codemirrorIsReady=!0},500)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(b.m),e.Y36(u.so),e.Y36(u.WI),e.Y36(N.C))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-publish-dialog"]],decls:21,vars:9,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"w-100","standalone-field"],["matPrefix","","matTooltip","Name of message to publish",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],[1,"text-muted"],["matInput","","placeholder","Name of message","required","","spellcheck","false","autocomplete","off","name","-",3,"ngModel","ngModelOptions","pattern","ngModelChange"],["class","w-100",4,"ngIf"],[4,"ngIf"],["mat-dialog-actions","",3,"align"],["mat-button","","mat-dialog-close","","color","primary"],["mat-flat-button","","color","primary","type","submit",1,"px-4",3,"click"],[1,"w-100"],["matPrefix","","matTooltip","Comma separated list of groups to publish message to",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],["matInput","","placeholder","Group","spellcheck","false","autocomplete","off","name","-",3,"ngModel","ngModelOptions","ngModelChange"],["matPrefix","","matTooltip","Comma separated list of roles to publish message to",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],["matInput","","placeholder","Roles","autocomplete","off","name","-",3,"ngModel","ngModelOptions","ngModelChange"],["name","content",3,"ngModel","ngModelOptions","options","ngModelChange"]],template:function(t,s){1&t&&(e.TgZ(0,"h3",0),e._uU(1,"Publish message"),e.qZA(),e.TgZ(2,"form")(3,"div",1)(4,"mat-form-field",2)(5,"span",3)(6,"mat-icon"),e._uU(7,"edit_note"),e.qZA(),e.TgZ(8,"span",4),e._uU(9,"|"),e.qZA()(),e.TgZ(10,"input",5),e.NdJ("ngModelChange",function(i){return s.data.message.name=i}),e.qZA(),e.TgZ(11,"mat-error"),e._uU(12),e.qZA()(),e.YNc(13,F,7,3,"mat-form-field",6),e.YNc(14,U,7,3,"mat-form-field",6),e.YNc(15,J,2,4,"ng-container",7),e.qZA(),e.TgZ(16,"div",8)(17,"button",9),e._uU(18," Close "),e.qZA(),e.TgZ(19,"button",10),e.NdJ("click",function(){return s.send()}),e._uU(20," Publish "),e.qZA()()()),2&t&&(e.xp6(10),e.Q6J("ngModel",s.data.message.name)("ngModelOptions",e.DdM(8,y))("pattern",s.CommonRegEx.appNamesWithUppercaseDot),e.xp6(2),e.Oqu(s.CommonErrorMessages.appNamesWithUppercaseDot),e.xp6(1),e.Q6J("ngIf",null===s.data.client||""===s.data.client),e.xp6(1),e.Q6J("ngIf",null===s.data.client||""===s.data.client),e.xp6(1),e.Q6J("ngIf",s.codemirrorIsReady),e.xp6(1),e.Q6J("align","end"))},dependencies:[p.O5,g.Hw,d.lW,f.TO,f.KE,f.qo,m.Nt,u.ZT,u.uh,u.xY,u.H8,x.gM,c._Y,c.Fj,c.JJ,c.JL,c.Q7,c.c5,c.On,c.F,A.C],encapsulation:2}),n})();var L=a(2843),K=a(9845);let Z=(()=>{class n{constructor(t){this.httpService=t}socketUsers(t,s,o){var i="?offset="+s+"&limit="+o;return t&&(i+="&filter="+encodeURIComponent(t)),this.httpService.get("/magic/system/sockets/list-users"+i)}socketUserCount(t){var s="";return t&&(s+="?filter="+encodeURIComponent(t)),this.httpService.get("/magic/system/sockets/count-users"+s)}socketMessages(){return this.httpService.get("/magic/system/sockets/published-messages")}publishMessage(t,s,o,i){return[s=null===s||""===s?null:s,o=null===o||""===o?null:o,i=null===i||""===i?null:i].filter(h=>null!==h).length>1?(0,L._)(()=>new Error("You have to choose maximum one of client, roles or groups")):this.httpService.post("/magic/system/sockets/publish",{client:s,roles:o,groups:i,name:t.name,message:JSON.parse(t.content)})}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(K.O))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var T=a(8710),k=a(3546);function P(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",6),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(),i=e.MAs(7);return o.removeSearchTerm(),e.KtG(i.value="")}),e.TgZ(1,"mat-icon"),e._uU(2,"close"),e.qZA()()}}let R=(()=>{class n{constructor(){this.filterList=new e.vpe}applyFilter(t){this.filterList.emit(t)}removeSearchTerm(){this.filterList.emit("")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-socket-searchbox"]],outputs:{filterList:"filterList"},decls:9,vars:1,consts:[[1,"w-100","standalone-field"],["matPrefix","",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],[1,"text-muted"],["matInput","","placeholder","Filter ...","autocomplete","off",3,"input"],["input",""],["mat-icon-button","","matSuffix","",3,"click",4,"ngIf"],["mat-icon-button","","matSuffix","",3,"click"]],template:function(t,s){if(1&t){const o=e.EpF();e.TgZ(0,"mat-form-field",0)(1,"span",1)(2,"mat-icon"),e._uU(3,"search"),e.qZA(),e.TgZ(4,"span",2),e._uU(5,"|"),e.qZA()(),e.TgZ(6,"input",3,4),e.NdJ("input",function(){e.CHM(o);const h=e.MAs(7);return e.KtG(s.applyFilter(h.value))}),e.qZA(),e.YNc(8,P,3,0,"button",5),e.qZA()}if(2&t){const o=e.MAs(7);e.xp6(8),e.Q6J("ngIf",""!==o.value)}},dependencies:[p.O5,g.Hw,d.lW,f.KE,f.qo,f.R9,m.Nt],encapsulation:2}),n})();function D(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"mat-card",1)(1,"mat-card-content")(2,"div",2)(3,"div")(4,"p"),e._uU(5," Name: "),e.TgZ(6,"span",3),e._uU(7),e.qZA()(),e.TgZ(8,"p"),e._uU(9," Path: "),e.TgZ(10,"span",3),e._uU(11),e.qZA()()(),e.TgZ(12,"div",4)(13,"button",5),e.NdJ("click",function(){const i=e.CHM(t).$implicit,h=e.oxw();return e.KtG(h.publish(i))}),e._uU(14," Publish "),e.qZA(),e.TgZ(15,"button",6),e.NdJ("click",function(){const i=e.CHM(t).$implicit,h=e.oxw();return e.KtG(h.subscribeToPublishedMessage(i.name))}),e._uU(16," Subscribe "),e.qZA()()()()()}if(2&n){const t=r.$implicit;e.xp6(7),e.Oqu(t.name),e.xp6(4),e.Oqu(t.path)}}let Y=(()=>{class n{constructor(t,s,o,i){this.dialog=t,this.socketService=s,this.backendService=o,this.generalService=i,this.publishedMessages=[],this.users=[],this.getConnections=new e.vpe,this.subscribe=new e.vpe}subscribeToPublishedMessage(t){this.subscribe.emit(t)}publish(t){this.dialog.open(M,{width:"550px",panelClass:"light",data:{message:{name:t.name,content:'{\r\n  "foo": "bar"\r\n}'},client:"",groups:"",roles:""}}).afterClosed().subscribe(s=>{s&&this.socketService.publishMessage(s.message,s.client,s.roles,s.groups).subscribe({next:()=>this.generalService.showFeedback("Message was successfully published","successMessage"),error:o=>this.generalService.showFeedback(o?.error?.message??o,"errorMessage")})})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(u.uw),e.Y36(Z),e.Y36(T.v),e.Y36(b.m))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-socket-list"]],inputs:{publishedMessages:"publishedMessages",users:"users"},outputs:{getConnections:"getConnections",subscribe:"subscribe"},decls:1,vars:1,consts:[["class","mb-3",4,"ngFor","ngForOf"],[1,"mb-3"],[1,"d-flex","justify-content-between","flex-xl-row","flex-column","align-items-xl-center"],[1,"text-muted"],[1,"d-flex","justify-content-end"],["mat-button","","color","primary",3,"click"],["mat-flat-button","","color","primary",1,"px-4",3,"click"]],template:function(t,s){1&t&&e.YNc(0,D,17,2,"mat-card",0),2&t&&e.Q6J("ngForOf",s.publishedMessages)},dependencies:[p.sg,d.lW,k.a8,k.dn],encapsulation:2}),n})();function I(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",3),e.NdJ("click",function(){const i=e.CHM(t).$implicit,h=e.oxw(2);return e.KtG(h.sendMessageToConnection(i))}),e._uU(1),e.qZA()}if(2&n){const t=r.$implicit;e.xp6(1),e.hij(" ",t," ")}}function E(n,r){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",11)(2,"button",12),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,i=e.oxw(3);return e.KtG(i.deleteMessage(o))}),e._uU(3," Remove message "),e.qZA()(),e.TgZ(4,"pre",13),e._uU(5),e.ALo(6,"json"),e.qZA(),e.BQk()}if(2&n){const t=e.oxw().$implicit;e.xp6(5),e.Oqu(e.lcZ(6,1,t.content))}}function q(n,r){if(1&n&&(e.TgZ(0,"div",9),e.YNc(1,E,7,3,"ng-container",10),e.qZA()),2&n){const t=r.$implicit,s=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",t.name===s)}}function j(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",4)(1,"div",5)(2,"p",6),e._uU(3),e.qZA(),e.TgZ(4,"button",7),e.NdJ("click",function(){const i=e.CHM(t).$implicit,h=e.oxw(2);return e.KtG(h.removeSelectedSubscription(i))}),e._uU(5," Remove subscription "),e.qZA()(),e.YNc(6,q,2,1,"div",8),e.qZA()}if(2&n){const t=r.$implicit,s=e.oxw(2);e.xp6(3),e.Oqu(t),e.xp6(3),e.Q6J("ngForOf",s.messages)}}function G(n,r){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,I,2,1,"button",1),e.YNc(2,j,7,2,"div",2),e.qZA()),2&n){const t=r.$implicit,s=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.connections),e.xp6(1),e.Q6J("ngForOf",s.subscriptions)}}let W=(()=>{class n{constructor(t,s,o,i){this.dialog=t,this.socketService=s,this.backendService=o,this.generalService=i,this.users=[],this.messages=[],this.subscriptions=[],this.removeSubscription=new e.vpe}sendMessageToConnection(t){this.dialog.open(M,{width:"550px",panelClass:"light",data:{message:{name:"",content:'{\r\n  "foo": "bar"\r\n}'},client:t,groups:"",roles:""}}).afterClosed().subscribe(o=>{o&&this.socketService.publishMessage(o.message,o.client,o.roles,o.groups).subscribe({next:()=>this.generalService.showFeedback("Message was successfully sent","successMessage"),error:i=>this.generalService.showFeedback(i?.error?.message??i,"errorMessage")})})}removeSelectedSubscription(t){this.removeSubscription.emit(t)}deleteMessage(t){this.messages.splice(this.messages.indexOf(t),1),this.generalService.showFeedback("Message was removed","successMessage")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(u.uw),e.Y36(Z),e.Y36(T.v),e.Y36(b.m))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-socket-result"]],inputs:{users:"users",messages:"messages",subscriptions:"subscriptions"},outputs:{removeSubscription:"removeSubscription"},decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],["mat-button","","class","d-block ps-0",3,"click",4,"ngFor","ngForOf"],["class","d-flex flex-column w-100 p-3 bg-light mt-3",4,"ngFor","ngForOf"],["mat-button","",1,"d-block","ps-0",3,"click"],[1,"d-flex","flex-column","w-100","p-3","bg-light","mt-3"],[1,"d-flex","justify-content-between","align-items-center"],[1,"my-0","fw-bold"],["mat-button","","color","warn",3,"click"],["class","code",4,"ngFor","ngForOf"],[1,"code"],[4,"ngIf"],[1,"d-flex","justify-content-end","align-items-center","w-100","mt-3"],["mat-button","","color","primary",1,"mat-caption",3,"click"],[1,"mb-3","mt-0"]],template:function(t,s){1&t&&e.YNc(0,G,3,2,"div",0),2&t&&e.Q6J("ngForOf",s.users)},dependencies:[p.sg,p.O5,d.lW,p.Ts],encapsulation:2}),n})(),$=(()=>{class n{constructor(t,s,o,i){this.dialog=t,this.socketService=s,this.backendService=o,this.generalService=i,this.users=[],this.selectedUsers=[],this.publishedMessages=[],this.CopyPublishedMessages=[],this.searchKey="",this.pageIndex=0,this.pageSize=100,this.totalItems=0,this.subscriptions=[],this.messages=[],this.hubConnection=null}ngOnInit(){this.getConnections(),this.getCount(),this.getMessages()}filterList(t){this.searchKey=t,this.publishedMessages=t&&""!==t?this.CopyPublishedMessages.filter(s=>s.name.indexOf(t)>-1):this.CopyPublishedMessages}getConnections(t){this.socketService.socketUsers(this.searchKey,this.pageIndex*this.pageSize,this.pageSize).subscribe({next:s=>{this.selectedUsers=[],this.users=s??[],t&&this.users.length>0?this.getCount():t&&0===this.users.length&&(this.totalItems=0)},error:s=>this.generalService.showFeedback(s?.error?.message??s,"errorMessage")})}getCount(){this.socketService.socketUserCount(this.searchKey).subscribe({next:t=>this.count=t.count,error:t=>this.generalService.showFeedback(t?.error?.message??t,"errorMessage")})}getMessages(){this.socketService.socketMessages().subscribe({next:t=>{this.publishedMessages=t||[],this.CopyPublishedMessages=t||[]},error:t=>this.generalService.showFeedback(t?.error?.message??t,"errorMessage")})}publish(){this.dialog.open(M,{width:"550px",panelClass:"light",data:{message:{content:'{\r\n  "foo": "bar"\r\n}'},client:"",groups:"",roles:""}}).afterClosed().subscribe(t=>{t&&this.socketService.publishMessage(t.message,t.client,t.roles,t.groups).subscribe({next:()=>this.generalService.showFeedback("Message was successfully published","successMessage"),error:s=>this.generalService.showFeedback(s?.error?.message??s,"errorMessage")})})}subscribe(t){this.dialog.open(l,{width:"550px",data:{subscriptionName:t,subscriptionList:this.subscriptions}}).afterClosed().subscribe(o=>{if(o){let i=!1;if(!this.hubConnection){let h=new C.su;this.hubConnection=h.withUrl(this.backendService.active.url+"/sockets",{accessTokenFactory:()=>this.backendService.active.token.token,skipNegotiation:!0,transport:C.n4.WebSockets}).build(),i=!0}this.hubConnection.on(o,h=>{this.messages.push({name:o,content:JSON.parse(h)})}),this.subscriptions.push(o),i&&this.hubConnection.start().then(()=>{setTimeout(()=>this.getConnections(!0),500)})}})}removeSubscription(t){this.hubConnection.off(t),this.subscriptions.splice(this.subscriptions.indexOf(t),1),0===this.subscriptions.length&&(this.hubConnection.stop(),this.hubConnection=null,this.getConnections(),this.messages=[])}clearMessages(){this.messages=[]}changePage(t){this.pageSize=t.pageSize,this.pageIndex=t.pageIndex,this.getConnections()}ngOnDestroy(){this.hubConnection&&this.hubConnection.stop()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(u.uw),e.Y36(Z),e.Y36(T.v),e.Y36(b.m))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-sockets"]],decls:29,vars:5,consts:[[1,"row","fullPage"],[1,"col-md-6","col-12","mb-md-0","mb-4"],[1,"h-100"],[1,"h-100","max-height-full"],[1,"d-flex","justify-content-between","button-row","align-items-center","pe-2"],[1,"my-0","fw-bold"],["mat-button","","color","primary",1,"px-3",3,"click"],["mat-flat-button","","color","primary",1,"px-3",3,"click"],[1,"row","pe-2"],[1,"col-12"],[3,"filterList"],[1,"row","mt-3","scrollable-row","pb-3"],[1,"col-12","max-height","pb-3"],[3,"publishedMessages","users","getConnections","subscribe"],[1,"col-md-6","col-12"],[1,"d-flex","justify-content-between","align-items-center"],["mat-button","","color","primary",1,"px-4",3,"click"],[1,"row","mt-3","scrollable-row"],[3,"users","messages","subscriptions","removeSubscription"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"mat-card",2)(3,"mat-card-content",3)(4,"div",4)(5,"h3",5),e._uU(6," List of sockets "),e.qZA(),e.TgZ(7,"div")(8,"button",6),e.NdJ("click",function(){return s.publish()}),e._uU(9," Publish "),e.qZA(),e.TgZ(10,"button",7),e.NdJ("click",function(){return s.subscribe()}),e._uU(11," Subscribe "),e.qZA()()(),e.TgZ(12,"div",8)(13,"div",9)(14,"app-socket-searchbox",10),e.NdJ("filterList",function(i){return s.filterList(i)}),e.qZA()()(),e.TgZ(15,"div",11)(16,"div",12)(17,"app-socket-list",13),e.NdJ("getConnections",function(i){return s.getConnections(i)})("subscribe",function(i){return s.subscribe(i)}),e.qZA()()()()()(),e.TgZ(18,"div",14)(19,"mat-card",2)(20,"mat-card-content",3)(21,"div",15)(22,"h3",5),e._uU(23," List of subscriptions "),e.qZA(),e.TgZ(24,"button",16),e.NdJ("click",function(){return s.clearMessages()}),e._uU(25,"Clear all messages"),e.qZA()(),e.TgZ(26,"div",17)(27,"div",12)(28,"app-socket-result",18),e.NdJ("removeSubscription",function(i){return s.removeSubscription(i)}),e.qZA()()()()()()()),2&t&&(e.xp6(17),e.Q6J("publishedMessages",s.publishedMessages)("users",s.users),e.xp6(11),e.Q6J("users",s.users)("messages",s.messages)("subscriptions",s.subscriptions))},dependencies:[d.lW,k.a8,k.dn,R,Y,W],styles:[".scrollable-row[_ngcontent-%COMP%]{height:calc(100% - 100px)}.max-height-full[_ngcontent-%COMP%]{max-height:53vh;min-height:100%;overflow:hidden}.max-height[_ngcontent-%COMP%]{max-height:100%;overflow:auto}"]}),n})();var w=a(9132);const z=[{path:"",component:$}];let Q=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[w.Bz.forChild(z),w.Bz]}),n})();var H=a(2278),B=a(1717);let X=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[p.ez,Q,H.q,c.u5,B.h,A.k]}),n})()},1717:(S,_,a)=>{a.d(_,{h:()=>b});var p=a(6895),C=a(4006),u=a(1103),e=a(4650);let b=(()=>{class g{}return g.\u0275fac=function(f){return new(f||g)},g.\u0275mod=e.oAB({type:g}),g.\u0275inj=e.cJS({imports:[p.ez,u.k,C.u5]}),g})()}}]);