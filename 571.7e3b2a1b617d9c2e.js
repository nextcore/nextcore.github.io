"use strict";(self.webpackChunkmagic=self.webpackChunkmagic||[]).push([[571],{8571:(U,c,i)=>{i.r(c),i.d(c,{ChatbotWizardModule:()=>R});var h=i(6895),d=i(8317),u=i(6620),p=i(8670),w=i(923),e=i(4650),C=i(5938),v=i(6147),b=i(8710),x=i(3885),A=i(7392),y=i(4859),g=i(9549),S=i(4144),T=i(266),M=i(4385),Z=i(3238),m=i(3546),r=i(4006);function O(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",4)(1,"div",5)(2,"h3",6),e._uU(3,"Chatbot Wizard"),e.qZA(),e.TgZ(4,"p",7),e._uU(5," Before you can create a chatbot you need to supply your OpenAI API key, your reCAPTCHA site-key and secret. "),e.qZA()(),e.TgZ(6,"div",8)(7,"button",9),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.manageOpenAI())}),e._uU(8," Configure OpenAI API key "),e.qZA(),e.TgZ(9,"button",9),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.manageCAPTCHA())}),e._uU(10," Configure reCAPTCHA "),e.qZA()()()}}function W(o,a){if(1&o&&(e.TgZ(0,"mat-option",21),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.name," ")}}function I(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"form",10),e.NdJ("ngSubmit",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.createBot())}),e.TgZ(1,"div",5)(2,"h3",6),e._uU(3,"Chatbot Wizard"),e.qZA(),e.TgZ(4,"p",7),e._uU(5," What website do you wish to generate training data from? Notice, for a demo bot we will only scrape the first 50 pages found. "),e.qZA()(),e.TgZ(6,"div",11)(7,"div",12)(8,"mat-form-field",13)(9,"span",14)(10,"mat-icon"),e._uU(11,"http"),e.qZA(),e.TgZ(12,"span",7),e._uU(13,"|"),e.qZA()(),e.TgZ(14,"input",15),e.NdJ("ngModelChange",function(s){e.CHM(t);const l=e.oxw();return e.KtG(l.url=s)}),e.qZA()(),e.TgZ(15,"mat-form-field",16)(16,"span",17)(17,"mat-icon"),e._uU(18,"person"),e.qZA(),e.TgZ(19,"span",7),e._uU(20,"|"),e.qZA()(),e.TgZ(21,"mat-select",18),e.NdJ("ngModelChange",function(s){e.CHM(t);const l=e.oxw();return e.KtG(l.flavor=s)}),e.YNc(22,W,2,2,"mat-option",19),e.qZA()(),e.TgZ(23,"button",20),e._uU(24," Start "),e.qZA()()()()}if(2&o){const t=e.oxw();e.xp6(14),e.Q6J("disabled",t.crawling)("ngModel",t.url),e.xp6(7),e.Q6J("ngModel",t.flavor)("disabled",t.isLoading)("disabled",t.crawling),e.xp6(1),e.Q6J("ngForOf",t.flavors),e.xp6(1),e.Q6J("disabled",!t.goodWebsite()||t.crawling)}}function z(o,a){if(1&o&&(e.TgZ(0,"div",24),e._uU(1),e.qZA()),2&o){const t=a.$implicit,n=a.index;e.Tol("msg "+t.type),e.Q6J("id","m_"+n),e.xp6(1),e.Oqu(t.message)}}function J(o,a){if(1&o&&(e.TgZ(0,"div",22),e.YNc(1,z,2,4,"div",23),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.messages)}}let F=(()=>{class o{constructor(t,n,s,l){this.dialog=t,this.openAIService=n,this.backendService=s,this.generalService=l,this.hubConnection=null,this.isLoading=!0,this.configured=!1,this.hasApiKey=!1,this.hasReCaptcha=!1,this.reCaptcha=null,this.isSaving=!1,this.url="",this.crawling=!1,this.messages=[],this.doneCreatingBot=!1,this.model="",this.flavors=[{name:"Sales Executive",prefix:"Answer the following as if you are a Sales Executive in the subject: "},{name:"The CEO",prefix:"Answer the following as if you are the CEO of the company: "},{name:"Empathy",prefix:"Answer the following as if you really care about the person: "},{name:"Funny",prefix:"Answer the following and finish with a relevant joke about the subject: "},{name:"An Expert",prefix:"Answer the following as if you are an expert in the subject: "},{name:"One liner",prefix:"Answer the following with one sentence: "},{name:"Two liner",prefix:"Answer the following with two sentences: "},{name:"Multilingual",prefix:"Answer the following question in the same language: "},{name:"Wall of text",prefix:"Answer the following with 5 paragraphs: "},{name:"Poet",prefix:"Answer the following with a poem: "},{name:"Donald Trump",prefix:"Answer the following in the style of Donald Trump: "},{name:"Joe Biden",prefix:"Answer the following in the style of Joe Biden: "},{name:"Barack Obama",prefix:"Answer the following in the style of Barack Obama: "},{name:"Thomas Jefferson",prefix:"Answer the following in the style of Thomas Jefferson: "},{name:"Snoop Dog",prefix:"Answer the following in the style of Snoop Dog: "},{name:"Bob Marley",prefix:"Answer the following in the style of Bob Marley: "},{name:"Buddha",prefix:"Answer the following in the style of the Buddha: "},{name:"Jesus",prefix:"Answer the following in the style of Jesus: "},{name:"Pirate",prefix:"Answer the following in the style of a Pirate: "},{name:"Alien from Zorg",prefix:"Answer the following as if you are an alien from the planet Zorg who came here to conquer the Earth: "},{name:"Reddit Troll",prefix:"Answer the following as if you are a Reddit troll: "}],this.flavor=null}ngOnInit(){this.generalService.showLoading(),this.openAIService.key().subscribe({next:t=>{this.hasApiKey=t.result?.length>0,this.backendService.getReCaptchaKeySecret().subscribe({next:n=>{this.generalService.hideLoading(),this.isLoading=!1,this.hasReCaptcha=n.key?.length>0&&n.secret?.length>0,this.configured=this.hasApiKey&&this.hasReCaptcha,this.reCaptcha=n,this.hasApiKey?this.hasReCaptcha||this.manageCAPTCHA():this.manageOpenAI()},error:()=>{this.generalService.hideLoading(),this.generalService.showFeedback("Something went wrong as we tried to check if OpenAI API key is configured","errorMessage"),this.isLoading=!1}}),this.generalService.hideLoading(),this.isLoading=!1},error:()=>{this.generalService.hideLoading(),this.generalService.showFeedback("Something went wrong as we tried to check if OpenAI API key is configured","errorMessage"),this.isLoading=!1}})}ngOnDestroy(){this.hubConnection?.stop()}goodWebsite(){if(!(this.url.length>0&&(this.url.startsWith("http://")||this.url.startsWith("https://"))))return!1;const n=this.url.split("://");return!(0===n.length||n[1].length<5||-1===n[1].indexOf(".")||-1!==n[1].indexOf("/"))}createBot(){this.crawling=!0,this.generalService.showLoading(),this.doneCreatingBot=!1,this.messages=[];let t=new d.su;this.hubConnection=t.withUrl(this.backendService.active.url+"/sockets",{accessTokenFactory:()=>this.backendService.active.token.token,skipNegotiation:!0,transport:d.n4.WebSockets}).build(),this.hubConnection.on("magic.backend.chatbot",n=>{n=JSON.parse(n),this.messages.push(n),this.doneCreatingBot="success"===n.type||"error"===n.type,"success"===n.type?(this.generalService.showFeedback("Done creating bot","successMessage"),this.embed()):"warning"===n.type?this.generalService.showFeedback(n.message):"error"===n.type&&(this.generalService.showFeedback(n.message,"errorMessage"),n.message.includes("license")&&this.openAIService.vectorise(this.model).subscribe({next:()=>{console.log("Vectorising started")},error:s=>{this.generalService.showFeedback(s?.error?.message??"Something went wrong as we tried to create your bot","errorMessage","Ok",1e4)}})),setTimeout(()=>{document.getElementById("m_"+(this.messages.length-1)).scrollIntoView()},50)}),this.hubConnection.start().then(()=>{this.openAIService.createBot(this.url,this.flavor?.prefix??"").subscribe({next:n=>{this.model=n.result,this.generalService.hideLoading()},error:()=>{this.generalService.hideLoading(),this.generalService.showFeedback("Something went wrong as we tried to create your bot","errorMessage"),this.doneCreatingBot=!0,this.hubConnection.stop(),this.hubConnection=null}})})}embed(){this.dialog.open(u.A,{width:"80vw",maxWidth:"650px",data:{type:this.model,noClose:!0,model:"gpt-3.5-turbo"}})}closeBotCreator(){this.crawling=!1}manageOpenAI(){this.dialog.open(p.n,{width:"80vw",maxWidth:"550px",disableClose:!0}).afterClosed().subscribe(t=>{t.configured&&(this.hasApiKey=!0,this.configured=this.hasReCaptcha,this.hasReCaptcha||this.manageCAPTCHA())})}manageCAPTCHA(){this.dialog.open(w.L,{width:"80vw",maxWidth:"550px",data:this.reCaptcha,disableClose:!0}).afterClosed().subscribe(t=>{t&&this.backendService.setReCaptchaKeySecret(t.key,t.secret).subscribe({next:()=>{this.generalService.hideLoading(),this.generalService.showFeedback("reCAPTCHA settings successfully save","successMessage"),this.hasReCaptcha=!0,this.configured=this.hasApiKey,this.hasApiKey||this.manageOpenAI()},error:()=>{this.generalService.hideLoading(),this.generalService.showFeedback("Something went wrong as we tried to check if OpenAI API key is configured","errorMessage"),this.isLoading=!1}})})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(C.uw),e.Y36(v.A),e.Y36(b.v),e.Y36(x.m))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-chatbot-wizard"]],decls:5,vars:3,consts:[[1,"mb-0"],["class","row",4,"ngIf"],["class","row",3,"ngSubmit",4,"ngIf"],["class","row","class","mt-4 messages",4,"ngIf"],[1,"row"],[1,"col-12","mb-3"],[1,"fw-bold"],[1,"text-muted"],[1,"col-12","text-end"],["mat-button","","color","primary",3,"click"],[1,"row",3,"ngSubmit"],[1,"col-md-9","col-12"],[1,"d-flex","justify-content-md-between","align-items-md-center","align-items-end","flex-md-row","w-100"],[1,"w-100","standalone-field"],["matPrefix","","matTooltip","Website URL",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],["matInput","","type","text","placeholder","Website URL","name","url","autocomplete","off",3,"disabled","ngModel","ngModelChange"],[1,"w-100","standalone-field","mx-2"],["matPrefix","","matTooltip","Flavor",1,"d-flex","flex-nowrap","align-items-center","justify-content-between","me-2"],["placeholder","Flavor","name","flavor",3,"ngModel","disabled","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["mat-flat-button","","color","primary",1,"ms-3","px-5",3,"disabled"],[3,"value"],[1,"mt-4","messages"],[3,"class","id",4,"ngFor","ngForOf"],[3,"id"]],template:function(t,n){1&t&&(e.TgZ(0,"mat-card",0)(1,"mat-card-content"),e.YNc(2,O,11,0,"div",1),e.YNc(3,I,25,7,"form",2),e.YNc(4,J,2,1,"div",3),e.qZA()()),2&t&&(e.xp6(2),e.Q6J("ngIf",!n.configured),e.xp6(1),e.Q6J("ngIf",n.configured),e.xp6(1),e.Q6J("ngIf",n.crawling))},dependencies:[h.sg,h.O5,A.Hw,y.lW,g.KE,g.qo,S.Nt,T.gM,M.gD,Z.ey,m.a8,m.dn,r._Y,r.Fj,r.JJ,r.JL,r.On,r.F],styles:[".messages[_ngcontent-%COMP%]{background-color:#000;padding:25px 15px;border-radius:5px;color:#e0e0e0;line-height:1.1rem;position:relative;max-height:340px;overflow:auto}@keyframes fade-in{0%{margin-left:-300px;opacity:0}to{margin-left:0;opacity:1}}.messages[_ngcontent-%COMP%]   .msg[_ngcontent-%COMP%]{opacity:0;animation-name:fade-in;animation-duration:.25s;animation-fill-mode:forwards;animation-timing-function:ease-in-out}.messages[_ngcontent-%COMP%]   .success[_ngcontent-%COMP%]{color:#0f0}.messages[_ngcontent-%COMP%]   .warning[_ngcontent-%COMP%]{color:#ffc800}.messages[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{color:red}"]}),o})();var f=i(9132);const P=[{path:"",component:F}];let k=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[f.Bz.forChild(P),f.Bz]}),o})();var B=i(7832),L=i(2278),K=i(1075);let R=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[h.ez,k,B.K,L.q,r.u5,K.m]}),o})()}}]);